import{r as i,a as P,c as k,u as S,j as e,am as r,bi as T,m as t,k as C,bj as _,bk as A,bl as E,bm as I,bn as $,bo as c,bp as s,b,f as d}from"./vendor-C1EOYKAv.js";const N="https://www.rubertogo.com",D=()=>{const[a,v]=i.useState(null),[w,n]=i.useState(!0),[u,B]=i.useState(null),{lang:f}=P(),z=k(),m=S(),p=new URLSearchParams(z.search),o=p.get("session_id"),x=p.get("booking_id"),g=i.useRef(!1);return i.useEffect(()=>{let j=!0;const y=async()=>{if(!(!o||!x||g.current)){g.current=!0,n(!0);try{const h=await b.get(`${N}/api/payment-session/${o}`);v(h.data);const l=await b.post(`${N}/api/create-pre-authorization`,{sessionId:o,bookingId:x},{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});if(l.status===201)n(!1),d.success("Pre-authorization successful.");else if(l.status===200)n(!1),d.info("Pre-authorization already exists.");else if(l.data.error){d.error(l.data.error),m(`/${f}/payment-failed`);return}}catch(h){h.response?.status===429?setTimeout(y,5e3):(d.error("Failed to create pre-authorization."),m(`/${f}/payment-failed`))}finally{j&&n(!1)}}};return y(),()=>{j=!1}},[o,x,m]),w?e.jsxs("div",{className:"flex flex-col justify-center items-center h-screen bg-gray-100",children:[e.jsx("div",{className:"w-72 h-36 relative",children:e.jsxs("svg",{width:"100%",height:"100%",children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"vanBodyGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#ff5252"}),e.jsx("stop",{offset:"100%",stopColor:"#e63946"})]})}),e.jsx("rect",{width:"100%",height:"30",y:"100",fill:"#333"}),e.jsx("line",{x1:"0",y1:"115",x2:"100%",y2:"115",stroke:"#fff",strokeWidth:"2",strokeDasharray:"10 8"}),e.jsx(r.g,{initial:{x:"-20%"},animate:{x:"120%"},transition:{repeat:1/0,duration:5,ease:"linear"},children:e.jsx("image",{href:"https://rubertogo.fra1.digitaloceanspaces.com/images/1736120575234.png",x:"40",y:"20",height:"120",width:"120",alt:"Van",loading:"lazy"})})]})}),e.jsx("p",{className:"mt-6 text-lg font-semibold text-gray-600",children:"Attendere prego, la tua prenotazione Ã¨ in elaborazione..."})]}):u?e.jsxs(r.div,{className:"flex flex-col items-center justify-center h-screen",initial:{opacity:0},animate:{opacity:1},transition:{duration:1},children:[e.jsx(T,{size:100,className:"text-red-600"}),e.jsx(t,{variant:"h4",className:"text-center mt-4",children:u})]}):e.jsxs(r.div,{className:"container mx-auto sm:py-32 py-10 px-4",initial:{opacity:0},animate:{opacity:1},transition:{duration:1},children:[e.jsxs(r.div,{className:"py-12 bg-gradient-to-r from-[#ff0707] to-orange-500 text-white text-center",initial:{opacity:0},animate:{opacity:1},transition:{duration:1},children:[e.jsx(t,{variant:"h4",className:"font-bold",children:"La tua ricevuta di pagamento"}),e.jsx(t,{variant:"body1",className:"mt-2",children:"A breve riceverai via email il contratto di noleggio e le istruzioni su come ritirare il furgone."})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsxs(C,{className:"bg-white shadow-lg rounded-lg border border-gray-300 p-6 text-gray-700",children:[e.jsx(r.div,{className:"flex items-center justify-center",initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:150,damping:20},children:e.jsx("div",{className:"bg-green-500 p-3 rounded-full",children:e.jsx(_,{size:32,className:"text-white"})})}),e.jsx(t,{variant:"h4",className:"text-center font-bold mt-4",children:"Pagamento Avvenuto con Successo!"}),e.jsxs(t,{variant:"h6",className:"text-center font-semibold mt-2",children:[(a.amount_total/100).toFixed(2),e.jsx("span",{className:"uppercase ml-2",children:a.currency})]}),e.jsx(A,{component:E,className:"mt-6 shadow-md",children:e.jsx(I,{children:e.jsxs($,{children:[e.jsxs(c,{children:[e.jsx(s,{className:"font-semibold",children:"Nome:"}),e.jsx(s,{children:a.customer_details.name})]}),e.jsxs(c,{children:[e.jsx(s,{className:"font-semibold",children:"Email:"}),e.jsx(s,{children:a.customer_details.email})]}),e.jsxs(c,{children:[e.jsx(s,{className:"font-semibold",children:"Numero di Telefono:"}),e.jsx(s,{children:a.customer_details.phone})]}),e.jsxs(c,{children:[e.jsx(s,{className:"font-semibold",children:"Importo Pagato:"}),e.jsxs(s,{children:[(a.amount_total/100).toFixed(2)," CHF"]})]})]})})}),e.jsx(t,{variant:"body2",className:"text-center mt-6 p-4 text-gray-500",children:"Grazie per il tuo pagamento!"})]})})]})};export{D as default};
