import{r as a,a as W,j as t,aR as q,k as S,c0 as U,C as G,m as x,a9 as $,aU as H,c1 as J,B as g,aK as Q,b as w,f as i}from"./vendor-DuWeQkuf.js";import{a as X}from"./index--ZbGcTd3.js";const y="https://www.rubertogo.com",_=({open:E,handleClose:h,email:I})=>{const[u,N]=a.useState(I||""),[o,m]=a.useState(["","","",""]),[j,b]=a.useState(1),[v,f]=a.useState(""),[O,T]=a.useState(!1),[B,C]=a.useState(600),[L,n]=a.useState(!1),p=a.useRef([]),d=a.useRef(null),{lang:P}=W(),{translations:l}=X(),k=()=>{T(!1),C(600),d.current&&clearInterval(d.current),d.current=setInterval(()=>{C(e=>e<=1?(clearInterval(d.current),T(!0),0):e-1)},1e3)},R=e=>{const r=Math.floor(e/60),s=e%60;return`${r}:${s<10?"0":""}${s}`},A=async()=>{if(!u||!/^[\w-.]+@([\w-]+\.)+[\w-]{2,4}$/.test(u)){f("Please enter a valid email.");return}f(""),n(!0);try{const e=await w.post(`${y}/api/login`,{email:u});n(!1),e.status===201?(b(2),k(),i.success("OTP sent to your email.")):f("Failed to send OTP. Please try again.")}catch(e){n(!1),f("An error occurred. Please try again."),console.error(e)}},D=async()=>{n(!0);try{const e=await w.post(`${y}/api/resend-otp`,{email:u});n(!1),e.status===201?(k(),i.success("OTP resent successfully!")):i.error("Failed to resend OTP. Please try again.")}catch(e){n(!1),i.error("An error occurred while resending OTP."),console.error(e)}},M=(e,r)=>{const{value:s}=e.target;if(s&&/^\d$/.test(s)){const c=[...o];c[r]=s,m(c),r<o.length-1&&p.current[r+1]?.focus()}else if(!s){const c=[...o];c[r]="",m(c)}},F=(e,r)=>{if(e.key==="Backspace")if(o[r]){const s=[...o];s[r]="",m(s)}else r>0&&p.current[r-1]?.focus()},z=e=>{const r=e.clipboardData.getData("Text").slice(0,o.length);if(/^\d{4}$/.test(r)){const s=r.split("").slice(0,o.length);m(s),p.current[s.length-1]?.focus()}},K=async e=>{e.preventDefault();const r=o.join("");if(r.length!==4){i.error("Please enter a valid 4-digit OTP.");return}n(!0);try{const s=await w.post(`${y}/api/verify-otp`,{email:u,otp:r});n(!1);const{accessToken:c,refreshToken:V}=s.data;localStorage.setItem("accessToken",c),localStorage.setItem("refreshToken",V),i.success("Login successful!"),window.location.pathname===`/${P}`||window.location.pathname==="/"?window.location.href=`/${P||"en"}/account`:window.location.reload(),h()}catch(s){n(!1),i.error("Invalid or expired OTP."),console.error(s)}};return a.useEffect(()=>()=>{d.current&&clearInterval(d.current)},[]),t.jsx(q,{open:E,onClose:h,"aria-labelledby":"login-modal",children:t.jsxs(S,{className:"flex relative flex-col items-center p-10  bg-white rounded-lg shadow-lg max-w-2xl w-full",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:[t.jsx(U,{open:L,sx:{color:"#fff",zIndex:1301},children:t.jsx(G,{color:"inherit"})}),t.jsx("button",{onClick:h,className:"absolute top-0 right-2 p-2 rounded-full text-2xl text-red-500",children:"Ã—"}),t.jsx("div",{className:"w-full shadow-sm mb-4",style:{width:"250px"},children:t.jsx("img",{src:"/rubertogo-logo.svg",alt:"Rubertogo Logo"})}),t.jsx(x,{variant:"h5",align:"center",gutterBottom:!0,children:j===1?`${l.loginAccount}`:`${l.enterCode}`}),j===1?t.jsxs(t.Fragment,{children:[t.jsx($,{fullWidth:!0,label:"Email",variant:"outlined",placeholder:"Enter your email",value:u,required:!0,error:!!v,helperText:v||"",onChange:e=>N(e.target.value),InputProps:{startAdornment:t.jsx(H,{position:"start",children:t.jsx(J,{className:"text-gray-500",size:24})})},className:"mb-4",style:{marginBottom:"1rem"}}),t.jsx(g,{onClick:A,variant:"contained",color:"primary",className:"w-full",children:l.sendCode})]}):t.jsxs(t.Fragment,{children:[t.jsx(x,{align:"center",className:"mb-4",sx:{margin:"10px"},children:l.loginModalTitle}),t.jsx(S,{display:"flex",justifyContent:"center",gap:1,mb:2,children:o.map((e,r)=>t.jsx($,{inputRef:s=>p.current[r]=s,type:"text",variant:"outlined",value:e,onChange:s=>M(s,r),onKeyDown:s=>F(s,r),onPaste:r===0?z:void 0,inputProps:{maxLength:1,inputMode:"numeric",style:{textAlign:"center",fontSize:"1.5rem",width:"2rem",height:"2rem"}}},r))}),t.jsx(x,{align:"center",variant:"body2",color:"textSecondary",children:O?"CODE has expired. Please resend.":`Time remaining: ${R(B)}`}),O&&t.jsx(g,{onClick:D,variant:"text",color:"secondary",className:"mt-2",children:l.resentCode}),t.jsx(g,{onClick:K,variant:"contained",color:"primary",className:"w-full",startIcon:t.jsx(Q,{}),sx:{backgroundColor:"#4565f7",color:"#fff",marginTop:"1rem","&:hover":{backgroundColor:"#388e3c"}},children:l.submitOtp}),t.jsx(g,{variant:"contained",color:"secondary",fullWidth:!0,onClick:()=>b(1),className:"mt-4",sx:{backgroundColor:"#f44336",color:"#fff",marginTop:"1rem","&:hover":{backgroundColor:"#d32f2f"}},children:l.changeEmail})]})]})})};export{_ as L};
