import{r as e,aV as a,b as s,j as t,bZ as o,cc as n,b$ as r,c0 as l,c1 as i,a2 as d,bi as c,I as u,cd as h,k as m,a4 as p}from"./vendor-Zgq9WbFI.js";const x="https://rubertogo.com",g=()=>{const[g,f]=e.useState([]),[v,C]=e.useState(!1),[j,b]=e.useState({code:"",discountType:"fixed",discountValue:"",minPaidHours:"",minAmount:"",maxUses:"",expiresAt:""}),y=localStorage.getItem("accessToken");e.useEffect((()=>{A()}),[]);const A=async()=>{var e;try{const e=localStorage.getItem("accessToken");if(!e)return console.error("No access token found"),void a.error("Authentication error. Please log in again.");const t=await s.get(`${x}/api/coupons/all`,{headers:{Authorization:`Bearer ${e}`}});console.log("Coupons received:",t.data),f(t.data.map((e=>({...e,usageCount:e.usageCount||0}))))}catch(t){console.error("Error fetching coupons:",(null==(e=t.response)?void 0:e.data)||t),a.error("Error fetching coupons")}};return t.jsxs("div",{className:"p-6 bg-white shadow-md rounded-lg",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h2",{className:"text-xl font-semibold",children:"Manage Coupons"}),t.jsx("button",{onClick:()=>{b({...j,code:"RTG-"}),C(!0)},className:"bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-all",children:"+ Add Coupon"})]}),t.jsx("div",{className:"h-80",children:t.jsx(o,{rows:g,columns:[{field:"code",headerName:"Coupon Code",flex:1},{field:"discountType",headerName:"Type",flex:1},{field:"discountValue",headerName:"Discount",flex:1},{field:"minPaidHours",headerName:"Min Hours",flex:1},{field:"minAmount",headerName:"Min Amount",flex:1},{field:"maxUses",headerName:"Max Uses",flex:1},{field:"usageCount",headerName:"Total Used",flex:1},{field:"expiresAt",headerName:"Expires At"},{field:"actions",headerName:"Actions",flex:1,renderCell:e=>t.jsx("button",{className:"text-red-500 hover:text-red-700",onClick:()=>(async e=>{try{await s.delete(`${x}/api/coupons/${e}`),a.success("Coupon deleted successfully"),A()}catch(t){a.error("Error deleting coupon")}})(e.row._id),children:t.jsx(n,{size:20})})}],pageSize:5,getRowId:e=>e._id})}),t.jsxs(r,{open:v,onClose:()=>C(!1),children:[t.jsx(l,{children:"Add New Coupon"}),t.jsxs(i,{className:"space-y-4 p-6",children:[t.jsx(d,{fullWidth:!0,label:"Coupon Code",value:j.code,onChange:e=>b({...j,code:e.target.value.startsWith("RTG-")?e.target.value:`RTG-${e.target.value}`}),InputProps:{endAdornment:t.jsx(c,{position:"end",children:t.jsx(u,{onClick:()=>b({...j,code:`RTG-${Math.random().toString(36).substr(2,6).toUpperCase()}`}),children:t.jsx(h,{})})})},helperText:"Click the reload icon to generate a random code or enter manually (must start with RTG-)."}),t.jsxs(d,{select:!0,fullWidth:!0,label:"Discount Type",value:j.discountType,onChange:e=>b({...j,discountType:e.target.value}),children:[t.jsx(m,{value:"fixed",children:"Fixed Amount"}),t.jsx(m,{value:"percentage",children:"Percentage"})]}),t.jsx(d,{fullWidth:!0,label:"Discount Value",type:"number",value:j.discountValue,onChange:e=>b({...j,discountValue:e.target.value})}),t.jsx(d,{fullWidth:!0,label:"Min Paid Hours",type:"number",value:j.minPaidHours,onChange:e=>b({...j,minPaidHours:e.target.value})}),t.jsx(d,{fullWidth:!0,label:"Min Amount",type:"number",value:j.minAmount,onChange:e=>b({...j,minAmount:e.target.value})}),t.jsx(d,{fullWidth:!0,label:"Max Uses (0 = unlimited)",type:"number",value:j.maxUses,onChange:e=>b({...j,maxUses:e.target.value})}),t.jsx(d,{fullWidth:!0,label:"Expiration Date",type:"date",InputLabelProps:{shrink:!0},value:j.expiresAt,onChange:e=>b({...j,expiresAt:e.target.value})}),t.jsxs("div",{className:"flex justify-end gap-3",children:[t.jsx(p,{onClick:()=>C(!1),color:"secondary",children:"Cancel"}),t.jsx(p,{onClick:async()=>{var e;if(j.code.startsWith("RTG-"))try{await s.post(`${x}/api/coupons/create`,j,{headers:{Authorization:`Bearer ${y}`}}),a.success("Coupon created successfully!"),C(!1),A()}catch(t){a.error(null==(e=t.response)?void 0:e.data.error)}else a.error("Coupon code must start with RTG-")},color:"primary",variant:"contained",children:"Create"})]})]})]})]})};export{g as default};
