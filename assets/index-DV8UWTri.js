import{r as t,M as L,j as y,o as z,P as S,I as b,q as A,J as D}from"./index-DrMvIKwq.js";class K extends t.Component{getSnapshotBeforeUpdate(c){const e=this.props.childRef.current;if(e&&c.isPresent&&!this.props.isPresent){const n=this.props.sizeRef.current;n.height=e.offsetHeight||0,n.width=e.offsetWidth||0,n.top=e.offsetTop,n.left=e.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function T({children:i,isPresent:c}){const e=t.useId(),n=t.useRef(null),C=t.useRef({width:0,height:0,top:0,left:0}),{nonce:a}=t.useContext(L);return t.useInsertionEffect(()=>{const{width:l,height:r,top:h,left:s}=C.current;if(c||!n.current||!l||!r)return;n.current.dataset.motionPopId=e;const u=document.createElement("style");return a&&(u.nonce=a),document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`
          [data-motion-pop-id="${e}"] {
            position: absolute !important;
            width: ${l}px !important;
            height: ${r}px !important;
            top: ${h}px !important;
            left: ${s}px !important;
          }
        `),()=>{document.head.removeChild(u)}},[c]),y.jsx(K,{isPresent:c,childRef:n,sizeRef:C,children:t.cloneElement(i,{ref:n})})}const U=({children:i,initial:c,isPresent:e,onExitComplete:n,custom:C,presenceAffectsLayout:a,mode:l})=>{const r=z(q),h=t.useId(),s=t.useCallback(d=>{r.set(d,!0);for(const x of r.values())if(!x)return;n&&n()},[r,n]),u=t.useMemo(()=>({id:h,initial:c,isPresent:e,custom:C,onExitComplete:s,register:d=>(r.set(d,!1),()=>r.delete(d))}),a?[Math.random(),s]:[e,s]);return t.useMemo(()=>{r.forEach((d,x)=>r.set(x,!1))},[e]),t.useEffect(()=>{!e&&!r.size&&n&&n()},[e]),l==="popLayout"&&(i=y.jsx(T,{isPresent:e,children:i})),y.jsx(S.Provider,{value:u,children:i})};function q(){return new Map}const R=i=>i.key||"";function v(i){const c=[];return t.Children.forEach(i,e=>{t.isValidElement(e)&&c.push(e)}),c}const F=({children:i,custom:c,initial:e=!0,onExitComplete:n,presenceAffectsLayout:C=!0,mode:a="sync",propagate:l=!1})=>{const[r,h]=b(l),s=t.useMemo(()=>v(i),[i]),u=l&&!r?[]:s.map(R),d=t.useRef(!0),x=t.useRef(s),g=z(()=>new Map),[I,k]=t.useState(s),[p,j]=t.useState(s);A(()=>{d.current=!1,x.current=s;for(let f=0;f<p.length;f++){const o=R(p[f]);u.includes(o)?g.delete(o):g.get(o)!==!0&&g.set(o,!1)}},[p,u.length,u.join("-")]);const E=[];if(s!==I){let f=[...s];for(let o=0;o<p.length;o++){const m=p[o],P=R(m);u.includes(P)||(f.splice(o,0,m),E.push(m))}a==="wait"&&E.length&&(f=E),j(v(f)),k(s);return}const{forceRender:M}=t.useContext(D);return y.jsx(y.Fragment,{children:p.map(f=>{const o=R(f),m=l&&!r?!1:s===p||u.includes(o),P=()=>{if(g.has(o))g.set(o,!0);else return;let w=!0;g.forEach($=>{$||(w=!1)}),w&&(M==null||M(),j(x.current),l&&(h==null||h()),n&&n())};return y.jsx(U,{isPresent:m,initial:!d.current||e?void 0:!1,custom:m?void 0:c,presenceAffectsLayout:C,mode:a,onExitComplete:m?void 0:P,children:f},o)})})};export{F as A};
