import{r as s,ci as Z,b as J,bg as K,j as e,g as t,aF as h,aR as Y,aS as ee,bZ as ae,b$ as u,c0 as x,c1 as m,c2 as j,a4 as n,a2 as te,aW as o}from"./vendor-CRYhOL6r.js";const se="https://rubertogo.com",ne=()=>{const[v,A]=s.useState([]),[i,l]=s.useState(!1),[N,g]=s.useState(null),[c,O]=s.useState(null),[P,w]=s.useState(!1),[I,R]=s.useState(!1),[B,C]=s.useState(!1),[b,D]=s.useState(""),[d,k]=s.useState(null),[S,F]=s.useState(null),[$,W]=s.useState(!1),q=Z("(max-width: 1024px)"),M=localStorage.getItem("accessToken"),p=J.create({baseURL:se,headers:{Authorization:`Bearer ${M}`}}),f=async()=>{l(!0);try{const a=await p.get("/api/withdrawals");A(a.data.withdrawals||[])}catch(a){console.error("Fetch Withdrawals Error:",a.response?.data||a.message),o.error("Failed to fetch withdrawals.")}finally{l(!1)}},U=async()=>{if(!d){o.error("Please upload a payment receipt before approving.");return}const a=new FormData;a.append("file",d),l(!0);try{const X=(await p.post("/api/upload",a,{headers:{"Content-Type":"multipart/form-data"}})).data.imageURL;await p.put(`/api/withdrawals/${N}`,{status:"approved",paymentReceipt:X}),o.success("Withdrawal approved successfully."),f(),r()}catch(y){console.error("Approval Error:",y.response?.data||y.message),o.error("Failed to approve withdrawal.")}finally{l(!1)}},T=async()=>{if(!b.trim()){o.info("Please provide a reason for rejection.");return}l(!0);try{await p.put(`/api/withdrawals/${N}`,{status:"rejected",rejectionReason:b}),o.success("Withdrawal rejected successfully."),f(),r()}catch(a){console.error("Rejection Error:",a.response?.data||a.message),o.error("Failed to reject withdrawal.")}finally{l(!1)}},E=a=>{F(a),W(!0)},L=a=>{g(a),R(!0)},z=a=>{g(a),C(!0)},V=a=>{O(a),w(!0)},r=()=>{g(null),D(""),k(null),R(!1),C(!1),w(!1),W(!1)};s.useEffect(()=>{f()},[]);const{getRootProps:G,getInputProps:H,isDragActive:_}=K({accept:"image/*",multiple:!1,onDrop:a=>k(a[0])}),Q=[{field:"partnerName",headerName:"Partner Name",width:200},{field:"amount",headerName:"Amount (USD)",width:150},{field:"requestDate",headerName:"Requested On",width:200,renderCell:a=>new Date(a.value).toLocaleDateString()},{field:"status",headerName:"Status",width:150,renderCell:a=>e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${a.value==="approved"?"bg-green-100 text-green-600":a.value==="rejected"?"bg-red-100 text-red-600":"bg-yellow-100 text-yellow-600"}`,children:a.value.charAt(0).toUpperCase()+a.value.slice(1)})},{field:"actions",headerName:"Actions",width:400,renderCell:a=>e.jsx("div",{className:"flex gap-4",children:a.row.status==="pending"?e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"contained",color:"primary",onClick:()=>V(a.row.bankDetails),children:"View Bank Details"}),e.jsx(n,{variant:"contained",color:"success",onClick:()=>L(a.row.id),children:"Approve"}),e.jsx(n,{variant:"contained",color:"error",onClick:()=>z(a.row.id),children:"Reject"})]}):a.row.status==="approved"?e.jsx(n,{variant:"contained",color:"secondary",onClick:()=>E(a.row.paymentReceipt),children:"View Receipt"}):null})}];return e.jsxs("div",{className:"p-6 container mx-auto",children:[e.jsx(t,{variant:"h4",className:"font-bold text-gray-900 mb-8",children:"Manage Withdrawal Requests"}),e.jsx("div",{style:{height:500,width:"100%"},children:i?e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(h,{})}):q?e.jsx("div",{className:"space-y-4",children:v.map(a=>e.jsx(Y,{className:"shadow-lg",children:e.jsxs(ee,{children:[e.jsxs(t,{variant:"h6",children:[e.jsx("strong",{children:"Partner Name:"})," ",a.partnerId.firstName," ",a.partnerId.lastName]}),e.jsxs(t,{children:[e.jsx("strong",{children:"Amount:"})," $",a.amount.toFixed(2)]}),e.jsxs(t,{children:[e.jsx("strong",{children:"Requested On:"})," ",new Date(a.requestDate).toLocaleDateString()]}),e.jsxs(t,{children:[e.jsx("strong",{children:"Status:"})," ",e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${a.status==="approved"?"bg-green-100 text-green-600":a.status==="rejected"?"bg-red-100 text-red-600":"bg-yellow-100 text-yellow-600"}`,children:a.status.charAt(0).toUpperCase()+a.status.slice(1)})]})]})},a._id))}):e.jsx("div",{style:{height:500,width:"100%"},children:e.jsx(ae,{rows:v.map(a=>({id:a._id,partnerName:`${a.partnerId.firstName} ${a.partnerId.lastName}`,...a})),columns:Q,pageSize:5,rowsPerPageOptions:[5,10],disableSelectionOnClick:!0,sx:{"& .MuiDataGrid-root":{overflowX:"auto"},"& .MuiDataGrid-cell":{whiteSpace:"nowrap"}}})})}),e.jsxs(u,{open:P,onClose:r,maxWidth:"sm",fullWidth:!0,className:"max-w-full",children:[e.jsx(x,{children:e.jsx(t,{variant:"h5",className:"font-bold text-center",children:"Bank Details of Partner"})}),e.jsx(m,{children:c?e.jsxs("div",{className:"p-4",children:[e.jsxs(t,{variant:"body1",className:"mb-4 text-gray-700 border-b pb-2",children:[e.jsx("strong",{children:"Bank Name:"})," ",c.bankName]}),e.jsxs(t,{variant:"body1",className:"mb-4 text-gray-700 border-b pb-2",children:[e.jsx("strong",{children:"Account Holder Name:"})," ",c.accountHolderName]}),e.jsxs(t,{variant:"body1",className:"mb-4 text-gray-700 border-b pb-2",children:[e.jsx("strong",{children:"Account Number:"})," ",c.accountNumber]}),e.jsxs(t,{variant:"body1",className:"mb-4 text-gray-700 border-b pb-2",children:[e.jsx("strong",{children:"Branch Name:"})," ",c.branchName]}),e.jsxs(t,{variant:"body1",className:"mb-4 text-gray-700 border-b pb-2",children:[e.jsx("strong",{children:"SWIFT Code:"})," ",c.swiftCode]})]}):e.jsx(t,{variant:"body1",className:"text-gray-600",children:"No bank details available."})}),e.jsx(j,{children:e.jsx(n,{onClick:r,variant:"contained",color:"primary",className:"mx-auto",style:{minWidth:"150px"},children:"Close"})})]}),e.jsxs(u,{open:I,onClose:r,maxWidth:"sm",fullWidth:!0,className:"max-w-full",children:[e.jsx(x,{children:"Approve Withdrawal Request"}),e.jsxs(m,{children:[e.jsx(t,{variant:"body2",className:"mb-4",children:"Upload the payment receipt for approval."}),e.jsxs("div",{...G(),className:`border-2 border-dashed p-4 text-center ${_?"border-green-500":"border-gray-400"}`,children:[e.jsx("input",{...H()}),d?e.jsx(t,{variant:"body1",children:d.name}):e.jsx(t,{variant:"body2",children:"Drag & drop or click to upload receipt"})]})]}),e.jsxs(j,{children:[e.jsx(n,{onClick:r,color:"primary",children:"Cancel"}),e.jsx(n,{onClick:U,color:"success",disabled:i,children:i?e.jsx(h,{size:20,color:"inherit"}):"Approve"})]})]}),e.jsxs(u,{open:B,onClose:r,maxWidth:"sm",fullWidth:!0,className:"max-w-full",children:[e.jsx(x,{children:"Reject Withdrawal Request"}),e.jsx(m,{children:e.jsx(te,{label:"Rejection Reason",variant:"outlined",fullWidth:!0,multiline:!0,rows:4,value:b,onChange:a=>D(a.target.value)})}),e.jsxs(j,{children:[e.jsx(n,{onClick:r,color:"primary",children:"Cancel"}),e.jsx(n,{onClick:T,color:"error",disabled:i,children:i?e.jsx(h,{size:20,color:"inherit"}):"Reject"})]})]}),e.jsxs(u,{open:$,onClose:r,fullWidth:!0,children:[e.jsx(x,{children:e.jsx(t,{variant:"h5",className:"font-bold text-center",children:"Payment Receipt"})}),e.jsx(m,{children:i?e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(h,{})}):S?e.jsx("img",{src:S,alt:"Payment Receipt",style:{width:"100%",height:"auto"},onLoad:()=>l(!1)}):e.jsx(t,{className:"text-center text-gray-600",children:"No receipt available."})}),e.jsx(j,{children:e.jsx(n,{onClick:r,variant:"contained",color:"primary",style:{minWidth:"100px"},children:"Close"})})]})]})};export{ne as default};
