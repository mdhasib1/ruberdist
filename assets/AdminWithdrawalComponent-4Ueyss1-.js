import{r as s,cs as J,b as K,bs as Y,j as e,m as a,C as h,b2 as Z,b3 as ee,D as te,ca as u,cb as x,cc as m,cd as j,B as n,a9 as ae,f as o}from"./vendor-C2yKzKC1.js";const se="https://www.rubertogo.com",ne=()=>{const[v,W]=s.useState([]),[i,l]=s.useState(!1),[N,g]=s.useState(null),[c,O]=s.useState(null),[P,w]=s.useState(!1),[I,R]=s.useState(!1),[B,C]=s.useState(!1),[b,D]=s.useState(""),[d,k]=s.useState(null),[S,q]=s.useState(null),[F,A]=s.useState(!1),M=J("(max-width: 1024px)"),U=localStorage.getItem("accessToken"),p=K.create({baseURL:se,headers:{Authorization:`Bearer ${U}`}}),f=async()=>{l(!0);try{const t=await p.get("/api/withdrawals");W(t.data.withdrawals||[])}catch(t){console.error("Fetch Withdrawals Error:",t.response?.data||t.message),o.error("Failed to fetch withdrawals.")}finally{l(!1)}},$=async()=>{if(!d){o.error("Please upload a payment receipt before approving.");return}const t=new FormData;t.append("file",d),l(!0);try{const X=(await p.post("/api/upload",t,{headers:{"Content-Type":"multipart/form-data"}})).data.imageURL;await p.put(`/api/withdrawals/${N}`,{status:"approved",paymentReceipt:X}),o.success("Withdrawal approved successfully."),f(),r()}catch(y){console.error("Approval Error:",y.response?.data||y.message),o.error("Failed to approve withdrawal.")}finally{l(!1)}},T=async()=>{if(!b.trim()){o.info("Please provide a reason for rejection.");return}l(!0);try{await p.put(`/api/withdrawals/${N}`,{status:"rejected",rejectionReason:b}),o.success("Withdrawal rejected successfully."),f(),r()}catch(t){console.error("Rejection Error:",t.response?.data||t.message),o.error("Failed to reject withdrawal.")}finally{l(!1)}},E=t=>{q(t),A(!0)},L=t=>{g(t),R(!0)},z=t=>{g(t),C(!0)},V=t=>{O(t),w(!0)},r=()=>{g(null),D(""),k(null),R(!1),C(!1),w(!1),A(!1)};s.useEffect(()=>{f()},[]);const{getRootProps:G,getInputProps:H,isDragActive:_}=Y({accept:"image/*",multiple:!1,onDrop:t=>k(t[0])}),Q=[{field:"partnerName",headerName:"Partner Name",width:200},{field:"amount",headerName:"Amount (USD)",width:150},{field:"requestDate",headerName:"Requested On",width:200,renderCell:t=>new Date(t.value).toLocaleDateString()},{field:"status",headerName:"Status",width:150,renderCell:t=>e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${t.value==="approved"?"bg-green-100 text-green-600":t.value==="rejected"?"bg-red-100 text-red-600":"bg-yellow-100 text-yellow-600"}`,children:t.value.charAt(0).toUpperCase()+t.value.slice(1)})},{field:"actions",headerName:"Actions",width:400,renderCell:t=>e.jsx("div",{className:"flex gap-4",children:t.row.status==="pending"?e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"contained",color:"primary",onClick:()=>V(t.row.bankDetails),children:"View Bank Details"}),e.jsx(n,{variant:"contained",color:"success",onClick:()=>L(t.row.id),children:"Approve"}),e.jsx(n,{variant:"contained",color:"error",onClick:()=>z(t.row.id),children:"Reject"})]}):t.row.status==="approved"?e.jsx(n,{variant:"contained",color:"secondary",onClick:()=>E(t.row.paymentReceipt),children:"View Receipt"}):null})}];return e.jsxs("div",{className:"p-6 container mx-auto",children:[e.jsx(a,{variant:"h4",className:"font-bold text-gray-900 mb-8",children:"Manage Withdrawal Requests"}),e.jsx("div",{style:{height:500,width:"100%"},children:i?e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(h,{})}):M?e.jsx("div",{className:"space-y-4",children:v.map(t=>e.jsx(Z,{className:"shadow-lg",children:e.jsxs(ee,{children:[e.jsxs(a,{variant:"h6",children:[e.jsx("strong",{children:"Partner Name:"})," ",t.partnerId.firstName," ",t.partnerId.lastName]}),e.jsxs(a,{children:[e.jsx("strong",{children:"Amount:"})," $",t.amount.toFixed(2)]}),e.jsxs(a,{children:[e.jsx("strong",{children:"Requested On:"})," ",new Date(t.requestDate).toLocaleDateString()]}),e.jsxs(a,{children:[e.jsx("strong",{children:"Status:"})," ",e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${t.status==="approved"?"bg-green-100 text-green-600":t.status==="rejected"?"bg-red-100 text-red-600":"bg-yellow-100 text-yellow-600"}`,children:t.status.charAt(0).toUpperCase()+t.status.slice(1)})]})]})},t._id))}):e.jsx("div",{style:{height:500,width:"100%"},children:e.jsx(te,{rows:v.map(t=>({id:t._id,partnerName:`${t.partnerId.firstName} ${t.partnerId.lastName}`,...t})),columns:Q,pageSize:5,rowsPerPageOptions:[5,10],disableSelectionOnClick:!0,sx:{"& .MuiDataGrid-root":{overflowX:"auto"},"& .MuiDataGrid-cell":{whiteSpace:"nowrap"}}})})}),e.jsxs(u,{open:P,onClose:r,maxWidth:"sm",fullWidth:!0,className:"max-w-full",children:[e.jsx(x,{children:e.jsx(a,{variant:"h5",className:"font-bold text-center",children:"Bank Details of Partner"})}),e.jsx(m,{children:c?e.jsxs("div",{className:"p-4",children:[e.jsxs(a,{variant:"body1",className:"mb-4 text-gray-700 border-b pb-2",children:[e.jsx("strong",{children:"Bank Name:"})," ",c.bankName]}),e.jsxs(a,{variant:"body1",className:"mb-4 text-gray-700 border-b pb-2",children:[e.jsx("strong",{children:"Account Holder Name:"})," ",c.accountHolderName]}),e.jsxs(a,{variant:"body1",className:"mb-4 text-gray-700 border-b pb-2",children:[e.jsx("strong",{children:"Account Number:"})," ",c.accountNumber]}),e.jsxs(a,{variant:"body1",className:"mb-4 text-gray-700 border-b pb-2",children:[e.jsx("strong",{children:"Branch Name:"})," ",c.branchName]}),e.jsxs(a,{variant:"body1",className:"mb-4 text-gray-700 border-b pb-2",children:[e.jsx("strong",{children:"SWIFT Code:"})," ",c.swiftCode]})]}):e.jsx(a,{variant:"body1",className:"text-gray-600",children:"No bank details available."})}),e.jsx(j,{children:e.jsx(n,{onClick:r,variant:"contained",color:"primary",className:"mx-auto",style:{minWidth:"150px"},children:"Close"})})]}),e.jsxs(u,{open:I,onClose:r,maxWidth:"sm",fullWidth:!0,className:"max-w-full",children:[e.jsx(x,{children:"Approve Withdrawal Request"}),e.jsxs(m,{children:[e.jsx(a,{variant:"body2",className:"mb-4",children:"Upload the payment receipt for approval."}),e.jsxs("div",{...G(),className:`border-2 border-dashed p-4 text-center ${_?"border-green-500":"border-gray-400"}`,children:[e.jsx("input",{...H()}),d?e.jsx(a,{variant:"body1",children:d.name}):e.jsx(a,{variant:"body2",children:"Drag & drop or click to upload receipt"})]})]}),e.jsxs(j,{children:[e.jsx(n,{onClick:r,color:"primary",children:"Cancel"}),e.jsx(n,{onClick:$,color:"success",disabled:i,children:i?e.jsx(h,{size:20,color:"inherit"}):"Approve"})]})]}),e.jsxs(u,{open:B,onClose:r,maxWidth:"sm",fullWidth:!0,className:"max-w-full",children:[e.jsx(x,{children:"Reject Withdrawal Request"}),e.jsx(m,{children:e.jsx(ae,{label:"Rejection Reason",variant:"outlined",fullWidth:!0,multiline:!0,rows:4,value:b,onChange:t=>D(t.target.value)})}),e.jsxs(j,{children:[e.jsx(n,{onClick:r,color:"primary",children:"Cancel"}),e.jsx(n,{onClick:T,color:"error",disabled:i,children:i?e.jsx(h,{size:20,color:"inherit"}):"Reject"})]})]}),e.jsxs(u,{open:F,onClose:r,fullWidth:!0,children:[e.jsx(x,{children:e.jsx(a,{variant:"h5",className:"font-bold text-center",children:"Payment Receipt"})}),e.jsx(m,{children:i?e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(h,{})}):S?e.jsx("img",{src:S,alt:"Payment Receipt",style:{width:"100%",height:"auto"},onLoad:()=>l(!1)}):e.jsx(a,{className:"text-center text-gray-600",children:"No receipt available."})}),e.jsx(j,{children:e.jsx(n,{onClick:r,variant:"contained",color:"primary",style:{minWidth:"100px"},children:"Close"})})]})]})};export{ne as default};
