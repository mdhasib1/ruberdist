import{r as o,u as he,a as ue,j as e,L as xe,d as c,F as d}from"./index-DrMvIKwq.js";import{_ as ge,$ as J,V as fe,a0 as Q}from"./index-y5yuKkc0.js";import{V as je}from"./VanLoading-B2lqwOkK.js";import{D as ye}from"./DataGrid-odPpneuv.js";import{I as b}from"./IconButton-BGQYt6kH.js";import{M as X}from"./Menu-ComLaOXz.js";import{M as l}from"./MenuItem-8srXigvG.js";import{M as Y}from"./Modal-CfkloFEy.js";import{T as w}from"./Typography-BAti9wpa.js";import{T as N}from"./TextField-DvirranI.js";import{B as f}from"./Button-xUQB_oWD.js";import{D as be,a as we}from"./DialogContent-B3_vuZ-u.js";import{D as Ne}from"./DialogTitle-D6X8JJ-q.js";import{D as ve}from"./DialogActions-D_0ZQhiH.js";import{C as Ce}from"./CircularProgress-B5agUqRt.js";import"./iconBase-BBLIWj70.js";import"./createSimplePaletteValueFilter-zjTMkHT-.js";import"./index-COvJ5x3S.js";import"./Portal-BMjECl0g.js";import"./Select-DJdQC6kX.js";import"./useControlled-Bio4-BJG.js";import"./createSvgIcon-CgYohZ5P.js";import"./List-BLDT_Zsz.js";import"./index-pDPmJGlT.js";import"./useTheme-CepysXf6.js";import"./Close-CZtWXSiP.js";import"./useSlot-BWhg9WXJ.js";import"./Badge-Dv4pCkXf.js";import"./Grow-B1pBNw31.js";import"./useTheme-C3_UZ2QD.js";import"./Paper-C4BDKHkT.js";import"./Tooltip-BJxLh1tU.js";import"./Chip-BGAMkzyn.js";import"./ClickAwayListener-CKDzE_Pj.js";import"./Toolbar-IXigYXsH.js";import"./ListItemText-CPFOLNaz.js";import"./listItemTextClasses--ZWm_3O6.js";import"./InputAdornment-qRqOoZAt.js";import"./Divider-DKVgf2v9.js";import"./dividerClasses-CP17GPn_.js";import"./FormControlLabel-B2fud-Wt.js";import"./TableCell-Cv6TnrlD.js";import"./Skeleton-BNpbg8au.js";import"./isMuiElement-LlRumiQy.js";const m="https://rubertogo.com",xa=()=>{const[I,v]=o.useState([]),[Z,B]=o.useState(!0),[n,$]=o.useState(null),[i,ee]=o.useState(null),[ae,C]=o.useState(!1),[h,j]=o.useState([]),[O,x]=o.useState(!1),{lang:S}=he(),[se,z]=o.useState(!1),[y,D]=o.useState(null),[te,k]=o.useState(!1),[g,A]=o.useState([]),[re,F]=o.useState([]),[U,P]=o.useState(""),R=ue(),V=localStorage.getItem("accessToken");o.useEffect(()=>{B(!0),(async()=>{try{const t=(await c.get(`${m}/api/vans/admin/all`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}})).data.map(r=>{var u,p;return{id:r._id,vanName:((u=r.name)==null?void 0:u.en)||"N/A",model:r.transmissionType||"N/A",regNumber:r.plateNumber||"N/A",capacity:((p=r.weight)==null?void 0:p.maxLoad)||"N/A",status:r.status||"pending"}});v(t)}catch(s){console.error("Error fetching van data:",s)}finally{B(!1)}})()},[]);const L=(a,s)=>{$({element:a.currentTarget,id:s.id}),ee(s)},K=()=>{$(null)},oe=async()=>{if(!y||h.length!==7||h.some(a=>!a.pricePerHour||!a.kilometers||!a.extraPerKm)){d.error("Please provide valid pricing for all 7 days.");return}try{x(!0),await c.put(`${m}/api/vans/${y}/approve`,{dailyPricing:h},{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}}),d.success("Van approved successfully."),v(a=>a.map(s=>s.id===y?{...s,status:"approved"}:s)),C(!1),j([])}catch{d.error("Failed to approve van. Please try again.")}finally{x(!1)}},H=async()=>{try{await c.put(`${m}/api/vans/${i.id}/reject`),d.success("Van rejected successfully."),v(a=>a.map(s=>s.id===i.id?{...s,status:"rejected"}:s)),$(null)}catch(a){console.error("Error rejecting van:",a),d.error("Failed to reject van. Please try again.")}},M=(a,s,t)=>{const r=[...h];r[a]={...r[a],[s]:t},j(r)},_=a=>{D(a),z(!0)},E=()=>{D(null),z(!1)},le=async()=>{try{await c.delete(`${m}/api/vans/${y}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}}),v(a=>a.filter(s=>s.id!==y)),d.success("Van deleted successfully.")}catch{d.error("Failed to delete van.")}finally{E()}},G=async a=>{D(a);try{const s=await c.get(`${m}/api/vans/${a}/pricing`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});s.data?j(s.data):j(new Array(7).fill({pricePerHour:"",kilometers:"",extraPerKm:""}))}catch(s){console.error("Error fetching daily pricing:",s),j(new Array(7).fill({pricePerHour:"",kilometers:"",extraPerKm:""}))}C(!0)},ne=()=>{A([...g,{damageType:"",description:"",image:null,imageUrl:""}])},T=(a,s,t)=>{const r=[...g];r[a][s]=t,A(r)},ie=a=>{const s=g.filter((t,r)=>r!==a);A(s)},ce=async a=>{try{const s=await c.delete(`${m}/api/vans/${i.id}/contracts`,{headers:{Authorization:`Bearer ${V}`},params:{imageId:a}});s.status===201&&(k(!1),d.success(s.data.message)),F(t=>t.filter(r=>r.image!==a))}catch(s){console.error("Error removing contract image:",s),P("Failed to remove contract image. Please try again.")}},de=async(a,s)=>{try{const t=new FormData;t.append("file",a),x(!0);const u=(await c.post(`${m}/api/upload`,t,{headers:{"Content-Type":"multipart/form-data"}})).data.imageURL;T(s,"imageUrl",u)}catch(t){console.error("Error uploading image:",t),P("Image upload failed. Please try again.")}finally{x(!1)}},me=async()=>{if(g.some(a=>!a.damageType||!a.description||!a.imageUrl)){P("Please complete all fields for each contract.");return}x(!0),P("");try{const a=g.map(t=>({damageType:t.damageType,description:t.description,image:t.imageUrl})),s=await c.post(`${m}/api/vans/${i.id}/contracts`,a,{headers:{Authorization:`Bearer ${V}`}});F(t=>[...t,...a]),A([]),k(!1)}catch(a){console.warn("Error saving contracts:",a)}finally{x(!1)}},W=()=>{k(!1)},q=async()=>{if(i)try{const a=await c.get(`${m}/api/vans/contracts/${i.id}`,{headers:{Authorization:`Bearer ${V}`}});F(a.data||[])}catch{d.error("Failed to load contract images. Please try again.")}finally{k(!0)}},pe=[{field:"vanName",headerName:"Van Name",width:200},{field:"model",headerName:"Transmission Type",width:150},{field:"regNumber",headerName:"Registration Number",width:200},{field:"capacity",headerName:"Max Load Capacity",width:150},{field:"status",headerName:"Status",width:150,renderCell:a=>e.jsx("span",{className:`px-2 py-1 rounded-full text-white ${a.value==="approved"?"bg-green-500":a.value==="rejected"?"bg-red-500":"bg-yellow-500"}`,children:a.value})},{field:"actions",headerName:"Actions",width:150,renderCell:a=>e.jsxs(e.Fragment,{children:[e.jsx(b,{onClick:s=>L(s,a.row),children:e.jsx(J,{})}),e.jsxs(X,{anchorEl:n==null?void 0:n.element,open:!!n&&(n==null?void 0:n.id)===a.row.id,onClose:K,children:[a.row.status!=="approved"&&a.row.status!=="rejected"&&e.jsxs(e.Fragment,{children:[e.jsx(l,{onClick:()=>G(a.row.id),children:"Approve"}),e.jsx(l,{onClick:H,children:"Reject"})]}),e.jsx(l,{onClick:()=>R(`/${S}/admin/vans/edit-van/${a.row.id}`),children:"Edit Van"}),e.jsx(l,{onClick:()=>q(),children:"Add/Edit Contracts"}),e.jsx(l,{onClick:()=>_(a.row.id),children:"Delete Van"})]})]})}];return Z?e.jsx(je,{vanImageUrl:"/runvan.png"}):e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-800",children:"All Vans"}),e.jsx(xe,{to:`/${S}/admin/vans/add`,className:"text-blue-500 hover:underline",children:e.jsxs("button",{className:"bg-green-500 text-white px-4 py-2 rounded-lg shadow hover:bg-green-600 transition duration-200 flex items-center space-x-2",children:[e.jsx(ge,{}),e.jsx("span",{children:"Add New Van"})]})})]}),e.jsxs("div",{className:"w-full overflow-auto",style:{height:400},children:[e.jsx("div",{className:"hidden sm:block",children:e.jsx(ye,{rows:I,columns:pe,pageSize:5,rowsPerPageOptions:[5],disableSelectionOnClick:!0})}),e.jsx("div",{className:"block sm:hidden",children:I.map(a=>e.jsxs("div",{className:"bg-white shadow-md rounded-lg mb-4 p-4",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Van Name:"})," ",a.vanName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Transmission:"})," ",a.model]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Registration Number:"})," ",a.regNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Max Load Capacity:"})," ",a.capacity]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",e.jsx("span",{className:`px-2 py-1 rounded-full text-white ${a.status==="approved"?"bg-green-500":a.status==="rejected"?"bg-red-500":"bg-yellow-500"}`,children:a.status}),e.jsx(b,{onClick:s=>L(s,a),className:"text-gray-600 hover:text-black",children:e.jsx(J,{})}),e.jsxs(X,{anchorEl:n,open:!!(n&&(i==null?void 0:i.id)===a.id),onClose:K,className:"sm:hidden",children:[a.status!=="approved"&&a.status!=="rejected"&&e.jsxs(e.Fragment,{children:[e.jsx(l,{onClick:()=>G(a.id),children:"Approve"}),e.jsx(l,{onClick:()=>H(a.id),children:"Reject"})]}),e.jsx(l,{onClick:()=>R(`/${S}/admin/vans/edit-van/${a.id}`),children:"Edit Van"}),e.jsx(l,{onClick:()=>q(a.id),children:"Add/Edit Contracts"}),e.jsx(l,{onClick:()=>_(a.id),children:"Delete Van"})]})]})]},a.id))})]}),e.jsx(Y,{open:ae,onClose:()=>C(!1),children:e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-60 z-50 px-4 sm:px-0",children:e.jsxs("div",{className:"w-full container sm:max-w-4xl bg-white rounded-lg shadow-lg p-6",children:[e.jsx(w,{variant:"h5",className:"text-2xl font-bold text-gray-800 mb-6 text-center border-b border-gray-200 pb-4",children:"Approve Van"}),e.jsx("div",{className:"space-y-4",children:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map((a,s)=>{var t,r,u;return e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4",children:[e.jsx(w,{className:"flex-1 text-gray-600",children:a}),e.jsx(N,{label:"Price Per Hour",type:"number",value:((t=h[s])==null?void 0:t.pricePerHour)||"",onChange:p=>M(s,"pricePerHour",p.target.value),className:"flex-1 w-full"}),e.jsx(N,{label:"Kilometers",type:"number",value:((r=h[s])==null?void 0:r.kilometers)||"",onChange:p=>M(s,"kilometers",p.target.value),className:"flex-1 w-full"}),e.jsx(N,{label:"Extra Per Km",type:"number",value:((u=h[s])==null?void 0:u.extraPerKm)||"",onChange:p=>M(s,"extraPerKm",p.target.value),className:"flex-1 w-full"})]},a)})}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-4",children:[e.jsx(f,{variant:"outlined",onClick:()=>C(!1),className:"rounded-md",children:"Cancel"}),e.jsx(f,{variant:"contained",onClick:oe,className:"bg-green-500 text-white rounded-md",children:"Approve Van"})]})]})})}),e.jsxs(be,{open:se,onClose:E,"aria-labelledby":"confirm-dialog-title","aria-describedby":"confirm-dialog-description",children:[e.jsx(Ne,{id:"confirm-dialog-title",children:"Confirm Deletion"}),e.jsx(we,{children:e.jsx(w,{id:"confirm-dialog-description",children:"Are you sure you want to delete this van? This action cannot be undone."})}),e.jsxs(ve,{children:[e.jsx(f,{onClick:E,color:"primary",children:"Cancel"}),e.jsx(f,{onClick:le,color:"error",variant:"contained",children:"Confirm"})]})]}),e.jsx(Y,{open:te,onClose:W,children:e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-60 z-50 px-4 sm:px-0",children:e.jsxs("div",{className:"w-full container sm:max-w-4xl bg-white rounded-lg shadow-lg p-6 relative transform transition-all scale-100 sm:scale-105",children:[e.jsx("button",{className:"absolute top-2 left-2",children:e.jsx(b,{onClick:W,children:e.jsx(fe,{})})}),e.jsx(w,{variant:"h5",className:"text-2xl font-bold text-gray-800 mb-6 text-center border-b border-gray-200 pb-4",children:"Add/Edit Contracts"}),e.jsx("div",{className:"overflow-x-auto mb-6",children:e.jsxs("table",{className:"min-w-full bg-white shadow rounded-lg",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 border-b",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-600 whitespace-nowrap",children:"Damage Type"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-600 whitespace-nowrap",children:"Description"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-600 whitespace-nowrap",children:"Image"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-600 whitespace-nowrap",children:"Action"})]})}),e.jsx("tbody",{children:re.map((a,s)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 px-4 text-gray-700",children:a==null?void 0:a.damageType}),e.jsx("td",{className:"py-3 px-4  text-gray-700",children:a.description}),e.jsx("td",{className:"py-3 px-4 ",children:e.jsx("img",{src:a.image,alt:"Contract",className:"w-64 h-32 objec rounded-md shadow-sm"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx(b,{onClick:()=>ce(a._id),className:"text-red-500 hover:text-red-700",children:e.jsx(Q,{})})})]},s))})]})}),g.map((a,s)=>e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4 mt-4",children:[e.jsx(N,{label:"Damage Type",variant:"outlined",value:a.damageType,onChange:t=>T(s,"damageType",t.target.value),className:"flex-1 w-full",InputProps:{className:"rounded-md shadow-sm border-gray-300 focus:ring-2 focus:ring-blue-500"}}),e.jsx(N,{label:"Description",variant:"outlined",value:a.description,onChange:t=>T(s,"description",t.target.value),className:"flex-1 w-full",InputProps:{className:"rounded-md shadow-sm border-gray-300 focus:ring-2 focus:ring-blue-500"}}),e.jsxs("div",{className:"flex-1 w-full p-2 border border-dashed rounded-md border-gray-300 cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"file",onChange:t=>{t.target.files[0]&&(de(t.target.files[0],s),T(s,"image",t.target.files[0]))}}),a.imageUrl?e.jsx("img",{src:a.imageUrl,alt:"Contract",className:"w-12 h-12 object-cover rounded-md shadow-sm"}):e.jsx("p",{className:"text-sm text-gray-400",children:"Click to upload an image"})]}),e.jsx(b,{onClick:()=>ie(s),className:"text-red-500 hover:text-red-700",children:e.jsx(Q,{})})]},s)),e.jsxs("div",{className:"mt-8 space-y-4 sm:space-y-0 sm:space-x-4 flex flex-col sm:flex-row justify-end",children:[e.jsx(f,{variant:"outlined",color:"primary",onClick:ne,className:"rounded-md shadow-sm hover:bg-blue-50",children:"Add New Contract"}),U&&e.jsx(w,{color:"error",className:"text-red-500 text-sm mt-2",children:U}),e.jsx(f,{variant:"contained",onClick:me,disabled:O,className:"bg-blue-600 text-white rounded-md shadow-md hover:bg-blue-700 transition w-full sm:w-auto",children:O?e.jsx(Ce,{size:24}):"Save Contracts"})]})]})})})]})};export{xa as default};
