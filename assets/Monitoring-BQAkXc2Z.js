import{r as n,b as S,j as t,co as _,bI as U,cq as L,az as R,cr as q,am as A,B,c7 as W,D as G,cn as d,c3 as Q,b1 as J,bN as K,aq as X,aV as ee,f as M,bO as te,bP as ae,bQ as se,bR as re,bS as le,bT as ne,bU as ie,bV as oe,bW as ce}from"./vendor-C1EOYKAv.js";import{V as de}from"./VanViewModal-uje5qKhg.js";import"./index-Dfb33l0W.js";import"./Carousel-Cqe9gu9t.js";import"./VanCard-B23MIqz5.js";import"./useVanStore-BnxYSua8.js";te.register(ae,se,re,le,ne,ie,oe,ce);const me={hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1,transition:{duration:.4,ease:"easeOut"}},hover:{scale:1.05,boxShadow:"0px 8px 20px rgba(0, 0, 0, 0.2)"}},ue={upcoming:"bg-blue-100 text-blue-600",completed:"bg-green-100 text-green-600",canceled:"bg-red-100 text-red-600",pending:"bg-yellow-100 text-yellow-600",accepted:"bg-purple-100 text-purple-600"},he=({bookings:m,onDateSelect:j})=>{const[b,y]=n.useState(null),N=(a,r)=>{const x=new Date(r,a+1,0).getDate(),f=new Date(r,a,1).getDay(),u=[];for(let l=0;l<f;l++)u.push(null);for(let l=1;l<=x;l++)u.push(new Date(r,a,l));return u},v=a=>m.some(r=>{const x=d.tz(r.startDate,"YYYY-MM-DDTHH:mm:ss",r.timeZone),f=d.tz(r.endDate,"YYYY-MM-DDTHH:mm:ss",r.timeZone);return d.tz(a,r.timeZone).startOf("day").isBetween(x,f,"day","[]")}),D=a=>{y(a),j(a)},p=new Date,i=p.getMonth(),g=p.getFullYear(),h=N(i,g);return t.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md",children:[t.jsx("h3",{className:"text-lg font-bold",children:"Booking Calendar"}),t.jsxs("div",{className:"grid grid-cols-7 gap-2 mt-4",children:[["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(a=>t.jsx("div",{className:"text-center font-bold",children:a},a)),h.map((a,r)=>t.jsx("div",{onClick:()=>a&&D(a),className:`h-12 flex items-center justify-center rounded cursor-pointer ${a?v(a)?"bg-red-200 hover:bg-red-300":"bg-gray-100 hover:bg-gray-200":"bg-transparent cursor-default"} ${b&&a&&b.toDateString()===a.toDateString()?"ring-2 ring-blue-500":""}`,children:a?a.getDate():""},r))]})]})},z="https://www.rubertogo.com",Ne=()=>{const[m,j]=n.useState([]),[b,y]=n.useState([]),[N,v]=n.useState(null),[D,p]=n.useState(!1),[i,g]=n.useState(null),[h,a]=n.useState(!1),[r,x]=n.useState(null),[f,u]=n.useState(!1),[l,I]=n.useState("all"),[P,H]=n.useState([]),F=()=>{u(!0)};n.useEffect(()=>{C()},[]);const C=async()=>{try{const e=await S.get(`${z}/api/getAllBookings`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});if(e.data.success){const s=e.data.data,o=Array.from(new Map(s.map(c=>[c.vanId._id,c.vanId])).values());j(s),y(o)}}catch(e){console.error("Error fetching bookings:",e)}},Y=()=>m.filter(e=>{const s=d.tz(e.startDate,"YYYY-MM-DDTHH:mm:ss",e.timeZone),o=d.tz(e.endDate,"YYYY-MM-DDTHH:mm:ss",e.timeZone);if(N&&e.vanId._id!==N)return!1;if(r){const c=d.tz(r,e.timeZone).startOf("day");if(!s.isSameOrAfter(c,"day")||!o.isSameOrAfter(c,"day"))return!1}return!(l!=="all"&&e.status!==l)}),V=e=>{g(e),p(!0)},w=()=>{p(!1),g(null)};n.useEffect(()=>{let e=m;l!=="all"&&(e=m.filter(o=>o.status===l));const s=[...e].sort((o,c)=>new Date(o.startDate).getTime()-new Date(c.startDate).getTime());H(s)},[l,m]);const T={labels:["Pending","Canceled","Accepted","Completed"],datasets:[{label:"Bookings",data:["pending","canceled","accepted","completed"].map(e=>Y().filter(s=>s.status===e).length),backgroundColor:["#FF6384","#36A2EB","#FFCE56","#4CAF50"]}]},E=[{field:"name",headerName:"Name",width:200},{field:"phone",headerName:"Customer Phone",width:150},{field:"startTime",headerName:"Start Time",width:150},{field:"endTime",headerName:"End Time",width:150},{field:"startDate",headerName:"Start Date",width:150},{field:"endDate",headerName:"End Date",width:150},{field:"email",headerName:"Customer Email",width:200},{field:"vanImage",headerName:"Van Image",width:100,renderCell:e=>t.jsx("img",{src:e.row.vanImage,alt:"Van",className:"w-16 h-16 object-cover rounded-full"})},{field:"plateNumber",headerName:"Plate Number",width:150},{field:"status",headerName:"Status",width:150,renderCell:e=>{const s=ue[e.value]||"bg-gray-100 text-gray-600";return t.jsx("div",{className:`px-2 py-1 rounded-full text-sm font-semibold ${s}`,style:{display:"inline-block"},children:e.value.charAt(0).toUpperCase()+e.value.slice(1)})}},{field:"reviews",headerName:"Reviews",width:150,renderCell:e=>e.row.status==="completed"&&e.row.reviews?t.jsx(ee,{value:e.row.reviews.rating,readOnly:!0,precision:.5,size:"small"}):t.jsx("span",{className:"text-gray-400",children:"No Reviews"})},{field:"actions",headerName:"Actions",width:200,renderCell:e=>e.row.status==="completed"&&t.jsx("button",{onClick:()=>V(e.row),className:"bg-green-500 text-white px-4 py-1 rounded",children:"Capture Pre-Auth"})}],k=async e=>{if(!i?.id){alert("Invalid booking selected. Please try again.");return}a(!0);try{(await S.post(`${z}/api/capture-pre-authorization`,{bookingId:i.id,amount:e},{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}})).data.success&&(alert("Pre-authorization captured successfully."),C(),w())}catch(s){console.error("Error capturing pre-authorization:",s),M.error("Failed to capture pre-authorization. Please try again.")}finally{a(!1),w()}},O=async()=>{if(!i?.id){alert("Invalid booking selected. Please try again.");return}a(!0);try{(await S.post(`${z}/api/cancel-pre-authorization`,{bookingId:i.id},{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}})).data.success&&(M.success("Pre-authorization canceled successfully."),C(),w())}catch(e){console.error("Error canceling pre-authorization:",e),M.error("Failed to cancel pre-authorization. Please try again.")}finally{a(!1),w()}},$=e=>{x(e)};return t.jsxs("div",{className:"flex flex-col space-y-8 p-4",children:[t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[{label:"Upcoming",status:"upcoming",color:"from-blue-500 to-blue-700",icon:t.jsx(_,{})},{label:"Completed",status:"completed",color:"from-green-500 to-green-700",icon:t.jsx(U,{})},{label:"Canceled",status:"canceled",color:"from-red-500 to-red-700",icon:t.jsx(L,{})},{label:"Pending",status:"pending",color:"from-yellow-500 to-yellow-700",icon:t.jsx(R,{})},{label:"Accepted",status:"accepted",color:"from-purple-500 to-purple-700",icon:t.jsx(q,{})}].map((e,s)=>t.jsxs(A.div,{className:`p-6 bg-gradient-to-r ${e.color} text-white rounded-xl shadow-lg flex flex-col items-center gap-4`,variants:me,initial:"hidden",animate:"visible",whileHover:"hover",children:[t.jsx(A.div,{className:"flex items-center justify-center w-16 h-16 bg-white bg-opacity-20 rounded-full",whileHover:{rotate:15},transition:{type:"spring",stiffness:300},children:t.jsx("span",{className:"text-3xl",children:e.icon})}),t.jsx("h3",{className:"text-xl font-semibold tracking-wide",children:e.label}),t.jsx("span",{className:"text-4xl font-extrabold",children:Y().filter(o=>o.status===e.status).length})]},e.label))}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[t.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("div",{className:"flex flex-wrap gap-2",children:["all","accepted","upcoming","completed","canceled","pending"].map(e=>t.jsx(B,{variant:l===e?"contained":"outlined",color:e==="completed"?"success":e==="canceled"?"error":e==="pending"?"warning":"primary",onClick:()=>I(e),className:"px-4 py-2 text-sm sm:text-base",children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),t.jsx(B,{variant:"contained",color:"primary",sx:{padding:"12px",minWidth:"auto",display:{xs:"flex",md:"block"}},className:"ml-auto flex items-center justify-center rounded-full p-3 shadow-md",onClick:F,children:t.jsx(W,{className:"text-white"})})]}),t.jsx("div",{style:{height:400,width:"100%"},children:t.jsx(G,{rows:P.map(e=>({id:e._id,vanImage:e.vanId.images[0]||"N/A",status:e.status||"N/A",plateNumber:e.vanId?.plateNumber||"N/A",phone:e.userId?.phone||"N/A",email:e.userId?.email||"N/A",name:`${e.userId?.firstName||"N/A"} ${e.userId?.lastName||"N/A"}`,preAuthorization:e?.preAuthorization||"N/A",reviews:e.review||"N/A",startDate:e.startDate,endDate:e.endDate,startTime:d.tz(e.startTime,"YYYY-MM-DDTHH:mm:ss",e.timeZone).format("HH:mm"),endTime:d.tz(e.endTime,"YYYY-MM-DDTHH:mm:ss",e.timeZone).format("HH:mm")})),columns:E,pageSize:5,rowsPerPageOptions:[5],checkboxSelection:!1,disableSelectionOnClick:!0})})]}),t.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md",children:[t.jsx("h2",{className:"text-lg font-bold mb-2",children:"Booking Overview"}),t.jsx(Q,{data:T,options:{responsive:!0}})]})]}),t.jsxs(J,{className:"space-y-4 ",children:[b.map(e=>t.jsxs("div",{className:"bg-white flex p-4 rounded-lg shadow-md hover:shadow-lg cursor-pointer",onClick:()=>v(e._id),children:[t.jsx("img",{src:e.images[0],alt:e.name.en,className:" h-24 w-24 rounded-full object-cover mr-5"}),t.jsxs("div",{children:[t.jsx("h3",{className:"mt-2 text-lg font-semibold",children:e.name.en}),t.jsxs("p",{children:["Plate: ",e.plateNumber]}),t.jsxs("p",{children:["Upcoming Bookings:"," ",m.filter(s=>{const o=d.tz(s.startTime,"YYYY-MM-DDTHH:mm:ss",s.timeZone),c=d().tz(s.timeZone),Z=c.clone().add(24,"hours");return console.log("Start Date:",s),o.isBetween(c,Z)}).length]})]})]},e._id)),t.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md",children:[t.jsx("h3",{className:"text-lg font-bold",children:"Booking Calendar"}),t.jsx(he,{bookings:m,onDateSelect:e=>$(e)}),t.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-md",children:[t.jsx("h2",{className:"text-lg font-bold mb-2",children:"Trends"}),t.jsx(K,{data:T,options:{responsive:!0}})]})]})]})]}),t.jsx(de,{isOpenVanModal:f,onCloseVanModal:()=>u(!1)}),t.jsx(X,{children:D&&t.jsx(A.div,{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:t.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-full max-w-md",children:[t.jsxs("h2",{className:"text-xl font-bold mb-4",children:["Capture Pre-Authorization - $",i?.preAuthorization?.authorizedAmount/100," CHF"]}),t.jsxs("div",{children:[t.jsx("img",{src:i?.vanImage,alt:"Van",className:"w-32 h-32 object-cover rounded-full mb-4"}),t.jsxs("p",{children:["Customer Email: ",i?.email]}),t.jsxs("p",{children:["Customer Phone: ",i?.phone]}),t.jsx("input",{type:"number",placeholder:"Enter amount",className:"w-full p-2 border rounded mt-4",onChange:e=>g({...i,captureAmount:e.target.value})})]}),t.jsxs("div",{className:"flex justify-end mt-4",children:[t.jsx("button",{onClick:w,className:"px-4 py-2 bg-gray-300 rounded mr-2",disabled:h,children:"Close"}),t.jsx("button",{onClick:O,className:"px-4 py-2 bg-red-500 text-white rounded mr-2",disabled:h,children:"Cancel"}),t.jsx("button",{onClick:()=>k(i._id),className:"px-4 py-2 bg-green-500 text-white rounded",disabled:h,children:h?"Processing...":"Capture"})]})]})})})]})};export{Ne as default};
