import{r as e,c as t,a as s,l as a,_ as n,j as i,m as r,cq as l,cr as o,cs as d,ct as c,cu as m,cv as x,cw as h,a4 as u,a5 as f,bv as p,cx as g,bD as b,cy as j,aV as y,cA as w,bf as v,aE as N,a$ as k,cp as D,g as Y,ar as S,cB as H,y as M,aP as T}from"./vendor-Zgq9WbFI.js";import{a as $}from"./index-D29cp_SG.js";import{C,B as _}from"./Carousel-D7BsNlAJ.js";const P=a("https://rubertogo.com"),I="https://rubertogo.com",A=(e=[])=>e.flatMap((e=>e.hours.map((t=>({date:new Date(e.date).toISOString().split("T")[0],time:t}))))),E=(()=>{const e=[];for(let t=0;t<=23;t++)e.push(`${t<10?"0":""}${t}:00`);return e})(),B=(e,t)=>{var s;const a=n(t).format("dddd"),i=null==(s=e.dailyPricing)?void 0:s.find((e=>e.day===a));return(null==i?void 0:i.pricePerHour)||0},F=(e={})=>{const t=[],s=new Date,a=s.getDay(),n=s.getHours(),i=s.getMinutes(),r=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][a],l=s.toISOString().split("T")[0];if(e[r]){const{start:a,end:o}=e[r],d=parseInt(a.split(":")[0],10),c=parseInt(o.split(":")[0],10);if(c<d){for(let s=d;s<24;s++)(s<n-1||s===n-1&&0===i)&&t.push({date:l,time:`${s<10?"0":""}${s}:00`});const e=new Date(s);e.setDate(e.getDate()+1);const a=e.toISOString().split("T")[0];for(let s=0;s<c;s++)t.push({date:a,time:`${s<10?"0":""}${s}:00`})}else for(let e=d;e<c;e++)(e<n-1||e===n-1&&0===i)&&t.push({date:l,time:`${e<10?"0":""}${e}:00`})}return t},O=({van:a,isOpen:w,onClose:v})=>{const[N,k]=e.useState("21:00"),[D,Y]=e.useState({}),[S,H]=e.useState([]),[M,T]=e.useState([]);e.useEffect((()=>{(async()=>{try{const e=await fetch(`${I}/api/packages`),t=await e.json();T(t)}catch(e){console.error("Error fetching packages:",e)}})()}),[]);const O=(e,t)=>{const s=n(`${e}T${N}`,"YYYY-MM-DDTHH:mm"),a=s.add(D.freeHours,"hour");if(n(`${e}T${t}:00`,"YYYY-MM-DDTHH:mm").isBetween(s,n(e).endOf("day"),null,"[)"))return!0;const i=n(e).add(1,"day").format("YYYY-MM-DD");return n(`${i}T${t}`,"YYYY-MM-DDTHH:mm").isBetween(s.add(1,"day").startOf("day"),a,null,"[)")},z=new Date,[L,G]=e.useState(0),[R,V]=e.useState(null),[U,W]=e.useState(null),[Z,q]=e.useState([]),J=e.useRef(null),[X,K]=e.useState(!1),Q=t(),{translations:ee}=$(),{lang:te}=s(),[se,ae]=e.useState(!0),[ne,ie]=e.useState(!1),[re,le]=e.useState(!1);e.useEffect((()=>{if(a){return(async()=>{try{ae(!0);const e=await fetch(`${I}/api/booking-settings/${a._id}`),t=await e.json();Y({freeHours:t.freeHours??9,minimumPaidHours:t.minimumPaidHours??3}),k(t.freePeriodStart??"21:00");const s=[...A(t.blockedDateHours),...F(a.restrictedBookingHours)];H(s)}catch(e){console.error("Error fetching booking settings:",e)}finally{ae(!1)}})(),P.on("bookingSettingsUpdated",(({vanId:e,settings:t})=>{if(e===a._id){Y(t);const e=[...A(t.blockedDateHours),...F(a.restrictedBookingHours)];H(e)}})),()=>{P.off("bookingSettingsUpdated")}}}),[a]),e.useEffect((()=>{const e=null==a?void 0:a._id;a&&w&&(async()=>{try{const t=await fetch(`${I}/api/vans/${e}/booked-slots`),s=await t.json(),a=(Array.isArray(s)?s:s.bookings||[]).flatMap((e=>e.selectedSlots.map((e=>({date:e.date,time:e.time})))));q(a)}catch(t){console.log("Error fetching booked slots:",t)}finally{ae(!1)}})()}),[a,w]);const oe=e.useMemo((()=>((e,t)=>{const s=[],a=new Date(e);for(let i=0;i<t;i++){const e=new Date(a);s.push({date:n(e).format("YYYY-MM-DD"),displayDate:e.toLocaleDateString("en-GB",{day:"numeric",month:"short"}),slots:E}),a.setDate(a.getDate()+1)}return s})(z,30)),[z]);e.useEffect((()=>{if(w&&S.length>0){const{start_date:e,start_time:t,end_date:s,end_time:a}=(()=>{const e=new URLSearchParams(Q.search);return{start_date:e.get("start_date"),start_time:e.get("start_time"),end_date:e.get("end_date"),end_time:e.get("end_time")}})();if(e&&t&&s&&a){const n=de({start_date:e,start_time:t,end_date:s,end_time:a});pe(n)}}}),[w,S]);const de=({start_date:e,start_time:t,end_date:s,end_time:a})=>{if(e&&t&&s&&a){const i=oe.findIndex((t=>n(t.date).isSame(n(e),"day")));if(-1===i)return[];const r=E.findIndex((e=>e===t)),l=n(`${s}T${a}:00`,"YYYY-MM-DDTHH:mm").diff(n(`${e}T${t}:00`,"YYYY-MM-DDTHH:mm"),"hour");return ce(i,r,l)}return[]},ce=(e,t,s)=>{let a=s,n=[];for(let i=e;i<oe.length;i++){const e=oe[i].slots;for(let r=t;r<e.length;r++){const l=e[r];if(ue(oe[i].date,l)){if(n.push({date:oe[i].date,time:l}),a--,0===a)return n}else n=[],a=s,t=0}t=0}return n},me=(e,t)=>Z.some((s=>s.date===e&&s.time===t)),xe=(e,t)=>S.some((s=>s.date===e&&s.time===t)),he=(e,t)=>{const s=n();return n(`${e}T${t}`,"YYYY-MM-DDTHH:mm").isBefore(s)},ue=(e,t)=>!he(e,t)&&!xe(e,t)&&!me(e,t),[fe,pe]=e.useState([]),ge=e=>{if(R){if(U)return V(e),W(null),void pe([e]);const t=oe.findIndex((e=>e.date===R.date)),s=E.findIndex((e=>e===R.time)),a=E.findIndex((t=>t===e.time)),n=oe.findIndex((t=>t.date===e.date));if(n<t||n===t&&a<s)return V(e),void pe([e]);let i=!0,r=[];if(R.date===e.date)for(let l=s;l<=a;l++){const t=E[l];if(xe(e.date,t)||me(e.date,t)){i=!1;break}r.push({date:e.date,time:t})}else i=be(t,s,n,a,r);i?(pe(r),W(e)):(V(e),W(null),pe([e]))}else V(e),pe([e])},be=(e,t,s,a,n)=>{for(let i=t;i<E.length;i++){const t=E[i];if(he(oe[e].date,t)||xe(oe[e].date,t)||me(oe[e].date,t))return!1;n.push({date:oe[e].date,time:t})}for(let i=e+1;i<s;i++)for(const e of E){if(he(oe[i].date,e)||xe(oe[i].date,e)||me(oe[i].date,e))return!1;n.push({date:oe[i].date,time:e})}for(let i=0;i<=a;i++){const e=E[i];if(he(oe[s].date,e)||xe(oe[s].date,e)||me(oe[s].date,e))return!1;n.push({date:oe[s].date,time:e})}return!0},je=()=>{let e=0,t=0;const s=fe.reduce(((e,t)=>(e[t.date]||(e[t.date]=[]),e[t.date].push(t),e)),{});if(Object.keys(s).forEach((n=>{const i=B(a,n);s[n].forEach((s=>{O(s.date,s.time)||(e++,t+=i)}))})),e<D.minimumPaidHours){let e=0,t=0;const s=fe.sort(((e,t)=>new Date(e.date+"T"+e.time)-new Date(t.date+"T"+t.time)));for(const n of s){if(!(t<D.minimumPaidHours))break;e+=B(a,n.date),t++}return e}return t},ye=(()=>{const e=fe.length;if(!M||e<24)return null;let t=null,s=1/0;return M.forEach((a=>{const n=24*a.duration,i=Math.abs(n-e);n>=e&&i<s&&(t=a,s=i)})),t})();e.useEffect((()=>{w&&ye&&!ne&&!re&&(ie(!0),J.current.scrollTop=0)}),[w,ye,ne,re]);const we=(e=null)=>{const t=e?M.find((t=>t._id===e)):null;if(!fe.length)return void y.error("Please select at least one hour time solt.");const s={selectedSlots:fe,totalPrice:t?t.price:je(),vanDetails:a,packageId:t?t._id:null};localStorage.setItem("bookingData",JSON.stringify(s));const n=`/:${te}/create-booking`;window.location.href=n},ve=e=>{const t=fe.filter((e=>O(e.date,e.time)));fe.filter((e=>!O(e.date,e.time)));const s=Math.max(0,fe.length-D.minimumPaidHours),a=t.findIndex((t=>t.date===e.date&&t.time===e.time));return a>=0&&a<s};return se?i.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-100",children:i.jsx(r.div,{initial:{rotate:0},animate:{rotate:360},transition:{repeat:1/0,duration:1.5,ease:"linear"},className:"w-20 h-20 border-4 border-t-blue-500 border-r-transparent border-b-transparent border-l-blue-500 rounded-full"})}):w?l.createPortal(i.jsxs(r.div,{className:"relative",children:[i.jsx(o,{steps:[{target:".modal-header",content:"Welcome to the booking modal! Here you can select your desired vehicle and book your time slots.",placement:"bottom"},{target:".time-slot-table",content:"Select your start time by clicking on a time slot.",placement:"top"},{target:".time-slot-table td",content:"Available time slots are highlighted. Click to select an end time.",placement:"top"},{target:".booking-button",content:"Once you have selected your slots, click here to proceed to checkout.",placement:"top"}],run:X,continuous:!0,showSkipButton:!0,callback:e=>{"finished"!==e.status&&"skipped"!==e.status||K(!1)},styles:{options:{zIndex:1e4,backgroundColor:"#fff",color:"#333",arrowColor:"#fff",primaryColor:"#007bff",textColor:"#333",beaconSize:20,spotlightPadding:10,spotlightBorderRadius:8}}}),i.jsxs(r.div,{className:"fixed inset-0 bg-gray-800 bg-opacity-70 flex max-w-full m-auto items-center justify-center z-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[i.jsxs(r.div,{className:"bg-white p-8 sm:p-5 rounded-2xl shadow-2xl w-full sm:max-w-4xl sm:h-[70vh] h-[90vh]  overflow-y-auto relative",ref:J,initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{duration:.5,ease:"easeInOut"},children:[i.jsx(r.button,{onClick:v,className:"absolute z-40 top-4 right-4 text-red-500 text-2xl rounded-full shadow-md hover:bg-gray-100 p-2",whileHover:{scale:1.1},whileTap:{scale:.9},children:i.jsx(d,{})}),i.jsx(C,{images:a.images}),ye&&i.jsx(i.Fragment,{children:i.jsx(_,{betterPackage:ye,isOpen:ne,onClose:()=>{ie(!1),le(!0)},handleBooking:we})}),i.jsxs(c,{children:[i.jsxs(m,{className:"flex text-center items-center gap-5 p-5 justify-center border-0",children:[i.jsx(x,{className:"py-2 bg-blue-100 sm:py-4 flex-1 cursor-pointer font-semibold text-lg sm:text-xl",children:ee.timeTable}),i.jsx(x,{className:"py-2 sm:py-4 bg-blue-100 flex-1 cursor-pointer font-semibold text-lg sm:text-xl details-tab",children:ee.details})]}),i.jsxs(h,{children:[i.jsxs(r.div,{className:"text-center mb-4 sm:mb-6",initial:{y:50,opacity:0},animate:{y:0,opacity:1},transition:{duration:.7},children:[i.jsx("h1",{className:"text-xl sm:text-3xl font-bold text-gray-800 mt-5",children:ee.modalTitle}),i.jsx("h3",{className:"text-lg sm:text-2xl text-gray-700",children:a.name[te]||a.name.en}),i.jsx("p",{className:"text-gray-500 text-xl",children:ee.modalSubtitle}),re&&i.jsx("div",{className:"text-center mt-4",children:i.jsx(u,{variant:"outlined",color:"warning",onClick:()=>{ie(!0),le(!1)},children:"View Better Package Offer"})}),i.jsxs("button",{onClick:we,className:"w-full bg-blue-600 py-3 sm:py-4 text-white text-lg sm:text-xl rounded-lg mt-4 shadow-lg",children:[ee.priceLabel,": ",je()," CHF"]})]}),i.jsxs(r.div,{className:"w-full overflow-x-auto sm:overflow-hidden",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5,delay:.3},children:[i.jsx("div",{className:"hidden sm:block max-w-full overflow-x-auto time-slot-table",children:i.jsxs("table",{className:"max-w-full border-separate border-spacing-0",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{className:"border p-2 sm:p-4 sticky left-0 bg-white text-base sm:text-lg font-semibold text-gray-600",style:{zIndex:10},children:"Date"}),E.map(((e,t)=>i.jsx("th",{className:"border p-2 sm:p-4 left-0 bg-white text-base sm:text-lg font-semibold text-gray-600",children:e},t)))]})}),i.jsx("tbody",{children:oe.slice(L,L+7).map(((e,t)=>i.jsxs("tr",{children:[i.jsx("td",{className:"border p-2 sm:p-4 sticky left-0 bg-white font-semibold text-gray-700",children:e.displayDate}),E.map(((t,s)=>{const a=R&&!U&&e.date===R.date?E.findIndex((e=>e===R.time))+1:null;return i.jsxs(r.td,{className:"border text-center cursor-pointer  p-2 sm:p-4 transition-all duration-300 "+(fe.some((s=>s.date===e.date&&s.time===t))?"bg-green-500 text-white font-bold":xe(e.date,t)?"bg-red-600 text-white":me(e.date,t)?"bg-gray-400 text-center text-white":he(e.date,t)?"bg-gray-300 cursor-not-allowed":"bg-white"),whileHover:{scale:ue(e.date,t)?1.05:1},whileTap:{scale:.95},onClick:()=>ue(e.date,t)&&ge({date:e.date,time:t}),children:[R&&!U&&a===s&&i.jsx(r.span,{className:"relative inset-0 flex text-center justify-center items-center",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.5},children:i.jsx(f,{className:"text-yellow-400 text-3xl animate-bounce",title:"Select end time"})}),xe(e.date,t)?i.jsx(p,{className:"text-red-500 text-4xl font-extrabold"}):me(e.date,t)?i.jsx(g,{className:"text-white text-center"}):fe.some((s=>s.date===e.date&&s.time===t))?ve({date:e.date,time:t})?i.jsx("span",{className:"text-white",children:ee.freeLabel}):i.jsx(b,{className:"text-white text-4xl font-extrabold"}):null]},s)}))]},t)))})]})}),i.jsx("div",{className:"block sm:hidden",children:oe.slice(L,L+7).map(((e,t)=>i.jsxs("div",{className:"mb-4",children:[i.jsxs("div",{className:"text-white text-center bg-green-800 p-5 font-bold text-lg mb-2",children:["Date ",e.displayDate]}),i.jsx("div",{className:"grid grid-cols-2 gap-2",children:E.map(((t,s)=>{const a=R&&!U&&e.date===R.date?E.findIndex((e=>e===R.time))+1:null;return i.jsxs(r.div,{className:"p-4 text-center flex flex-col items-center justify-center border transition-all duration-300 rounded-lg "+(fe.some((s=>s.date===e.date&&s.time===t))?"bg-green-500 text-white font-bold":xe(e.date,t)?"bg-red-600 text-white":me(e.date,t)?"bg-gray-500 text-white":he(e.date,t)?"bg-gray-300 cursor-not-allowed":"bg-white"),whileHover:{scale:ue(e.date,t)?1.05:1},whileTap:{scale:.95},onClick:()=>ue(e.date,t)&&ge({date:e.date,time:t}),children:[t,R&&!U&&a===s&&i.jsxs(r.div,{className:"relative flex items-center justify-center",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.5},children:[i.jsx(f,{className:"text-yellow-400 text-xl animate-bounce"}),i.jsx("div",{className:"absolute top-full mt-2 bg-blue-600 text-white text-xs font-semibold px-3 py-1 rounded-md opacity-0 group-hover:opacity-100 transition-opacity duration-300 shadow-lg transform -translate-x-1/2",children:"Select an end time."})]}),xe(e.date,t)||me(e.date,t)?i.jsx(g,{className:"text-white"}):fe.some((s=>s.date===e.date&&s.time===t))?ve({date:e.date,time:t})?i.jsx("span",{className:"text-white",children:ee.freeLabel}):i.jsx(b,{className:"text-white text-4xl font-extrabold"}):null]},s)}))})]},t)))})]}),i.jsxs("div",{className:"flex justify-between mt-4 sm:mt-6",children:[i.jsx(r.button,{onClick:()=>{G((e=>Math.max(e-7,0))),J.current&&(J.current.scrollTop=0)},className:"text-orange-500 text-lg p-2",disabled:0===L,whileHover:{scale:1.05},whileTap:{scale:.95},children:i.jsx(j,{size:24})}),i.jsx(r.button,{onClick:()=>{G((e=>Math.min(e+7,oe.length-7))),J.current&&(J.current.scrollTop=0)},className:"text-orange-500 text-lg p-2",disabled:L+7>=oe.length,whileHover:{scale:1.05},whileTap:{scale:.95},children:i.jsx(f,{size:24})})]})]}),i.jsx(h,{children:i.jsxs(r.div,{className:"text-left p-6 bg-white rounded-lg shadow-md",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:[i.jsx("h2",{className:"text-3xl font-bold mb-4 text-gray-800",children:ee.vehicleDetails}),i.jsxs("div",{className:"p-4 rounded-lg border-b-2 border-t-2 border-dashed border-red-300 ",children:[i.jsxs("h3",{className:"text-2xl font-semibold mb-2",children:[" ",a.name[te]||a.name.en]}),i.jsxs("p",{className:"text-red-500 font-bold text-xl mt-2",children:[ee.priceLabel,":"," ",i.jsxs("span",{className:"text-green-600",children:[B(a)," CHF ",ee.perHour]})]})]}),i.jsxs("div",{className:" flex items-center justify-between p-4 border-b-2 border-dashed border-red-300 rounded-lg  ",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-xl font-bold mb-2",children:ee.externalDimensions}),i.jsxs("ul",{className:"list-disc list-inside text-gray-600",children:[i.jsxs("li",{children:[ee.length,":"," ",i.jsx("span",{className:"font-semibold",children:a.externalDimensions.length})]}),i.jsxs("li",{children:[ee.width,":"," ",i.jsx("span",{className:"font-semibold",children:a.externalDimensions.width})]}),i.jsxs("li",{children:[ee.Height,":"," ",i.jsx("span",{className:"font-semibold",children:a.externalDimensions.height})]})]})]}),i.jsx("div",{children:i.jsx("img",{src:"/externalsize.png",width:120,alt:"",srcset:""})})]}),i.jsxs("div",{className:" flex items-center justify-between p-4 rounded-lg border-b-2 border-dashed border-red-300 ",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-xl font-bold mb-2",children:ee.internalDimensions}),i.jsxs("ul",{className:"list-disc list-inside text-gray-600",children:[i.jsxs("li",{children:[ee.length,":"," ",i.jsx("span",{className:"font-semibold",children:a.internalDimensions.length})]}),i.jsxs("li",{children:[ee.width,":"," ",i.jsx("span",{className:"font-semibold",children:a.internalDimensions.width})]}),i.jsxs("li",{children:[ee.Height,":"," ",i.jsx("span",{className:"font-semibold",children:a.internalDimensions.height})]})]})]}),i.jsx("div",{children:i.jsx("img",{src:"/internalsize.png",width:120,alt:"",srcset:""})})]}),i.jsxs("div",{className:" p-4 rounded-lg border-b-2 border-dashed border-red-300",children:[i.jsx("h3",{className:"text-xl font-bold mb-2",children:ee.weight}),i.jsxs("ul",{className:"list-disc list-inside text-gray-600",children:[i.jsxs("li",{children:[ee.empty,":"," ",i.jsx("span",{className:"font-semibold",children:a.weight.empty})]}),i.jsxs("li",{children:[ee.maxLoad,":"," ",i.jsx("span",{className:"font-semibold",children:a.weight.maxLoad})]})]})]}),i.jsxs("div",{className:"p-4 rounded-lg border-b-2 border-dashed border-red-300",children:[i.jsx("h3",{className:"text-xl font-bold mb-2",children:ee.optionalFeatures}),i.jsxs("ul",{className:"list-disc list-inside text-gray-600",children:[i.jsxs("li",{children:[ee.roofRack,":"," ",a.optionalFeatures.roofRack?i.jsx("span",{className:"text-green-500",children:"✓ Available"}):i.jsx("span",{className:"text-red-500",children:"✗ Not Available"})]}),i.jsxs("li",{children:[ee.airConditioning,":"," ",a.optionalFeatures.airConditioning?i.jsx("span",{className:"text-green-500",children:"✓ Available"}):i.jsx("span",{className:"text-red-500",children:"✗ Not Available"})]}),i.jsxs("li",{children:[ee.towingHook,":"," ",a.optionalFeatures.towingHook?i.jsx("span",{className:"text-green-500",children:"✓ Available"}):i.jsx("span",{className:"text-red-500",children:"✗ Not Available"})]}),i.jsxs("li",{children:[ee.parkingSensors,":"," ",a.optionalFeatures.parkingSensors?i.jsx("span",{className:"text-green-500",children:"✓ Available"}):i.jsx("span",{className:"text-red-500",children:"✗ Not Available"})]})]})]})]})})]})]}),i.jsx("div",{className:"max-w-full fixed bottom-4 left-0 right-0 px-4",children:i.jsxs(u,{variant:"contained",color:"warning",fullWidth:!0,className:"booking-button gap-5 rounded-xl bg-blue-600 text-white py-4 shadow-lg hover:bg-blue-700 transition duration-300",onClick:we,children:[i.jsxs("span",{className:" font-extrabold  text-2xl",children:[" ",je()," CHF"]})," ",ee.procedToBooking," ",i.jsx(f,{})]})})]})]}),document.body):null},z="https://rubertogo.com",L=()=>i.jsxs("svg",{className:"absolute inset-0 w-full h-full z-0",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"none",viewBox:"0 0 800 600",children:[i.jsxs("defs",{children:[i.jsxs("linearGradient",{id:"bgGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[i.jsx("stop",{offset:"0%",stopColor:"#ff2100"}),i.jsx("stop",{offset:"100%",stopColor:"#ff2100"})]}),i.jsxs("linearGradient",{id:"shapeGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[i.jsx("stop",{offset:"0%",stopColor:"#8c020b"}),i.jsx("stop",{offset:"100%",stopColor:"#000"})]})]}),i.jsx("rect",{width:"800",height:"600",fill:"url(#bgGradient)"}),i.jsx("circle",{cx:"200",cy:"150",r:"100",fill:"rgba(255, 255, 255, 0.1)"}),i.jsx("circle",{cx:"600",cy:"450",r:"150",fill:"rgba(255, 255, 255, 0.1)"}),i.jsx("path",{d:"M0,200 C400,100 400,500 800,300 L800,600 L0,600 Z",fill:"url(#shapeGradient)",opacity:"0.3"}),i.jsx("path",{d:"M0,400 C400,200 400,600 800,400 L800,600 L0,600 Z",fill:"url(#shapeGradient)",opacity:"0.2"})]}),G=e=>{var t;const s=n().format("dddd"),a=null==(t=e.dailyPricing)?void 0:t.find((e=>e.day===s));return(null==a?void 0:a.pricePerHour)?`${a.pricePerHour} CHF / hour`:"Not available"},R=({van:t,onSelect:s})=>{const{language:a,translations:n}=$(),[l,o]=e.useState(!0);return i.jsxs(r.div,{className:"relative flex h-[420px] flex-col  rounded-xl overflow-hidden  transition-transform duration-300 transform  hover:shadow-2xl bg-white",children:[i.jsx("div",{className:"relative z-10 w-full  h-[180px] overflow-hidden flex items-center",children:i.jsxs("div",{className:"relative h-full w-full",children:[l&&i.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100",children:i.jsx(k,{})}),i.jsx(D,{component:"img",alt:t.name.en,image:t.images[0],title:t.name.en,className:"h-full w-full object-cover transition-transform duration-300 hover:scale-110",style:{padding:"1.2rem",objectFit:"contain"},loading:"lazy",onLoad:()=>{o(!1)},srcSet:`\n    ${t.images[0]}?w=300&h=180&fit=crop 300w,\n    ${t.images[0]}?w=600&h=360&fit=crop 600w,\n    ${t.images[0]}?w=900&h=540&fit=crop 900w\n  `,sizes:"(max-width: 600px) 300px, \n         (max-width: 1200px) 600px, \n         900px"})]})}),i.jsx("div",{className:"absolute inset-0 z-0",children:i.jsx(L,{})}),i.jsxs("div",{className:"flex flex-col  gap-5 justify-between  bg-white bg-opacity-1 backdrop-blur-md border border-gray-200 rounded-lg relative z-10 flex-grow",style:{flex:1,padding:"0.5rem"},children:[i.jsxs("div",{className:"flex-grow p-2",children:[i.jsx(Y,{variant:"h6",className:"font-extrabold text-gray-800 text-center   text-xl md:text-2xl",style:{marginBottom:"0.3rem"},children:t.name[a]||t.name.en}),i.jsx(Y,{variant:"h6",className:" text-3xl text-green-600 font-extrabold text-center  md:text-2xl",style:{marginBottom:"0.3rem"},children:G(t)}),i.jsx(Y,{variant:"body2",className:" text-center flex items-center text-sm justify-center text-green-900",sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.3rem",marginTop:"0.3rem",textAlign:"center"},children:t.location.address||"Location not specified."}),i.jsx("div",{className:"mt-2",children:i.jsx("div",{className:"overflow-hidden",children:i.jsxs("div",{className:"flex gap-4 mt-2 justify-center max-w-full animate-auto-scroll",children:[t.optionalFeatures.roofRack&&i.jsxs("span",{className:"bg-green-500 text-center flex justify-center items-center text-white rounded-full px-6 py-2 min-w-[200px] text-sm font-semibold shadow-md transition-transform duration-200 hover:scale-105",children:[i.jsx(S,{className:"mr-2"})," ",n.roofRack]}),t.optionalFeatures.airConditioning&&i.jsxs("span",{className:"bg-green-500 text-center flex justify-center items-center text-white rounded-full px-6 py-2 min-w-[200px] text-sm font-semibold shadow-md transition-transform duration-200 hover:scale-105",children:[i.jsx(H,{className:"mr-2"})," ",n.airConditioning]}),t.optionalFeatures.towingHook&&i.jsxs("span",{className:"bg-green-500 text-center flex justify-center items-center text-white rounded-full px-6 py-2 min-w-[200px] text-sm font-semibold shadow-md transition-transform duration-200 hover:scale-105",children:[i.jsx(M,{className:"mr-2"})," ",n.towingHook]}),t.optionalFeatures.parkingSensors&&i.jsxs("span",{className:"bg-green-500 text-center flex justify-center items-center text-white rounded-full px-6 py-2 min-w-[250px] text-sm font-semibold shadow-md transition-transform duration-200 hover:scale-105",children:[i.jsx(T,{className:"mr-2"})," ",n.parkingSensors]})]})})})]}),i.jsx("button",{onClick:()=>s(t),className:" w-full text-white font-bold bg-blue-600 rounded-lg border-2  py-2 text-lg shadow-md transition-transform duration-200 hover:bg-green-600 hover:text-white hover:shadow-lg transform hover:scale-104",children:n.bookNowButton})]})]})},V=e=>{const t=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],s=t.indexOf(e);return t[(s+1)%t.length]},U=({isOpenVanModal:t,onCloseVanModal:s})=>{const[a,r]=e.useState([]),[l,o]=e.useState([]),[d,c]=e.useState([]),[m,x]=e.useState(null),[h]=w(),u=h.get("start_date"),f=h.get("start_time"),g=h.get("end_date"),b=h.get("end_time");e.useEffect((()=>{t&&(async()=>{try{const e=await fetch(`${z}/api/vans`),t=await e.json();r(t)}catch(e){console.error("Error fetching vans:",e)}})()}),[t]);const j=async e=>{try{const t=await fetch(`${z}/api/booking-settings/${e}`),s=await t.json();o(((e=[])=>e.flatMap((e=>e.hours.map((t=>({date:n(e.date).format("YYYY-MM-DD"),time:t}))))))(s.blockedDateHours||[]))}catch(t){console.error("Error fetching blocked slots:",t)}},y=(e,t,s)=>{const a=(e=>{const t=[];return Object.entries(e).forEach((([e,s])=>{const{start:a,end:i}=s;if(a&&i)if(n(`1970-01-01T${a}`).isAfter(n(`1970-01-01T${i}`))){t.push({day:e,start:a,end:"23:59"});const s=V(e);t.push({day:s,start:"00:00",end:i})}else t.push({day:e,start:a,end:i})})),t})(e.restrictedBookingHours),i=[...l,...d,...a],r=n(`${t}T${f}`),o=n(`${s}T${b}`);let c=r;for(;i.some((e=>e.date===c.format("YYYY-MM-DD")&&e.time===c.format("HH:mm")));)c=c.add(1,"hour");const m=o.diff(r,"hour"),x=c.add(m,"hour");return{adjustedStart:c,adjustedEnd:x}},k=async e=>{await j(e._id),await(async e=>{try{const t=await fetch(`${z}/api/vans/${e}/booked-slots`),s=await t.json(),a=(Array.isArray(s)?s:s.bookings||[]).flatMap((e=>e.selectedSlots.map((e=>({date:e.date,time:e.time})))));c(a)}catch(t){console.error("Error fetching booked slots:",t)}})(e._id);const t=G(e),s=u||n().format("YYYY-MM-DD"),a=g||n(s).add(1,"day").format("YYYY-MM-DD"),{adjustedStart:i,adjustedEnd:r}=y(e,s,a),l=r.diff(i,"hour")*parseFloat(t);x({...e,name:e.name||"Unnamed Van",description:e.description.en||"No description available.",currentDayPrice:t,totalPrice:l,startDate:i.format("YYYY-MM-DD"),endDate:r.format("YYYY-MM-DD"),startTime:i.format("h:mm A"),endTime:r.format("h:mm A")})};return m&&s(),i.jsxs("div",{className:"container m-auto pb-10 p-5",children:[i.jsx(v,{open:t,onClose:s,"aria-labelledby":"vans-modal-title","aria-describedby":"vans-modal-description",children:i.jsx("div",{className:"flex items-center justify-center min-h-screen bg-black bg-opacity-50",children:i.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-lg max-w-5xl h-[80vh] overflow-y-scroll w-full relative",children:[i.jsx("button",{className:" absolute right-2 top-2 text-red-500 text-2xl hover:bg-red-500 hover:text-white rounded-full p-2 ",onClick:s,children:i.jsx(p,{})}),i.jsx("div",{className:"container m-auto pb-10 p-5",children:i.jsx(N,{container:!0,spacing:1,justifyContent:"center",alignItems:"center",children:a.map((e=>i.jsx(N,{item:!0,xs:12,sm:6,md:6,lg:6,xl:6,children:i.jsx(R,{van:e,onSelect:k})},e._id)))})})]})})}),m&&i.jsx(O,{isOpen:!!m,onClose:()=>x(null),van:m,currentDayPrice:m.currentDayPrice,totalPrice:m.totalPrice,startDate:m.startDate,endDate:m.endDate,startTime:m.startTime,endTime:m.endTime})]})};export{U as V};
