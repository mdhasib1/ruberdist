import{j as e,f as r,ap as s,m as a,r as t,b as i,bf as l,g as n,a$ as o,af as d,a4 as c,a as m,ai as h,bg as u,bh as x,a2 as g,bi as p,bj as v,I as j,bk as f,bl as b,bm as N,bn as y,bo as w,bp as k,bq as P,br as D,bs as I,ar as C,aG as F,bt as S,bu as A,bv as L,G as z,aV as B,_ as T,bw as R}from"./vendor-Zgq9WbFI.js";import{a as $}from"./index-D29cp_SG.js";import{L as H}from"./LoginModal-D5yrFgFu.js";import{M as q}from"./Modal-D1aNLYnG.js";import{O as E}from"./OTPModal-B3tYgRCI.js";import O from"./PrivacyPolicy-DNvBuh-q.js";import W from"./TermsAndConditions-_vhKSau4.js";import"./Carousel-D7BsNlAJ.js";const K=()=>e.jsxs(r,{className:"bg-white min-h-screen h-screen flex flex-col justify-center items-center",children:[e.jsxs(r,{className:"relative h-[200px] bg-cover flex justify-center items-center bg-center",style:{backgroundImage:"url('/hero.webp')"},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-[#ff0707] to-[#ff5050] opacity-90"}),e.jsxs(r,{className:"relative z-10 flex flex-col items-center justify-center h-full text-center text-white space-y-4 px-4",children:[e.jsx(s,{variant:"text",width:"60%",height:40}),e.jsx(s,{variant:"text",width:"40%",height:30})]})]}),e.jsx(r,{className:"container mx-auto py-10 px-4 sm:px-6 lg:px-8",children:e.jsxs(r,{className:"grid grid-cols-1 md:grid-cols-3 gap-10",children:[e.jsxs(r,{className:"col-span-2 p-5 bg-gray-50 shadow-md rounded-lg space-y-6",children:[e.jsx(s,{variant:"text",width:"80%",height:30}),e.jsx(s,{variant:"rectangular",width:"100%",height:50}),e.jsxs(r,{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(s,{variant:"rectangular",width:"100%",height:50}),e.jsx(s,{variant:"rectangular",width:"100%",height:50})]}),e.jsx(s,{variant:"rectangular",width:"100%",height:50}),e.jsx(s,{variant:"rectangular",width:"100%",height:50}),e.jsxs(r,{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(s,{variant:"rectangular",width:"100%",height:150}),e.jsx(s,{variant:"rectangular",width:"100%",height:150})]}),e.jsx(s,{variant:"text",width:"50%",height:30})]}),e.jsxs(r,{className:"sm:col-span-1 col-span-2 bg-white rounded-2xl p-8 border border-gray-200",children:[e.jsx(s,{variant:"rectangular",width:"100%",height:150}),e.jsx(s,{variant:"text",width:"80%",height:30}),e.jsx(s,{variant:"text",width:"60%",height:20}),e.jsx(s,{variant:"text",width:"90%",height:20}),e.jsxs(r,{className:"bg-gray-50 p-4 rounded-lg border border-gray-200 shadow-sm space-y-2",children:[e.jsx(s,{variant:"text",width:"80%",height:20}),e.jsx(s,{variant:"text",width:"60%",height:20})]}),e.jsx(s,{variant:"rectangular",width:"100%",height:50})]})]})})]}),Y=({isOpen:r,onClose:s,children:t})=>r?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:[e.jsx(a.div,{className:"fixed inset-0",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:s}),e.jsxs(a.div,{className:"bg-white w-full max-w-4xl mx-4 rounded-lg shadow-lg  relative  h-[75vh] overflow-y-auto z-50",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{duration:.3,ease:"easeInOut"},children:[e.jsx("button",{onClick:s,className:"absolute top-2 right-2 text-gray-500 hover:text-gray-700",children:"âœ•"}),e.jsx("div",{className:"overflow-y-auto h-full",children:t})]})]}):null,_=({isOpen:r,onClose:s,onSelectProduct:a})=>{const[m,h]=t.useState([]),[u,x]=t.useState([]),[g,p]=t.useState(!1);t.useEffect((()=>{r&&v()}),[r]);const v=async()=>{p(!0);try{const e=await i.get("https://rubertogo.com/api/products");h(e.data)}catch(e){console.error("Error fetching products:",e)}finally{p(!1)}};return e.jsx(l,{open:r,onClose:s,children:e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-70 z-50",children:e.jsxs("div",{className:"bg-white  max-w-5xl rounded-lg shadow-lg overflow-hidden relative",children:[e.jsx("div",{className:"p-6 bg-gradient-to-r from-indigo-500 to-purple-500 text-white text-center",children:e.jsx(n,{variant:"h5",className:"text-2xl font-bold",children:"Seleziona Prodotti Aggiuntivi"})}),g?e.jsx("div",{className:"flex justify-center items-center py-10",children:e.jsx(o,{})}):e.jsx("div",{className:"p-6 space-y-6 h-[60vh] overflow-y-auto",children:m.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:m.map((r=>{return e.jsxs("div",{className:"border rounded-lg shadow-md transition-all flex flex-col justify-between items-center "+(u.some((e=>e._id===r._id))?"bg-indigo-50 border-indigo-500":"bg-white border-gray-200"),style:{height:"350px",maxWidth:"100%",padding:"1rem"},onClick:()=>(e=>{x((r=>r.find((r=>r._id===e._id))?r.filter((r=>r._id!==e._id)):[...r,e]))})(r),children:[e.jsx(d,{title:r.name,placement:"top",children:e.jsx("div",{className:"w-full h-40 flex items-center justify-center overflow-hidden rounded-lg mb-4 bg-gray-100 line-clamp-1",style:{flexShrink:0},children:r.image?e.jsx("img",{src:r.image,alt:r.name,className:"w-full h-full object-cover"}):(s=r.name,e.jsxs("svg",{viewBox:"0 0 200 150",xmlns:"http://www.w3.org/2000/svg",className:"w-full h-full",children:[e.jsx("rect",{width:"200",height:"150",fill:"#f3f4f6",rx:"15",ry:"15"}),e.jsx("text",{x:"50%",y:"50%",dominantBaseline:"middle",textAnchor:"middle",fontSize:"18",fontWeight:"bold",fill:"#374151",children:s})]}))})}),e.jsx(n,{variant:"body1",className:"font-extrabold text-xl text-gray-800 truncate w-full text-center",children:r.name}),e.jsxs("span",{className:"text-2xl text-gray-500 text-center",children:[r.price," CHF"]}),e.jsx(n,{variant:"body2",className:"text-sm text-gray-600 mt-2 text-center",children:r.description||"No description available."})]},r._id);var s}))}):e.jsx(n,{variant:"body1",className:"text-center text-gray-600",children:"Nessun prodotto disponibile."})}),e.jsxs("div",{className:"p-6 bg-gray-100 flex justify-end space-x-4",children:[e.jsx(c,{variant:"outlined",color:"secondary",onClick:s,className:"rounded-lg",children:"Annulla"}),e.jsx(c,{variant:"contained",color:"primary",onClick:()=>{a(u),s()},disabled:g||0===u.length,className:"rounded-lg px-6 py-2 shadow-md hover:shadow-lg transition-all",children:"Conferma Selezione"})]})]})})})},M=R("pk_live_51PwWTGDCK8rR2FJAZlmM7KPakXDO09KCBJRjUT5QRFNRRTvlctb9KG8D9bxZ38RRsG6np5RYrJmVG2AeP22KXq7P00rQKtFDnq"),J="https://rubertogo.com",V=e=>{var r;const s=T().format("dddd"),a=null==(r=e.dailyPricing)?void 0:r.find((e=>e.day===s));return(null==a?void 0:a.pricePerHour)?`${a.pricePerHour} CHF`:"Not available"},G=e=>{var r;const s=T().format("dddd"),a=null==(r=e.dailyPricing)?void 0:r.find((e=>e.day===s));return(null==a?void 0:a.kilometers)?`${a.kilometers} km`:"Not available"},Z=e=>{var r,s;const a=T().format("dddd"),t=null==(r=e.dailyPricing)?void 0:r.find((e=>e.day===a));return(null==(s=null==t?void 0:t.extraPerKm)?void 0:s.toFixed(2))?`${t.extraPerKm.toFixed(2)} CHF `:"Not available"},X=()=>{var r,s,l,R,X;const[U,Q]=t.useState({firstName:"",lastName:"",address:"",email:"",phone:"",idDocumentFront:null,idDocumentBack:null,licenseFront:null,licenseBack:null,isNotDriver:!1,referralCode:"",timeZone:"",driverInfo:{driverFirstName:"",driverLastName:"",driverAddress:"",driverEmail:"",driverPhone:"",driverLicenseFront:null,driverLicenseBack:null,driverIdDocumentFront:null,driverIdDocumentBack:null}}),[ee,re]=t.useState(!1),[se,ae]=t.useState(""),[te,ie]=t.useState(null),[le,ne]=t.useState(!1),{lang:oe}=m(),[de,ce]=t.useState(!1),[me,he]=t.useState(""),[ue,xe]=t.useState(""),ge=t.useRef([]),[pe,ve]=t.useState(null),je=localStorage.getItem("accessToken"),[fe,be]=t.useState(!1),[Ne,ye]=t.useState(null),{translations:we}=$(),[ke,Pe]=t.useState(!1),[De,Ie]=t.useState(null),[Ce,Fe]=t.useState(!1),[Se,Ae]=t.useState(""),[Le,ze]=t.useState(null),[Be,Te]=t.useState(!1),[Re,$e]=t.useState([]),[He,qe]=t.useState(!1),[Ee,Oe]=t.useState(null),[We,Ke]=t.useState(null),[Ye,_e]=t.useState(0),[Me,Je]=t.useState(!1),Ve=e=>{Ie(e)};t.useEffect((()=>{Q((e=>({...e,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone})))}),[]);t.useEffect((()=>{je&&(async()=>{try{const e=await i.get(`${J}/api/user-profile`,{headers:{Authorization:`Bearer ${je}`}});if(200===e.status){const{referralCode:r,...s}=e.data.user;Q((e=>({...e,...s}))),Ae(r)}}catch(e){console.error("Error fetching user profile:",e),B.error("Failed to fetch user data. Please try again.")}})()}),[je]),t.useEffect((()=>{const e=localStorage.getItem("bookingData");e&&ie(JSON.parse(e))}),[]);const Ge=e=>{const{name:r,value:s}=e.target;Q((e=>({...e,[r]:s})))},Ze=t.useCallback(h.debounce((async e=>{try{201===(await i.post(`${J}/api/exist-account`,{email:e})).status?ne(!0):ne(!1)}catch(r){console.error("Error checking account existence:",r)}}),500),[]),Xe=e=>{const{name:r,value:s}=e.target;Q((e=>({...e,driverInfo:{...e.driverInfo,[r]:s}})))},Ue=async(e,r,s=!1)=>{const a=e[0],t=await(async e=>{const r=new FormData;r.append("file",e);try{return(await i.post(`${J}/api/upload`,r,{headers:{"Content-Type":"multipart/form-data"}})).data.imageURL}catch(s){return console.error("Error uploading file:",s),B.error("Failed to upload file. Please try again."),null}})(a);t&&Q(s?e=>({...e,driverInfo:{...e.driverInfo,[r]:t}}):e=>({...e,[r]:t}))},{getRootProps:Qe,getInputProps:er}=u({onDrop:e=>Ue(e,"idDocumentFront"),accept:"image/*"}),{getRootProps:rr,getInputProps:sr}=u({onDrop:e=>Ue(e,"idDocumentBack"),accept:"image/*"}),{getRootProps:ar,getInputProps:tr}=u({onDrop:e=>Ue(e,"licenseFront"),accept:"image/*"}),{getRootProps:ir,getInputProps:lr}=u({onDrop:e=>Ue(e,"licenseBack"),accept:"image/*"}),{getRootProps:nr,getInputProps:or}=u({onDrop:e=>Ue(e,"driverIdDocumentFront",!0),accept:"image/*"}),{getRootProps:dr,getInputProps:cr}=u({onDrop:e=>Ue(e,"driverIdDocumentBack",!0),accept:"image/*"}),{getRootProps:mr,getInputProps:hr}=u({onDrop:e=>Ue(e,"driverLicenseFront",!0),accept:"image/*"}),{getRootProps:ur,getInputProps:xr}=u({onDrop:e=>Ue(e,"driverLicenseBack",!0),accept:"image/*"}),gr=e=>{const r=new Date(e);return`${String(r.getDate()).padStart(2,"0")}/${String(r.getMonth()+1).padStart(2,"0")}/${r.getFullYear()}`},pr=()=>{var e;const r=((null==te?void 0:te.totalPrice)||0)+Re.reduce(((e,r)=>e+r.price),0)+(He&&(null==(e=null==te?void 0:te.vanDetails)?void 0:e.unlimitedKilometersPrice)||0);return{previousTotalPrice:r,finalTotalPrice:Me?r-("percentage"===We?r*Ye/100:Ye):r}},[vr,jr]=t.useState(null),[fr,br]=t.useState(null),{previousTotalPrice:Nr,finalTotalPrice:yr}=pr(),{isLoaded:wr}=x({googleMapsApiKey:"AIzaSyCJgOiSJeJlRdoFK_jTK-mNug5b22XPRn4",libraries:["places"]});if(!wr)return e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(o,{})});return e.jsx(e.Fragment,{children:ee?e.jsx(K,{}):e.jsxs(a.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:1},className:"max-w-full mx-auto ",children:[e.jsxs("div",{className:"relative h-[200px] sm:h-[250px] bg-cover flex justify-center items-center bg-center",style:{backgroundImage:"url('/hero.webp')"},children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-[#ff0707] to-[#ff5050] opacity-90"}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center justify-center h-full text-center text-white space-y-4 px-4",children:[e.jsx("span",{style:{alignItems:"center"},className:"text-3xl md:text-3xl font-bold",children:we.checkoutHeading}),e.jsx("span",{children:we.checkoutdescription})]})]}),e.jsxs("div",{className:"container mx-auto py-10 px-4 sm:px-6 lg:px-8",children:[se&&e.jsx("div",{className:"flex justify-center mt-4",children:e.jsxs("p",{className:"flex flex-col sm:flex-row items-center px-4 py-2 bg-red-100 border border-red-400 text-red-600 rounded-lg font-semibold",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mb-2 sm:mb-0 sm:mr-2 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18.364 5.636L5.636 18.364M5.636 5.636l12.728 12.728"})}),e.jsx("span",{className:"text-center sm:text-left",children:se}),te&&e.jsx(c,{sx:{marginTop:{xs:"1rem",sm:"0"},marginLeft:{sm:"1rem"}},variant:"outlined",color:"primary",onClick:()=>(e=>{const r=T().startOf("hour"),s=r.add(4,"hour"),a=4*e.pricePerHour;ye({...e,name:e.name.en||"Unnamed Van",description:e.description.en||"No description available.",totalPrice:a,startDate:r.format("YYYY-MM-DD"),endDate:s.format("YYYY-MM-DD"),startTime:r.format("h:mm A"),endTime:s.format("h:mm A")}),be(!0)})(te.vanDetails),children:"Seleziona un nuovo orario"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-10",children:[e.jsx("div",{className:"col-span-2",children:e.jsxs("form",{className:"space-y-6 p-5 bg-gray-50 shadow-md rounded-lg",children:[e.jsx(g,{label:e.jsxs("div",{className:"flex items-center",children:[we.checkoutemail,e.jsx(d,{title:"Email is required for booking confirmation",children:e.jsx(j,{size:"small",className:"ml-1",children:e.jsx(f,{})})})]}),placeholder:we.checkoutemail,name:"email",type:"email",fullWidth:!0,variant:"outlined",value:U.email,onChange:e=>{const r=e.target.value;Q((e=>({...e,email:r}))),Ze(r)},required:!0,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(v,{className:"text-gray-500"})})},className:"transition duration-300 focus-within:shadow-md rounded-lg"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(g,{label:e.jsxs("div",{className:"flex items-center",children:[we.checkoutFirstName,e.jsx(d,{title:"First name is required for booking confirmation",children:e.jsx(j,{size:"small",className:"ml-1",children:e.jsx(f,{})})})]}),placeholder:we.checkoutFirstName,name:"firstName",fullWidth:!0,variant:"outlined",value:U.firstName,onChange:Ge,required:!0,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(b,{className:"text-gray-500"})})},className:"transition duration-300 focus-within:shadow-md rounded-lg"}),e.jsx(g,{label:e.jsxs("div",{className:"flex items-center",children:[we.checkoutLastName,e.jsx(d,{title:"Last name is required for booking confirmation",children:e.jsx(j,{size:"small",className:"ml-1",children:e.jsx(f,{})})})]}),placeholder:we.checkoutLastName,name:"lastName",fullWidth:!0,variant:"outlined",value:U.lastName,onChange:Ge,required:!0,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(b,{className:"text-gray-500"})})},className:"transition duration-300 focus-within:shadow-md rounded-lg"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-1 gap-6",children:e.jsx(N,{onLoad:e=>{jr(e)},onPlaceChanged:()=>{if(vr){const e=vr.getPlace();if(e&&e.geometry){const r=e.formatted_address;Q((e=>({...e,address:r})))}else B.error("Please select a valid address.")}},children:e.jsx(g,{label:e.jsxs("div",{className:"flex items-center",children:[we.checkoutAddress,e.jsx(d,{title:"Address is required for booking confirmation",children:e.jsx(j,{size:"small",className:"ml-1",children:e.jsx(f,{})})})]}),placeholder:we.checkoutAddress,name:"address",fullWidth:!0,variant:"outlined",value:U.address,onChange:Ge,required:!0,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(y,{className:"text-gray-500"})})},className:"transition duration-300 focus-within:shadow-md rounded-lg"})})}),e.jsx(g,{label:e.jsxs("div",{className:"flex items-center",children:[we.checkoutphone,e.jsx(d,{title:"Phone number is required for booking confirmation",children:e.jsx(j,{size:"small",className:"ml-1",children:e.jsx(f,{})})})]}),placeholder:we.checkoutphone,name:"phone",fullWidth:!0,variant:"outlined",value:U.phone,onChange:Ge,required:!0,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(w,{className:"text-gray-500"})})},className:"transition duration-300 focus-within:shadow-md rounded-lg"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs(k,{children:[we.checkoutIdFront,e.jsx(d,{title:"You must provide a valid ID document",children:e.jsx(j,{size:"small",className:"ml-1",children:e.jsx(f,{})})})]}),e.jsxs("div",{...Qe(),className:"p-4 border-dashed border-2 border-gray-300 mt-2 rounded-lg hover:shadow-lg transition-all",children:[e.jsx("input",{...er()}),U.idDocumentFront?e.jsx("img",{src:U.idDocumentFront,alt:"ID Front Preview",className:"w-full h-40 object-cover mt-2 rounded-md"}):e.jsx("p",{className:"text-gray-500",children:we.draganddrop})]})]}),e.jsxs("div",{children:[e.jsxs(k,{children:[we.checkoutIdBack,e.jsx(d,{title:"You must provide a valid ID document",children:e.jsx(j,{size:"small",className:"ml-1",children:e.jsx(f,{})})})]}),e.jsxs("div",{...rr(),className:"p-4 border-dashed border-2 border-gray-300 mt-2 rounded-lg hover:shadow-lg transition-all",children:[e.jsx("input",{...sr()}),U.idDocumentBack?e.jsx("img",{src:U.idDocumentBack,alt:"ID Back Preview",className:"w-full h-40 object-cover mt-2 rounded-md",lazy:"true"}):e.jsx("p",{className:"text-gray-500",children:we.draganddrop})]})]})]}),!U.isNotDriver&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs(k,{children:[we.checkoutLicenseFront,e.jsx(d,{title:"You must provide a valid driver license",children:e.jsx(j,{size:"small",className:"ml-1",children:e.jsx(f,{})})})]}),e.jsxs("div",{...ar(),className:"p-4 border-dashed border-2 border-gray-300 mt-2 rounded-lg hover:shadow-lg transition-all",children:[e.jsx("input",{...tr()}),U.licenseFront?e.jsx("img",{src:U.licenseFront,alt:"Driver License Front Preview",className:"w-full h-40 object-cover mt-2 rounded-md",lazy:"true"}):e.jsx("p",{className:"text-gray-500",children:we.draganddrop})]})]}),e.jsxs("div",{children:[e.jsxs(k,{children:[we.checkoutLicenseBack,e.jsx(d,{title:"You must provide a valid driver license",children:e.jsx(j,{size:"small",className:"ml-1",children:e.jsx(f,{})})})]}),e.jsxs("div",{...ir(),className:"p-4 border-dashed border-2 border-gray-300 mt-2 rounded-lg hover:shadow-lg transition-all",children:[e.jsx("input",{...lr()}),U.licenseBack?e.jsx("img",{src:U.licenseBack,alt:"Driver License Back Preview",className:"w-full h-40 object-cover mt-2 rounded-md",lazy:"true"}):e.jsx("p",{className:"text-gray-500",children:we.draganddrop})]})]})]})}),e.jsx(P,{control:e.jsx(D,{checked:U.isNotDriver,onChange:e=>{Q((r=>({...r,isNotDriver:e.target.checked})))},name:"isNotDriver",color:"primary"}),label:e.jsxs("div",{className:"flex items-center",children:[we.checkoutImnotdriver,e.jsx(d,{title:"Check this box if you are not the driver",children:e.jsx(j,{size:"small",className:"ml-1",children:e.jsx(f,{})})})]})}),e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsx(P,{control:e.jsx(D,{checked:Ce,onChange:e=>Fe(e.target.checked),color:"primary"}),label:e.jsxs("div",{className:"flex items-center",children:[we.applyReferalCode,e.jsx(d,{title:"Enter a valid referral code to get a discount",children:e.jsx(j,{size:"small",className:"ml-1",children:e.jsx(f,{})})})]})}),Ce&&e.jsx(g,{label:we.checkoutReferralCode,name:"referralCode",variant:"outlined",fullWidth:!0,value:U.referralCode,onChange:e=>{const r=e.target.value;Q((e=>({...e,referralCode:r}))),r&&r!==Se?(async e=>{try{200===(await i.post(`${J}/api/valid-referral-code`,{referralCode:e},{headers:{Authorization:`Bearer ${je}`}})).status&&B.success("Referral code is valid.")}catch(r){console.error("Error validating referral code:",r),B.error("Invalid referral code.")}})(r):ze(null)},InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(I,{className:"text-gray-500"})})},className:"transition duration-300 focus-within:shadow-md rounded-lg "+(!0===Le?"border-green-500":!1===Le?"border-red-500":""),helperText:!0===Le?"Referral code is valid!":!1===Le?"Invalid referral code":""})]}),U.isNotDriver&&e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"h6",className:"font-bold mt-6",children:we.checkoutDriverInformationHeading}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(g,{label:we.checkoutDriverFirstName,name:"driverFirstName",fullWidth:!0,variant:"outlined",value:U.driverInfo.driverFirstName,onChange:Xe,required:!0,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(b,{className:"text-gray-500"})})},className:"transition duration-300 focus-within:shadow-md rounded-lg"}),e.jsx(g,{label:we.checkoutDriverLastName,name:"driverLastName",fullWidth:!0,variant:"outlined",value:U.driverInfo.driverLastName,onChange:Xe,required:!0,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(b,{className:"text-gray-500"})})},className:"transition duration-300 focus-within:shadow-md rounded-lg"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(N,{onLoad:e=>{br(e)},onPlaceChanged:()=>{if(fr){const e=fr.getPlace();if(e&&e.geometry){const r=e.formatted_address;Q((e=>({...e,driverInfo:{...e.driverInfo,driverAddress:r}})))}else B.error("Please select a valid address for the driver.")}},children:e.jsx(g,{label:we.checkoutDriverAddress,name:"driverAddress",fullWidth:!0,variant:"outlined",value:U.driverInfo.driverAddress,onChange:Xe,required:!0,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(y,{className:"text-gray-500"})})},className:"transition duration-300 focus-within:shadow-md rounded-lg"})}),e.jsx(g,{label:we.checkoutDriverEmail,name:"driverEmail",type:"email",fullWidth:!0,variant:"outlined",value:U.driverInfo.driverEmail,onChange:Xe,required:!0,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(v,{className:"text-gray-500"})})},className:"transition duration-300 focus-within:shadow-md rounded-lg"})]}),e.jsx(g,{label:we.checkoutDriverPhone,name:"driverPhone",fullWidth:!0,variant:"outlined",value:U.driverInfo.driverPhone,onChange:Xe,required:!0,InputProps:{startAdornment:e.jsx(p,{position:"start",children:e.jsx(w,{className:"text-gray-500"})})},className:"transition duration-300 focus-within:shadow-md rounded-lg"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(k,{children:we.checkoutDriverIdFront}),e.jsxs("div",{...mr(),className:"p-4 border-dashed border-2 border-gray-300 mt-2 rounded-lg hover:shadow-lg transition-all",children:[e.jsx("input",{...hr()}),U.driverInfo.driverLicenseFront?e.jsx("img",{src:U.driverInfo.driverLicenseFront,alt:"Driver License Front Preview",className:"w-full h-40 object-cover mt-2 rounded-md",lazy:"true"}):e.jsx("p",{className:"text-gray-500",children:we.draganddrop})]})]}),e.jsxs("div",{children:[e.jsxs(k,{children:[" ",we.checkoutDriverIdBack," "]}),e.jsxs("div",{...ur(),className:"p-4 border-dashed border-2 border-gray-300 mt-2 rounded-lg hover:shadow-lg transition-all",children:[e.jsx("input",{...xr()}),U.driverInfo.driverLicenseBack?e.jsx("img",{src:U.driverInfo.driverLicenseBack,alt:"Driver License Back Preview",className:"w-full h-40 object-cover mt-2 rounded-md",lazy:"true"}):e.jsx("p",{className:"text-gray-500",children:we.draganddrop})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs(k,{children:[" ",we.checkoutDriverLicenseFront," "]}),e.jsxs("div",{...nr(),className:"p-4 border-dashed border-2 border-gray-300 mt-2 rounded-lg hover:shadow-lg transition-all",children:[e.jsx("input",{...or()}),U.driverInfo.driverIdDocumentFront?e.jsx("img",{src:U.driverInfo.driverIdDocumentFront,alt:"Driver ID Front Preview",className:"w-full h-40 object-cover mt-2 rounded-md",lazy:"true"}):e.jsx("p",{className:"text-gray-500",children:we.draganddrop})]})]}),e.jsxs("div",{children:[e.jsxs(k,{children:[" ",we.checkoutDriverLicenseBack," "]}),e.jsxs("div",{...dr(),className:"p-4 border-dashed border-2 border-gray-300 mt-2 rounded-lg hover:shadow-lg transition-all",children:[e.jsx("input",{...cr()}),U.driverInfo.driverIdDocumentBack?e.jsx("img",{src:U.driverInfo.driverIdDocumentBack,alt:"Driver ID Back Preview",className:"w-full h-40 object-cover mt-2 rounded-md",lazy:"true"}):e.jsx("p",{className:"text-gray-500",children:we.draganddrop})]})]})]})]})]})}),e.jsx("div",{className:"sm:col-span-1 col-span-2",children:e.jsx("div",{className:"bg-white  rounded-2xl p-8 border border-gray-200",children:e.jsxs("div",{className:"flex flex-col space-y-6",children:[te&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("img",{src:null==(r=null==te?void 0:te.vanDetails)?void 0:r.images[0],alt:"Van",className:"w-full flex justify-center rounded-lg object-container ",lazy:"true"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800",children:[e.jsx(C,{className:"inline-block text-green-800 mr-2"}),(null==(s=te.vanDetails)?void 0:s.name[oe])||(null==(l=te.vanDetails)?void 0:l.name.en)]}),e.jsxs("p",{className:"text-md text-gray-600",children:[e.jsx(F,{className:"inline-block text-green-800 mr-2"}),e.jsxs("span",{className:"font-semibold",children:[we.totalHours,":"]})," ",te.selectedSlots.length]}),e.jsxs("p",{className:"text-md text-gray-600",children:[e.jsx(S,{className:"inline-block  text-green-800 mr-2"}),e.jsxs("span",{className:"font-semibold",children:[we.hourPrice,":"]})," ",V(te.vanDetails)]})]}),e.jsxs("div",{className:"text-md text-gray-600 space-y-1",children:[e.jsxs("p",{children:[e.jsx(A,{className:"inline-block text-green-800 mr-2"}),we.includes," ",G(te.vanDetails)]}),e.jsxs("p",{children:[e.jsx(A,{className:"inline-block text-green-800 mr-2"}),we.extraPerKm," ",Z(te.vanDetails)]})]}),e.jsx("div",{className:"space-y-1",children:te.vanDetails.preAuthorizationAmount>0?e.jsxs("p",{className:"text-gray-600 text-md font-semibold",children:[e.jsx(A,{className:"inline-block text-green-800 mr-2"}),we.securityDiposit,":"," ",te.vanDetails.preAuthorizationAmount," ","CHF"]}):e.jsxs("p",{className:"text-red-600  text-md font-semibold",children:[e.jsx(L,{className:"inline-block mr-2"}),we.nosecurityDiposit]})})]}),(null==(R=null==te?void 0:te.vanDetails)?void 0:R.unlimitedKilometersPrice)>0&&e.jsx(P,{control:e.jsx(D,{checked:He,onChange:e=>{qe(e.target.checked)},disableRipple:!0,icon:e.jsx("div",{className:"relative w-10 h-6 bg-gray-500 rounded-full shadow-inner transition duration-300",children:e.jsx("div",{className:"absolute left-1 top-1 w-4 h-4 bg-white rounded-full shadow-md transition-transform duration-300 transform"})}),checkedIcon:e.jsx("div",{className:"relative w-10 h-6 bg-gradient-to-r from-green-400 to-blue-500 rounded-full shadow-lg transition duration-300",children:e.jsx("div",{className:"absolute left-1 top-1 w-4 h-4 bg-white rounded-full shadow-md transition-transform duration-300 transform translate-x-4"})})}),label:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-4",children:[e.jsx("span",{className:"text-md font-semibold text-gray-900",children:we.unlimitedKm}),e.jsxs("span",{className:"px-2 py-1 w-24 text-center text-lg font-bold text-white bg-gradient-to-r from-green-500 via-blue-500 to-purple-500 rounded-lg shadow-md",children:[null==(X=null==te?void 0:te.vanDetails)?void 0:X.unlimitedKilometersPrice," ","CHF"]})]}),className:"text-lg font-semibold text-gray-900",sx:{width:"100%",margin:"0 auto",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0.8rem 0.8rem",border:"1px solid #e2e8f0",borderRadius:"10px",transition:"transform 0.2s ease, box-shadow 0.3s ease"}}),Re.length>0&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200 shadow-sm",children:[e.jsx("h4",{className:"text-md font-semibold text-gray-800 mb-2",children:we.additionalProducts}),Re.map((r=>e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsx("span",{children:r.name}),e.jsxs("span",{children:[we.priceLabel,": ",r.price," CHF"]})]},r._id)))]}),e.jsxs("div",{className:"flex flex-col space-y-4  p-4 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(g,{label:we.applyCoupon,variant:"outlined",fullWidth:!0,value:U.couponCode,onChange:e=>Q({...U,couponCode:e.target.value}),disabled:Me,className:"transition duration-300 focus-within:shadow-md rounded-lg"}),e.jsx(c,{variant:"contained",color:"primary",sx:{padding:"14px 16px"},onClick:async()=>{var e,r;if(Me)B.error("A coupon has already been applied.");else try{const e=await i.post(`${J}/api/coupons/apply`,{code:U.couponCode,totalHours:te.selectedSlots.length,totalAmount:pr().previousTotalPrice});200===e.status&&(B.success("Coupon applied successfully!"),Oe(U.couponCode),Ke(e.data.discountType),_e(e.data.discountValue),Je(!0))}catch(s){B.error((null==(r=null==(e=s.response)?void 0:e.data)?void 0:r.error)||"Failed to apply coupon.")}},disabled:Me||!U.couponCode,children:Me?"Applied":"Apply"})]}),Me&&e.jsxs("p",{className:"text-green-600 font-semibold",children:["âœ…"," ","percentage"===We?`${Ye}%`:`${Ye} CHF`," ","Applied"]})]}),e.jsx("div",{className:"text-center",children:e.jsx("h5",{className:"text-2xl font-semibold text-gray-800 border p-5",children:Me?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"ml-2 text-red-300 line-through",children:[Nr.toFixed(2)," CHF"]}),e.jsxs("span",{className:"ml-2 text-gray-600 font-bold",children:[yr.toFixed(2)," CHF"]})]}):e.jsxs("span",{className:"ml-2 text-gray-600 font-bold",children:[Nr.toFixed(2)," CHF"]})})}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(D,{id:"termsCheckbox",checked:ke,onChange:e=>Pe(e.target.checked),className:"w-5 h-5 rounded focus:ring-blue-500"}),e.jsxs("label",{htmlFor:"termsCheckbox",className:"text-sm text-gray-700 leading-tight",children:[we.agreeToTerms," ",e.jsx("span",{onClick:()=>Ve("terms"),className:"text-blue-600 underline hover:text-blue-800 cursor-pointer font-semibold",children:we.termsLink})," ","&"," ",e.jsx("span",{onClick:()=>Ve("privacy"),className:"text-blue-600 underline hover:text-blue-800 cursor-pointer font-semibold",children:we.privacyLink})]})]}),e.jsx(c,{type:"button",variant:"contained",startIcon:e.jsx(z,{}),onClick:async e=>{var r,s;e.preventDefault(),e.stopPropagation(),re(!0),ae("");const a=["firstName","lastName","email","phone"];for(let i of a)if(!U[i])return B.error("Per favore, compila tutti i campi richiesti."),void re(!1);if([U.idDocumentFront,U.idDocumentBack,U.licenseFront,U.licenseBack,...U.isNotDriver?[U.driverInfo.driverFirstName,U.driverInfo.driverLastName,U.driverInfo.driverAddress,U.driverInfo.driverEmail,U.driverInfo.driverPhone,U.driverInfo.driverIdDocumentFront,U.driverInfo.driverIdDocumentBack,U.driverInfo.driverLicenseFront,U.driverInfo.driverLicenseBack]:[]].some((e=>!e)))return B.error("Per favore carica tutti i documenti richiesti."),void re(!1);const t={...U,selectedSlots:te.selectedSlots.map((e=>({...e,date:gr(e.date)}))),totalPrice:yr,vanId:te.vanDetails._id,driverInfo:JSON.stringify(U.driverInfo)};Ce&&U.referralCode&&U.referralCode!==Se&&(t.referralCode=U.referralCode);try{re(!0);const{data:e}=await i.post(`${J}/api/create-booking`,t,{headers:{"Content-Type":"application/json"}});xe(e.email),ce(!0),ve(e.sessionId)}catch(l){console.error("Error during checkout:",l);const e=(null==(s=null==(r=l.response)?void 0:r.data)?void 0:s.error)||"Failed to initiate payment. Please try again.";B.error(e),ae(e)}finally{re(!1)}},disabled:!ke||ee,className:"w-full py-10 rounded-xl text-xl font-bold shadow-xl transition-transform "+(ke?"hover:scale-105 bg-gradient-to-r from-blue-500 to-blue-600 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:ee?e.jsx(o,{size:24,color:"inherit"}):`${we.payNow} ${yr.toFixed(2)} CHF`})]})})})]})]}),le&&e.jsx(H,{open:le,handleClose:()=>ne(!1),email:U.email}),e.jsx(E,{open:de,handleClose:()=>ce(!1),otp:me,setOtp:he,onVerify:async e=>{try{const r=await i.post(`${J}/api/verify-otp`,{email:ue,otp:e}),{accessToken:s,refreshToken:a}=r.data;localStorage.setItem("accessToken",s),localStorage.setItem("refreshToken",a),B.success("OTP verified successfully!"),ce(!1),he("");const t=await M,{error:l}=await t.redirectToCheckout({sessionId:pe});l&&(console.error("Stripe Redirect Error:",l),B.error("Failed to redirect to payment. Please try again."))}catch(r){console.error("OTP Verification Failed:",r),B.error("Invalid or expired OTP.")}},otpRefs:ge,otpLength:4}),fe&&Ne&&e.jsx(q,{isOpen:fe,onClose:()=>be(!1),van:Ne,totalPrice:Ne.totalPrice,startDate:Ne.startDate,endDate:Ne.endDate,startTime:Ne.startTime,endTime:Ne.endTime}),e.jsx(_,{isOpen:Be,onClose:()=>Te(!1),onSelectProduct:e=>{$e(e)}}),e.jsx("div",{className:"fixed top-64 right-0 mt-4 mr-4 z-50",children:e.jsxs("div",{className:"relative flex items-center group",children:[e.jsx("div",{className:"relative w-16 h-16 bg-gradient-to-br from-purple-500 to-blue-500 rounded-full flex justify-center items-center shadow-xl transition-transform transform group-hover:scale-110 group-hover:shadow-2xl",children:e.jsxs("button",{onClick:()=>Te(!0),className:"w-full h-full flex justify-center items-center rounded-full focus:outline-none",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-10 h-10 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 4v16m8-8H4",className:"origin-center animate-pulse"})}),e.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-r from-blue-400 via-purple-500 to-pink-500 opacity-50 blur-xl animate-pulse group-hover:blur-2xl"})]})}),e.jsx("div",{className:"absolute right-20 top-0 bg-gradient-to-r from-blue-500 to-purple-500 text-white font-semibold text-sm px-6 py-2 rounded-full shadow-lg transition-all duration-500 opacity-0 group-hover:opacity-100 group-hover:translate-x-4",children:e.jsx("span",{className:"block animate-slide-text",children:"Aggiungi Prodotti"})})]})}),e.jsxs(Y,{isOpen:!!De,onClose:()=>{Ie(null)},children:["terms"===De&&e.jsx("div",{children:e.jsx(W,{})}),"privacy"===De&&e.jsx("div",{children:e.jsx(O,{})})]})]})})};export{X as default};
