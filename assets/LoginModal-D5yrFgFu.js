import{r as e,a as t,j as a,bf as r,f as n,cm as s,a$ as o,g as l,a2 as c,bi as i,cn as d,a4 as u,b8 as m,b as g,aV as f}from"./vendor-Zgq9WbFI.js";import{a as h}from"./index-D29cp_SG.js";const x="https://rubertogo.com",p=({open:p,handleClose:v,email:y})=>{const[j,w]=e.useState(y||""),[b,C]=e.useState(["","","",""]),[T,P]=e.useState(1),[k,$]=e.useState(""),[S,I]=e.useState(!1),[N,O]=e.useState(600),[A,D]=e.useState(!1),E=e.useRef([]),B=e.useRef(null),{lang:F}=t(),{translations:L}=h(),R=()=>{I(!1),O(600),B.current&&clearInterval(B.current),B.current=setInterval((()=>{O((e=>e<=1?(clearInterval(B.current),I(!0),0):e-1))}),1e3)},z=e=>{var t;const a=e.clipboardData.getData("Text").slice(0,b.length);if(/^\d{4}$/.test(a)){const e=a.split("").slice(0,b.length);C(e),null==(t=E.current[e.length-1])||t.focus()}};return e.useEffect((()=>()=>{B.current&&clearInterval(B.current)}),[]),a.jsx(r,{open:p,onClose:v,"aria-labelledby":"login-modal",children:a.jsxs(n,{className:"flex relative flex-col items-center p-10  bg-white rounded-lg shadow-lg max-w-2xl w-full",sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:[a.jsx(s,{open:A,sx:{color:"#fff",zIndex:1301},children:a.jsx(o,{color:"inherit"})}),a.jsx("button",{onClick:v,className:"absolute top-0 right-2 p-2 rounded-full text-2xl text-red-500",children:"Ã—"}),a.jsx("div",{className:"w-full shadow-sm mb-4",style:{width:"250px"},children:a.jsx("img",{src:"/rubertogo-logo.svg",alt:"Rubertogo Logo"})}),a.jsx(l,{variant:"h5",align:"center",gutterBottom:!0,children:1===T?`${L.loginAccount}`:`${L.enterCode}`}),1===T?a.jsxs(a.Fragment,{children:[a.jsx(c,{fullWidth:!0,label:"Email",variant:"outlined",placeholder:"Enter your email",value:j,required:!0,error:Boolean(k),helperText:k||"",onChange:e=>w(e.target.value),InputProps:{startAdornment:a.jsx(i,{position:"start",children:a.jsx(d,{className:"text-gray-500",size:24})})},className:"mb-4",style:{marginBottom:"1rem"}}),a.jsx(u,{onClick:async()=>{if(j&&/^[\w-.]+@([\w-]+\.)+[\w-]{2,4}$/.test(j)){$(""),D(!0);try{const e=await g.post(`${x}/api/login`,{email:j});D(!1),201===e.status?(P(2),R(),f.success("OTP sent to your email.")):$("Failed to send OTP. Please try again.")}catch(e){D(!1),$("An error occurred. Please try again."),console.error(e)}}else $("Please enter a valid email.")},variant:"contained",color:"primary",className:"w-full",children:L.sendCode})]}):a.jsxs(a.Fragment,{children:[a.jsx(l,{align:"center",className:"mb-4",sx:{margin:"10px"},children:L.loginModalTitle}),a.jsx(n,{display:"flex",justifyContent:"center",gap:1,mb:2,children:b.map(((e,t)=>a.jsx(c,{inputRef:e=>E.current[t]=e,type:"text",variant:"outlined",value:e,onChange:e=>((e,t)=>{var a;const{value:r}=e.target;if(r&&/^\d$/.test(r)){const e=[...b];e[t]=r,C(e),t<b.length-1&&(null==(a=E.current[t+1])||a.focus())}else if(!r){const e=[...b];e[t]="",C(e)}})(e,t),onKeyDown:e=>((e,t)=>{var a;if("Backspace"===e.key)if(b[t]){const e=[...b];e[t]="",C(e)}else t>0&&(null==(a=E.current[t-1])||a.focus())})(e,t),onPaste:0===t?z:void 0,inputProps:{maxLength:1,inputMode:"numeric",style:{textAlign:"center",fontSize:"1.5rem",width:"2rem",height:"2rem"}}},t)))}),a.jsx(l,{align:"center",variant:"body2",color:"textSecondary",children:S?"CODE has expired. Please resend.":`Time remaining: ${(e=>{const t=e%60;return`${Math.floor(e/60)}:${t<10?"0":""}${t}`})(N)}`}),S&&a.jsx(u,{onClick:async()=>{D(!0);try{const e=await g.post(`${x}/api/resend-otp`,{email:j});D(!1),201===e.status?(R(),f.success("OTP resent successfully!")):f.error("Failed to resend OTP. Please try again.")}catch(e){D(!1),f.error("An error occurred while resending OTP."),console.error(e)}},variant:"text",color:"secondary",className:"mt-2",children:L.resentCode}),a.jsx(u,{onClick:async e=>{e.preventDefault();const t=b.join("");if(4===t.length){D(!0);try{const e=await g.post(`${x}/api/verify-otp`,{email:j,otp:t});D(!1);const{accessToken:a,refreshToken:r}=e.data;localStorage.setItem("accessToken",a),localStorage.setItem("refreshToken",r),f.success("Login successful!"),window.location.pathname===`/${F}`||"/"===window.location.pathname?window.location.href=`/${F||"en"}/account`:window.location.reload(),v()}catch(a){D(!1),f.error("Invalid or expired OTP."),console.error(a)}}else f.error("Please enter a valid 4-digit OTP.")},variant:"contained",color:"primary",className:"w-full",startIcon:a.jsx(m,{}),sx:{backgroundColor:"#4565f7",color:"#fff",marginTop:"1rem","&:hover":{backgroundColor:"#388e3c"}},children:L.submitOtp}),a.jsx(u,{variant:"contained",color:"secondary",fullWidth:!0,onClick:()=>P(1),className:"mt-4",sx:{backgroundColor:"#f44336",color:"#fff",marginTop:"1rem","&:hover":{backgroundColor:"#d32f2f"}},children:L.changeEmail})]})]})})};export{p as L};
