import{r as a,d as l,j as o,F as s}from"./index-l_K3aXtX.js";import{M as j}from"./Modal-B3u_ui_M.js";import{D as P}from"./DataGrid-BD3vHCVv.js";import"./createSimplePaletteValueFilter-BtcuYd6h.js";import"./Portal-DJ62drf7.js";import"./CircularProgress-CwSTxCM5.js";import"./useSlot-ixWl2-B5.js";import"./useTheme-mzsciiAq.js";import"./useTheme-BJ2eetf3.js";import"./index-rYpT1TzP.js";import"./Select-D24LhUbi.js";import"./Menu-BKbYykOQ.js";import"./Grow-DcTcdrsK.js";import"./List-DgI9Fo7q.js";import"./Paper-CyNIrwR6.js";import"./useControlled-LwTdmPAX.js";import"./createSvgIcon-DbYB0CI1.js";import"./index-BCtXaJ4G.js";import"./Close-C3AZ6TUD.js";import"./Badge-DJL8KpYB.js";import"./Tooltip-C8YetgCC.js";import"./Chip-L2rSSoY7.js";import"./IconButton-kHPX5xhj.js";import"./ClickAwayListener-AffCjIIC.js";import"./MenuItem-BywNSZMn.js";import"./listItemTextClasses-myzqhlWt.js";import"./dividerClasses-D7PxQeec.js";import"./Toolbar-y_zv8MhA.js";import"./ListItemText-DvEwPdwr.js";import"./Typography-CZDPsgqr.js";import"./TextField-CCY5dsj2.js";import"./isMuiElement-EJEjTxr9.js";import"./InputAdornment-C9nxi5qz.js";import"./Button-BNd6gP94.js";import"./Divider-CfRlQUeS.js";import"./FormControlLabel-BmT3_Aeh.js";import"./TableCell-DYW1Yz_J.js";import"./Skeleton-CEGYlRwS.js";const c="https://rubertogo.com",C={Pending:"bg-yellow-200 text-yellow-800",Canceled:"bg-red-200 text-red-800",Captured:"bg-green-200 text-green-800"},ue=()=>{const[x,f]=a.useState([]),[t,u]=a.useState(null),[A,p]=a.useState(!1),[m,i]=a.useState(!1);a.useEffect(()=>{n()},[]);const n=async()=>{try{const e=await l.get(`${c}/api/all-pre-authorization`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});e.data&&f(e.data)}catch(e){console.error("Error fetching pre-authorization data:",e)}},y=async e=>{if(!(t!=null&&t.id)){alert("Invalid booking selected. Please try again.");return}i(!0);try{(await l.post(`${c}/api/capture-pre-authorization`,{bookingId:t.id,amount:e},{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}})).data.success&&(s.success("Pre-authorization captured successfully."),n(),d())}catch(r){console.error("Error capturing pre-authorization:",r),s.error("Failed to capture pre-authorization. Please try again.")}finally{i(!1)}},z=async()=>{if(!(t!=null&&t.id)){alert("Invalid booking selected. Please try again.");return}i(!0);try{(await l.post(`${c}/api/cancel-pre-authorization`,{bookingId:t.id},{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}})).data.success&&(s.success("Pre-authorization canceled successfully."),n(),d())}catch(e){console.error("Error canceling pre-authorization:",e),s.error("Failed to cancel pre-authorization. Please try again.")}finally{i(!1)}},b=e=>{u(e),p(!0)},d=()=>{u(null),p(!1)},w=[{field:"name",headerName:"Name",width:150},{field:"phone",headerName:"Phone",width:150},{field:"authorizedAmount",headerName:"Authorized Amount",width:180},{field:"capturedAmount",headerName:"Captured Amount",width:180},{field:"holdDurationDays",headerName:"Hold Duration (Days)",width:180},{field:"status",headerName:"Status",width:150,renderCell:e=>{const r=C[e.value]||"bg-gray-200 text-gray-800";return o.jsx("div",{className:`px-2 py-2 flex mt-2 justify-center items-center rounded-full text-center text-sm font-medium ${r}`,children:e.value})}},{field:"actions",headerName:"Actions",width:200,renderCell:e=>o.jsx("button",{onClick:()=>b(e.row),className:"px-4  bg-blue-500 text-white rounded",children:"Manage"})}],N=x.map(e=>{var r,h,g;return{id:e._id,name:((r=e.userId)==null?void 0:r.firstName)+" "+((h=e.userId)==null?void 0:h.lastName)||"N/A",phone:e.phone||((g=e.userId)==null?void 0:g.phone)||"N/A",authorizedAmount:e.authorizedAmount||0,capturedAmount:e.capturedAmount!==void 0?e.capturedAmount:"N/A",holdDurationDays:e.holdDurationDays||"N/A",status:e.status||"Unknown"}});return o.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-md",children:[o.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Pre-Authorization Data"}),o.jsx("div",{style:{height:600,width:"100%"},children:o.jsx(P,{rows:N,columns:w,pageSize:10,rowsPerPageOptions:[10,20,50],checkboxSelection:!1,disableSelectionOnClick:!0,className:"text-gray-700"})}),o.jsx(j,{open:A,onClose:d,children:o.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-md mx-auto mt-20",children:[o.jsx("h2",{className:"text-lg font-bold mb-4",children:"Manage Pre-Authorization"}),o.jsxs("p",{children:["Authorized Amount: $",(t==null?void 0:t.authorizedAmount)||0]}),o.jsxs("p",{children:["Captured Amount: $",(t==null?void 0:t.capturedAmount)||0]}),o.jsxs("div",{className:"flex justify-end gap-4 mt-4",children:[o.jsx("button",{onClick:z,disabled:m,className:"px-4 py-2 bg-red-500 text-white rounded",children:"Refund"}),o.jsx("button",{onClick:()=>y(t==null?void 0:t.authorizedAmount),disabled:m,className:"px-4 py-2 bg-green-500 text-white rounded",children:"Capture"})]})]})})]})};export{ue as default};
