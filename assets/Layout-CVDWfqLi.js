import{a as oe,r as x,u as ie,l as re,b as M,j as e,A as ce,T as le,I as v,F as de,k as P,m as B,n as xe,o as pe,p as L,q as T,s as m,L as g,t as he,c as ue,v as N,w as j,x as O,y as G,z as b,C as k,E,G as I,H as D,J as R,K as C,O as $,P as U,S as fe,U as W,V as ge,W as me,X as je,Y as be,Z as ke,_ as Ce,$ as ye,a0 as we,a1 as ve,a2 as ze,a3 as J}from"./vendor-D-GSuRVS.js";import{u as Q}from"./index-DCNypv0y.js";const Se="/rubertogo-logo-white.svg",S="https://www.rubertogo.com",Ae=localStorage.getItem("accessToken"),z=re(S,{withCredentials:!0,auth:{token:Ae},reconnection:!0,reconnectionAttempts:1/0,reconnectionDelay:1e3}),V=new Audio("/mixkit-bell-notification-933.wav");function Fe(s){const o=s.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),i=decodeURIComponent(atob(o).split("").map(d=>"%"+("00"+d.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(i)}function Me({onMenuClick:s}){const{lang:l}=oe(),[o,i]=x.useState(null),[d,u]=x.useState([]),[p,f]=x.useState(null),[r,n]=x.useState(0),a=ie(),h=localStorage.getItem("accessToken"),y=Fe(h),{userRole:q,logout:X}=Q();x.useEffect(()=>(y&&y.id?z.emit("join",y.id):console.error("User ID not found in token."),z.on("notification",t=>{u(c=>[t,...c]),n(c=>c+1),Y()}),K(),()=>{z.off("notification")}),[]);const K=async()=>{try{const t=await M.get(`${S}/api/notifications`,{headers:{Authorization:`Bearer ${h}`},withCredentials:!0});u(t.data),n(t.data.filter(c=>!c.read).length)}catch(t){console.error("Failed to fetch notifications",t)}},Y=()=>{V.play().catch(t=>{console.error("Notification sound playback failed:",t),document.body.addEventListener("click",()=>V.play().catch(console.error),{once:!0})})},Z=t=>{i(t.currentTarget)},ee=t=>{f(t.currentTarget)},A=()=>{i(null)},F=()=>{f(null)},ne=()=>X(),te=async t=>{try{await M.put(`${S}/api/notifications/${t}/read`,{},{headers:{Authorization:`Bearer ${h}`},withCredentials:!0}),u(c=>c.map(w=>w._id===t?{...w,read:!0}:w)),n(c=>c-1)}catch(c){console.error("Failed to mark notification as read",c)}},ae=t=>{te(t._id),F(),a(`/${l}/system/notification/${t._id}`)},se=()=>{A(),a(`/${l}/system/site-content`)};return e.jsx(ce,{position:"fixed",sx:{backgroundColor:"#ff0707",zIndex:t=>t.zIndex.drawer+1},children:e.jsxs(le,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(v,{color:"inherit",edge:"start",sx:{display:{xs:"block",sm:"none"},mr:2},onClick:s,children:e.jsx(de,{size:20})}),e.jsxs(P,{sx:{display:"flex",alignItems:"center",flexGrow:1},children:[e.jsx("img",{src:Se,alt:"Company Logo",style:{maxWidth:"190px",height:"auto"}}),e.jsx(B,{variant:"h6",sx:{ml:2,display:{xs:"none",sm:"block"},fontWeight:"bold",color:"#fff"},children:q==="admin"?"Admin Dashboard":"Partner Dashboard"})]}),e.jsxs(P,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(v,{color:"inherit",onClick:ee,children:e.jsx(xe,{badgeContent:r,color:"error",children:e.jsx(pe,{size:24,className:"text-white"})})}),e.jsxs(L,{anchorEl:p,open:!!p,onClose:F,PaperProps:{sx:{bgcolor:"#021e49",color:"#fff",width:400}},children:[e.jsx(B,{variant:"h6",sx:{padding:"10px 16px",color:"#fff"},children:"Notifications"}),e.jsx(T,{}),d.slice(0,5).map(t=>e.jsx(m,{onClick:()=>ae(t),sx:{opacity:t.read?.5:1,color:"#fff","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.1)"}},children:e.jsx(g,{primary:t.title,secondary:t.message,sx:{"& .MuiTypography-root":{color:"#fff"}}})},t._id)),e.jsx(T,{}),e.jsx(m,{onClick:()=>a(`/${l}/system/notifications`),children:"View All Notifications"})]}),e.jsx(v,{color:"inherit",onClick:Z,children:e.jsx(he,{size:24,className:"text-white"})}),e.jsxs(L,{anchorEl:o,open:!!o,onClose:A,PaperProps:{sx:{bgcolor:"#021e49",color:"#fff"}},sx:{mt:2},children:[e.jsx(m,{onClick:se,sx:{"&:hover":{backgroundColor:"#fff"}},children:"Settings"}),e.jsx(m,{onClick:ne,sx:{"&:hover":{backgroundColor:"#fff"}},children:"Logout"})]})]})]})})}const Pe={admin:[{text:"Overview",icon:e.jsx(R,{size:20}),path:"/:lang/admin/overview"},{text:"Booked Monitoring",icon:e.jsx(ge,{size:20}),path:"/:lang/admin/monitoring"},{text:"All Customers",icon:e.jsx(C,{size:20}),path:"/:lang/admin/users"},{text:"Cupons",icon:e.jsx(me,{size:20}),path:"/:lang/admin/cupons"},{text:"Media",icon:e.jsx(je,{size:20}),path:"/:lang/admin/media"},{text:"Vans",icon:e.jsx($,{size:20}),path:"/:lang/admin/vans",submenu:[{text:"Add Van",icon:e.jsx(C,{size:20}),path:"/:lang/admin/vans/add"}]},{text:"All Products",icon:e.jsx(ke,{size:20}),path:"/:lang/admin/all-product",submenu:[{text:"Add Product",icon:e.jsx(be,{size:20}),path:"/:lang/admin/add-product"}]},{text:"Packages",icon:e.jsx(Ce,{size:20}),path:"/:lang/admin/packages"},{text:"Reviews",icon:e.jsx(ye,{size:20}),path:"/:lang/admin/reviews"},{text:"Booking Settings",icon:e.jsx(U,{size:20}),path:"/:lang/admin/booking/settings"},{text:"Earning Settings",icon:e.jsx(W,{size:20}),path:"/:lang/admin/earning-settings"},{text:"Withdrawals",icon:e.jsx(we,{size:20}),path:"/:lang/admin/withdrawals"},{text:"Our Partners",icon:e.jsx(C,{size:20}),path:"/:lang/admin/our-partners"},{text:"FAQ Management",icon:e.jsx(ve,{size:20}),path:"/:lang/admin/faqs"},{text:"Rules Settings",icon:e.jsx(ze,{size:20}),path:"/:lang/admin/contract"}],partner:[{text:"Overview",icon:e.jsx(R,{size:20}),path:"/:lang/partner/dashboard"},{text:"My Vans",icon:e.jsx($,{size:20}),path:"/:lang/partner/vans",submenu:[{text:"Add Van",icon:e.jsx(C,{size:20}),path:"/:lang/partner/vans/add-van"}]},{text:"All Bookings",icon:e.jsx(U,{size:20}),path:"/:lang/partner/bookings"},{text:" Withdrawals",icon:e.jsx(W,{size:20}),path:"/:lang/partner/withdrawals",submenu:[{text:"Bank Details",icon:e.jsx(fe,{size:20}),path:"/:lang/partner/bank-details"}]}]},_=G(J)(({active:s})=>({backgroundColor:s?"#021e49":"transparent",color:s?"#ffffff":"#fff",borderLeft:s?"4px solid #ffffff":"4px solid transparent","&:hover":{backgroundColor:"#021e49",color:"#ffffff"}})),H=G(J)(({active:s})=>({backgroundColor:s?"#123564":"transparent",color:s?"#ffffff":"#bbb",paddingLeft:"32px",borderLeft:s?"4px solid #ffffff":"4px solid transparent","&:hover":{backgroundColor:"#123564",color:"#ffffff"}})),Be=({open:s,onClose:l})=>{const o=ue(),[i,d]=x.useState(null),{userRole:u}=Q(),p=Pe[u]||[],f=n=>{d(a=>a===n?null:n)},r=n=>{const a=o.pathname.split("/")[1],h=n.replace(":lang",a);return o.pathname.startsWith(h)};return x.useEffect(()=>{const n=p.find(a=>a.submenu?.some(h=>r(h.path)));n&&d(n.text)},[o.pathname,p]),e.jsxs("div",{children:[e.jsx(N,{variant:"permanent",sx:{width:250,flexShrink:0,display:{xs:"none",sm:"block"},"& .MuiDrawer-paper":{width:250,boxSizing:"border-box",backgroundColor:"#ff0707"}},children:e.jsx(j,{sx:{pt:10},children:p.map(n=>e.jsxs(O.Fragment,{children:[e.jsxs(_,{component:b,to:n.path.replace(":lang",o.pathname.split("/")[1]),active:r(n.path)?1:0,onClick:()=>n.submenu&&f(n.text),button:!0,children:[e.jsx(k,{sx:{color:(r(n.path),"#fff")},children:n.icon}),e.jsx(g,{primary:n.text}),n.submenu&&(i===n.text?e.jsx(E,{}):e.jsx(I,{}))]}),n.submenu&&e.jsx(D,{in:i===n.text,timeout:"auto",unmountOnExit:!0,children:e.jsx(j,{component:"div",disablePadding:!0,children:n.submenu.map(a=>e.jsxs(H,{component:b,to:a.path.replace(":lang",o.pathname.split("/")[1]),active:r(a.path)?1:0,children:[e.jsx(k,{sx:{color:r(a.path)?"#fff":"#bbb"},children:a.icon}),e.jsx(g,{primary:a.text})]},a.text))})})]},n.text))})}),e.jsx(N,{variant:"temporary",open:s,onClose:l,sx:{"& .MuiDrawer-paper":{width:250,boxSizing:"border-box",backgroundColor:"#021e49"},display:{xs:"block",sm:"none"}},ModalProps:{keepMounted:!0},children:e.jsx(j,{sx:{pt:8},children:p.map(n=>e.jsxs(O.Fragment,{children:[e.jsxs(_,{component:b,to:n.path.replace(":lang",o.pathname.split("/")[1]),active:r(n.path)?1:0,onClick:()=>n.submenu&&f(n.text),button:!0,children:[e.jsx(k,{sx:{color:r(n.path)?"#fff":"#ccc"},children:n.icon}),e.jsx(g,{primary:n.text}),n.submenu&&(i===n.text?e.jsx(E,{}):e.jsx(I,{}))]}),n.submenu&&e.jsx(D,{in:i===n.text,timeout:"auto",unmountOnExit:!0,children:e.jsx(j,{component:"div",disablePadding:!0,children:n.submenu.map(a=>e.jsxs(H,{component:b,to:a.path.replace(":lang",o.pathname.split("/")[1]),active:r(a.path)?1:0,children:[e.jsx(k,{sx:{color:r(a.path)?"#fff":"#bbb"},children:a.icon}),e.jsx(g,{primary:a.text})]},a.text))})})]},n.text))})})]})};function Ne({children:s}){const[l,o]=x.useState(!1),i=()=>{o(!l)},d=()=>{o(!1)};return e.jsxs("div",{style:{display:"flex",minHeight:"100vh",overflowX:"hidden"},children:[e.jsx(Me,{onMenuClick:i}),e.jsx(Be,{open:l,onClose:d}),e.jsx("main",{style:{flexGrow:1,padding:"0px",marginTop:64},children:s})]})}export{Ne as default};
