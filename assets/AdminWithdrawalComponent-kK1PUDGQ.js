import{r as a,d as K,j as e,F as l}from"./index-D-tacDo0.js";import{u as Y}from"./index-CXZNmiFt.js";import{u as Z}from"./index-BGGJ7DGS.js";import{T as r}from"./Typography-DA9Er3Yb.js";import{C as h}from"./CircularProgress-C_nPCmSr.js";import{C as ee}from"./Card-kxTfTiZe.js";import{C as te}from"./CardContent-DdFcfx19.js";import{D as u,a as x}from"./DialogContent-Cs5cBEzY.js";import{D as j}from"./DialogTitle-BVmQUzg8.js";import{D as f}from"./DialogActions-CC4pfo8d.js";import{B as i}from"./Button-DcaeVkm4.js";import{T as re}from"./TextField-Ben9hf97.js";import{D as ae}from"./DataGrid-Dh8Q6Dnq.js";import"./index-CRkjSq8j.js";import"./createSimplePaletteValueFilter-BA-5fWDN.js";import"./useTheme-BPaKzVUX.js";import"./Chip-D4n6IchS.js";import"./createSvgIcon-DSUh4BZ1.js";import"./index-DqaVpj0-.js";import"./Paper-D8__vy1H.js";import"./useTheme-DTUOtr2d.js";import"./useSlot-C4Jq41_r.js";import"./Modal-DeRbA6Cj.js";import"./Portal-BmHO-mBc.js";import"./Select-CdTeA48B.js";import"./Menu-D8FtULnJ.js";import"./Grow-BlXXg7GE.js";import"./List-lkVPBD74.js";import"./useControlled-B5g-9vmA.js";import"./isMuiElement-7oANgUe6.js";import"./Close-8o8Uc7-g.js";import"./Badge-CkqnVvtt.js";import"./Tooltip-C4edUKB3.js";import"./IconButton-CfFcDGl4.js";import"./ClickAwayListener-BlbJm6_R.js";import"./MenuItem-U1gzko4K.js";import"./listItemTextClasses-BBLLOjiz.js";import"./dividerClasses-CdWFDhxV.js";import"./Toolbar-C-N-dtXX.js";import"./ListItemText-D6_Kdstx.js";import"./InputAdornment-CGw_sbT-.js";import"./Divider-trYpSRXj.js";import"./FormControlLabel-KCTcs0Do.js";import"./TableCell-FOiKC1_H.js";import"./Skeleton-BSPYxJHX.js";const se="https://rubertogo.com",Je=()=>{const[N,O]=a.useState([]),[c,n]=a.useState(!1),[w,g]=a.useState(null),[d,P]=a.useState(null),[I,D]=a.useState(!1),[B,C]=a.useState(!1),[F,R]=a.useState(!1),[b,k]=a.useState(""),[p,S]=a.useState(null),[A,q]=a.useState(null),[M,W]=a.useState(!1),T=Z("(max-width: 1024px)"),U=localStorage.getItem("accessToken"),m=K.create({baseURL:se,headers:{Authorization:`Bearer ${U}`}}),y=async()=>{var t;n(!0);try{const o=await m.get("/api/withdrawals");O(o.data.withdrawals||[])}catch(o){console.error("Fetch Withdrawals Error:",((t=o.response)==null?void 0:t.data)||o.message),l.error("Failed to fetch withdrawals.")}finally{n(!1)}},$=async()=>{var o;if(!p){l.error("Please upload a payment receipt before approving.");return}const t=new FormData;t.append("file",p),n(!0);try{const J=(await m.post("/api/upload",t,{headers:{"Content-Type":"multipart/form-data"}})).data.imageURL;await m.put(`/api/withdrawals/${w}`,{status:"approved",paymentReceipt:J}),l.success("Withdrawal approved successfully."),y(),s()}catch(v){console.error("Approval Error:",((o=v.response)==null?void 0:o.data)||v.message),l.error("Failed to approve withdrawal.")}finally{n(!1)}},E=async()=>{var t;if(!b.trim()){l.info("Please provide a reason for rejection.");return}n(!0);try{await m.put(`/api/withdrawals/${w}`,{status:"rejected",rejectionReason:b}),l.success("Withdrawal rejected successfully."),y(),s()}catch(o){console.error("Rejection Error:",((t=o.response)==null?void 0:t.data)||o.message),l.error("Failed to reject withdrawal.")}finally{n(!1)}},L=t=>{q(t),W(!0)},z=t=>{g(t),C(!0)},V=t=>{g(t),R(!0)},G=t=>{P(t),D(!0)},s=()=>{g(null),k(""),S(null),C(!1),R(!1),D(!1),W(!1)};a.useEffect(()=>{y()},[]);const{getRootProps:H,getInputProps:_,isDragActive:Q}=Y({accept:"image/*",multiple:!1,onDrop:t=>S(t[0])}),X=[{field:"partnerName",headerName:"Partner Name",width:200},{field:"amount",headerName:"Amount (USD)",width:150},{field:"requestDate",headerName:"Requested On",width:200,renderCell:t=>new Date(t.value).toLocaleDateString()},{field:"status",headerName:"Status",width:150,renderCell:t=>e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${t.value==="approved"?"bg-green-100 text-green-600":t.value==="rejected"?"bg-red-100 text-red-600":"bg-yellow-100 text-yellow-600"}`,children:t.value.charAt(0).toUpperCase()+t.value.slice(1)})},{field:"actions",headerName:"Actions",width:400,renderCell:t=>e.jsx("div",{className:"flex gap-4",children:t.row.status==="pending"?e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"contained",color:"primary",onClick:()=>G(t.row.bankDetails),children:"View Bank Details"}),e.jsx(i,{variant:"contained",color:"success",onClick:()=>z(t.row.id),children:"Approve"}),e.jsx(i,{variant:"contained",color:"error",onClick:()=>V(t.row.id),children:"Reject"})]}):t.row.status==="approved"?e.jsx(i,{variant:"contained",color:"secondary",onClick:()=>L(t.row.paymentReceipt),children:"View Receipt"}):null})}];return e.jsxs("div",{className:"p-6 container mx-auto",children:[e.jsx(r,{variant:"h4",className:"font-bold text-gray-900 mb-8",children:"Manage Withdrawal Requests"}),e.jsx("div",{style:{height:500,width:"100%"},children:c?e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(h,{})}):T?e.jsx("div",{className:"space-y-4",children:N.map(t=>e.jsx(ee,{className:"shadow-lg",children:e.jsxs(te,{children:[e.jsxs(r,{variant:"h6",children:[e.jsx("strong",{children:"Partner Name:"})," ",t.partnerId.firstName," ",t.partnerId.lastName]}),e.jsxs(r,{children:[e.jsx("strong",{children:"Amount:"})," $",t.amount.toFixed(2)]}),e.jsxs(r,{children:[e.jsx("strong",{children:"Requested On:"})," ",new Date(t.requestDate).toLocaleDateString()]}),e.jsxs(r,{children:[e.jsx("strong",{children:"Status:"})," ",e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${t.status==="approved"?"bg-green-100 text-green-600":t.status==="rejected"?"bg-red-100 text-red-600":"bg-yellow-100 text-yellow-600"}`,children:t.status.charAt(0).toUpperCase()+t.status.slice(1)})]})]})},t._id))}):e.jsx("div",{style:{height:500,width:"100%"},children:e.jsx(ae,{rows:N.map(t=>({id:t._id,partnerName:`${t.partnerId.firstName} ${t.partnerId.lastName}`,...t})),columns:X,pageSize:5,rowsPerPageOptions:[5,10],disableSelectionOnClick:!0,sx:{"& .MuiDataGrid-root":{overflowX:"auto"},"& .MuiDataGrid-cell":{whiteSpace:"nowrap"}}})})}),e.jsxs(u,{open:I,onClose:s,maxWidth:"sm",fullWidth:!0,className:"max-w-full",children:[e.jsx(j,{children:e.jsx(r,{variant:"h5",className:"font-bold text-center",children:"Bank Details of Partner"})}),e.jsx(x,{children:d?e.jsxs("div",{className:"p-4",children:[e.jsxs(r,{variant:"body1",className:"mb-4 text-gray-700 border-b pb-2",children:[e.jsx("strong",{children:"Bank Name:"})," ",d.bankName]}),e.jsxs(r,{variant:"body1",className:"mb-4 text-gray-700 border-b pb-2",children:[e.jsx("strong",{children:"Account Holder Name:"})," ",d.accountHolderName]}),e.jsxs(r,{variant:"body1",className:"mb-4 text-gray-700 border-b pb-2",children:[e.jsx("strong",{children:"Account Number:"})," ",d.accountNumber]}),e.jsxs(r,{variant:"body1",className:"mb-4 text-gray-700 border-b pb-2",children:[e.jsx("strong",{children:"Branch Name:"})," ",d.branchName]}),e.jsxs(r,{variant:"body1",className:"mb-4 text-gray-700 border-b pb-2",children:[e.jsx("strong",{children:"SWIFT Code:"})," ",d.swiftCode]})]}):e.jsx(r,{variant:"body1",className:"text-gray-600",children:"No bank details available."})}),e.jsx(f,{children:e.jsx(i,{onClick:s,variant:"contained",color:"primary",className:"mx-auto",style:{minWidth:"150px"},children:"Close"})})]}),e.jsxs(u,{open:B,onClose:s,maxWidth:"sm",fullWidth:!0,className:"max-w-full",children:[e.jsx(j,{children:"Approve Withdrawal Request"}),e.jsxs(x,{children:[e.jsx(r,{variant:"body2",className:"mb-4",children:"Upload the payment receipt for approval."}),e.jsxs("div",{...H(),className:`border-2 border-dashed p-4 text-center ${Q?"border-green-500":"border-gray-400"}`,children:[e.jsx("input",{..._()}),p?e.jsx(r,{variant:"body1",children:p.name}):e.jsx(r,{variant:"body2",children:"Drag & drop or click to upload receipt"})]})]}),e.jsxs(f,{children:[e.jsx(i,{onClick:s,color:"primary",children:"Cancel"}),e.jsx(i,{onClick:$,color:"success",disabled:c,children:c?e.jsx(h,{size:20,color:"inherit"}):"Approve"})]})]}),e.jsxs(u,{open:F,onClose:s,maxWidth:"sm",fullWidth:!0,className:"max-w-full",children:[e.jsx(j,{children:"Reject Withdrawal Request"}),e.jsx(x,{children:e.jsx(re,{label:"Rejection Reason",variant:"outlined",fullWidth:!0,multiline:!0,rows:4,value:b,onChange:t=>k(t.target.value)})}),e.jsxs(f,{children:[e.jsx(i,{onClick:s,color:"primary",children:"Cancel"}),e.jsx(i,{onClick:E,color:"error",disabled:c,children:c?e.jsx(h,{size:20,color:"inherit"}):"Reject"})]})]}),e.jsxs(u,{open:M,onClose:s,fullWidth:!0,children:[e.jsx(j,{children:e.jsx(r,{variant:"h5",className:"font-bold text-center",children:"Payment Receipt"})}),e.jsx(x,{children:c?e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(h,{})}):A?e.jsx("img",{src:A,alt:"Payment Receipt",style:{width:"100%",height:"auto"},onLoad:()=>n(!1)}):e.jsx(r,{className:"text-center text-gray-600",children:"No receipt available."})}),e.jsx(f,{children:e.jsx(i,{onClick:s,variant:"contained",color:"primary",style:{minWidth:"100px"},children:"Close"})})]})]})};export{Je as default};
