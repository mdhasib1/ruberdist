import{r as s,b as E,j as a,cr as L,m as r,V as R,k as B,a9 as W,B as p,C as f,D as z,aR as H,bE as J,bF as M,bG as V,bH as G,f as l}from"./vendor-Bsame8Xi.js";const Y="https://www.rubertogo.com",Z=o=>{if(!o)return null;try{const i=o.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),t=decodeURIComponent(atob(i).split("").map(h=>"%"+("00"+h.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(t)}catch(d){return console.error("Failed to parse JWT:",d.message),null}},Q=()=>{const[o,d]=s.useState(""),[i,t]=s.useState(!1),[h,w]=s.useState([]),[A,j]=s.useState(0),[x,m]=s.useState(null),[q,g]=s.useState(!1),[F,y]=s.useState(!1),[v,N]=s.useState(""),C=localStorage.getItem("accessToken"),c=Z(C)?.id,u=E.create({baseURL:Y,headers:{Authorization:`Bearer ${C}`}}),P=async()=>{try{const e=await u.get(`/api/bank-details/${c}`);m(e.data.bankDetails)}catch(e){e.response?.status===404?m(null):l.error("Failed to fetch bank details.")}},U=async e=>{try{const n=await u.post("/api/bank-details",e);m(n.data.bankDetails),l.success("Bank details saved successfully."),g(!1)}catch{l.error("Failed to save bank details.")}},k=async()=>{t(!0);try{const e=await u.get(`/api/partner/balance/${c}`);j(e.data.balance)}catch(e){e.response?.status===404?j(0):l.error("Failed to fetch balance")}finally{t(!1)}},S=async()=>{t(!0);try{const e=await u.get(`/api/withdrawals/partner/${c}`);w(e.data.withdrawals||[])}catch(e){e.response?.status===404&&w([])}finally{t(!1)}},I=async({partnerId:e,amount:n})=>{if(!x){l.error("You must set up your bank details before requesting a withdrawal."),g(!0);return}try{return(await u.post("/api/withdrawals",{partnerId:e,amount:n})).data}catch(b){b.response?.status===400&&l.error(b.response?.data?.message||"Invalid request data.")}},O=async()=>{if(!o){l.error("Please enter an amount.");return}t(!0);try{await I({partnerId:c,amount:o}),d(""),S(),k()}catch(e){l.error(e.message)}finally{t(!1)}};s.useEffect(()=>{c&&(S(),k(),P())},[c]);const $=e=>{N(e),y(!0)},D=()=>{y(!1),N("")},T=[{field:"amount",headerName:"Amount (USD)",width:250,renderCell:e=>`${e.value.toFixed(2)}`},{field:"requestDate",headerName:"Requested On",width:250,renderCell:e=>new Date(e.value).toLocaleDateString()},{field:"status",headerName:"Status",width:200,renderCell:e=>a.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${e.value==="approved"?"bg-green-100 text-green-600":e.value==="rejected"?"bg-red-100 text-red-600":"bg-yellow-100 text-yellow-600"}`,children:e.value.charAt(0).toUpperCase()+e.value.slice(1)})},{field:"actions",headerName:"Actions",width:500,renderCell:e=>a.jsx("div",{className:"flex gap-4",children:e.row.status==="approved"&&a.jsx(p,{variant:"contained",color:"secondary",onClick:()=>$(e.row.paymentReceipt),children:"View Receipt"})})}];return a.jsxs(L,{maxWidth:"lg",sx:{paddingTop:4,paddingBottom:4},children:[a.jsxs(r,{variant:"h4",className:"font-bold text-center bg-green-900 p-5 text-white mb-8",children:[a.jsx(R,{className:"inline"})," Withdrawal Requests"]}),a.jsxs(B,{sx:{backgroundColor:"green",color:"white",borderRadius:2,textAlign:"center",padding:3,marginBottom:4},children:[a.jsx(r,{variant:"h4",className:"font-semibold text-white text-center mb-4",children:"Current Balance"}),a.jsxs(r,{variant:"h3",className:"text-white font-extrabold flex items-center justify-center",children:[a.jsx(R,{className:"inline"})," ",A.toFixed(2)]})]}),a.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6 mb-8 max-w-4xl mx-auto",children:[a.jsx(r,{variant:"h6",className:"font-semibold text-gray-800 mb-4",children:"Request a Withdrawal"}),a.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center",children:[a.jsx(W,{label:"Enter Amount",variant:"outlined",value:o,onChange:e=>d(e.target.value),fullWidth:!0,className:"flex-1"}),a.jsx(p,{variant:"contained",onClick:O,disabled:i,className:"bg-gradient-to-r from-blue-500 to-blue-700 text-white px-8 py-2",children:i?a.jsx(f,{size:20,color:"inherit"}):"Submit"})]})]}),a.jsxs("div",{className:"bg-gray-50 shadow-md rounded-lg p-6 max-w-4xl mx-auto",children:[a.jsx(r,{variant:"h6",className:"font-semibold text-gray-800 mb-4",children:"Withdrawal History"}),i?a.jsx("div",{className:"flex justify-center py-4",children:a.jsx(f,{})}):h.length>0?a.jsx("div",{className:"overflow-x-auto",children:a.jsx("div",{style:{minWidth:"600px"},children:a.jsx(z,{rows:h.map((e,n)=>({id:n,...e})),columns:T,pageSize:5,rowsPerPageOptions:[5],disableSelectionOnClick:!0,className:"w-full"})})}):a.jsx(r,{variant:"body1",className:"text-gray-600",children:"No withdrawal requests found."})]}),a.jsx(H,{open:q,onClose:()=>g(!1),className:"container",children:a.jsxs(B,{sx:{maxWidth:"500px",width:"100%",bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4,mx:"auto",mt:8},children:[a.jsx(r,{variant:"h6",className:"mb-4",children:"Add/Update Bank Details"}),["bankName","accountNumber","accountHolderName","branchName","swiftCode"].map(e=>a.jsx(W,{label:e.replace(/([A-Z])/g," $1"),variant:"outlined",fullWidth:!0,margin:"normal",value:x?.[e]||"",onChange:n=>m({...x,[e]:n.target.value})},e)),a.jsx(p,{variant:"contained",color:"primary",onClick:()=>U(x),fullWidth:!0,className:"mt-4",children:"Save Details"})]})}),a.jsxs(J,{open:F,onClose:D,fullWidth:!0,children:[a.jsx(M,{children:a.jsx(r,{variant:"h5",className:"font-bold text-center",children:"Payment Receipt"})}),a.jsx(V,{children:i?a.jsx("div",{className:"flex justify-center items-center",children:a.jsx(f,{})}):v?a.jsx("img",{src:v,alt:"Payment Receipt",style:{width:"100%",height:"auto",borderRadius:"8px"},onLoad:()=>t(!1)}):a.jsx(r,{className:"text-center text-gray-600",children:"No receipt available."})}),a.jsx(G,{children:a.jsx(p,{onClick:D,variant:"contained",color:"primary",style:{minWidth:"100px"},children:"Close"})})]})]})};export{Q as default};
