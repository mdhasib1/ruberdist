import{r as e,a,u as s,j as r,t,bY as l,bZ as i,I as n,b_ as o,M as d,k as c,bf as m,g as x,a2 as h,a4 as p,b$ as u,c0 as g,c1 as j,c2 as y,bv as f,c3 as v,a$ as b,b as w,aV as N}from"./vendor-Zgq9WbFI.js";import{V as C}from"./VanLoading-6Y8Rjrgj.js";const k="https://rubertogo.com",$=()=>{const[$,A]=e.useState([]),[P,S]=e.useState(!0),[T,V]=e.useState(null),[E,I]=e.useState(null),[z,F]=e.useState(!1),[B,D]=e.useState([]),[U,K]=e.useState(!1),{lang:H}=a(),[L,R]=e.useState(!1),[M,_]=e.useState(null),[O,Z]=e.useState(!1),[W,Y]=e.useState([]),[q,G]=e.useState([]),[J,Q]=e.useState(""),X=s(),ee=localStorage.getItem("accessToken");e.useEffect((()=>{S(!0);(async()=>{try{const e=(await w.get(`${k}/api/vans/admin/all`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}})).data.map((e=>{var a,s;return{id:e._id,vanName:(null==(a=e.name)?void 0:a.en)||"N/A",model:e.transmissionType||"N/A",regNumber:e.plateNumber||"N/A",capacity:(null==(s=e.weight)?void 0:s.maxLoad)||"N/A",status:e.status||"pending"}}));A(e)}catch(e){console.error("Error fetching van data:",e)}finally{S(!1)}})()}),[]);const ae=(e,a)=>{V({element:e.currentTarget,id:a.id}),I(a)},se=()=>{V(null)},re=async()=>{try{await w.put(`${k}/api/vans/${E.id}/reject`),N.success("Van rejected successfully."),A((e=>e.map((e=>e.id===E.id?{...e,status:"rejected"}:e)))),V(null)}catch(e){console.error("Error rejecting van:",e),N.error("Failed to reject van. Please try again.")}},te=(e,a,s)=>{const r=[...B];r[e]={...r[e],[a]:s},D(r)},le=e=>{_(e),R(!0)},ie=()=>{_(null),R(!1)},ne=async e=>{_(e);try{const a=await w.get(`${k}/api/vans/${e}/pricing`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});a.data?D(a.data):D(new Array(7).fill({pricePerHour:"",kilometers:"",extraPerKm:""}))}catch(a){console.error("Error fetching daily pricing:",a),D(new Array(7).fill({pricePerHour:"",kilometers:"",extraPerKm:""}))}F(!0)},oe=(e,a,s)=>{const r=[...W];r[e][a]=s,Y(r)},de=()=>{Z(!1)},ce=async()=>{if(E)try{const e=await w.get(`${k}/api/vans/contracts/${E.id}`,{headers:{Authorization:`Bearer ${ee}`}});G(e.data||[])}catch(e){N.error("Failed to load contract images. Please try again.")}finally{Z(!0)}},me=[{field:"vanName",headerName:"Van Name",width:200},{field:"model",headerName:"Transmission Type",width:150},{field:"regNumber",headerName:"Registration Number",width:200},{field:"capacity",headerName:"Max Load Capacity",width:150},{field:"status",headerName:"Status",width:150,renderCell:e=>r.jsx("span",{className:"px-2 py-1 rounded-full text-white "+("approved"===e.value?"bg-green-500":"rejected"===e.value?"bg-red-500":"bg-yellow-500"),children:e.value})},{field:"actions",headerName:"Actions",width:150,renderCell:e=>r.jsxs(r.Fragment,{children:[r.jsx(n,{onClick:a=>ae(a,e.row),children:r.jsx(o,{})}),r.jsxs(d,{anchorEl:null==T?void 0:T.element,open:Boolean(T)&&(null==T?void 0:T.id)===e.row.id,onClose:se,children:["approved"!==e.row.status&&"rejected"!==e.row.status&&r.jsxs(r.Fragment,{children:[r.jsx(c,{onClick:()=>ne(e.row.id),children:"Approve"}),r.jsx(c,{onClick:re,children:"Reject"})]}),r.jsx(c,{onClick:()=>X(`/${H}/admin/vans/edit-van/${e.row.id}`),children:"Edit Van"}),r.jsx(c,{onClick:()=>ce(),children:"Add/Edit Contracts"}),r.jsx(c,{onClick:()=>le(e.row.id),children:"Delete Van"})]})]})}];return P?r.jsx(C,{vanImageUrl:"/runvan.png"}):r.jsxs("div",{className:"container mx-auto p-4",children:[r.jsxs("div",{className:"flex justify-between items-center mb-4",children:[r.jsx("h2",{className:"text-2xl font-semibold text-gray-800",children:"All Vans"}),r.jsx(t,{to:`/${H}/admin/vans/add`,className:"text-blue-500 hover:underline",children:r.jsxs("button",{className:"bg-green-500 text-white px-4 py-2 rounded-lg shadow hover:bg-green-600 transition duration-200 flex items-center space-x-2",children:[r.jsx(l,{}),r.jsx("span",{children:"Add New Van"})]})})]}),r.jsxs("div",{className:"w-full overflow-auto",style:{height:400},children:[r.jsx("div",{className:"hidden sm:block",children:r.jsx(i,{rows:$,columns:me,pageSize:5,rowsPerPageOptions:[5],disableSelectionOnClick:!0})}),r.jsx("div",{className:"block sm:hidden",children:$.map((e=>r.jsxs("div",{className:"bg-white shadow-md rounded-lg mb-4 p-4",children:[r.jsxs("p",{children:[r.jsx("strong",{children:"Van Name:"})," ",e.vanName]}),r.jsxs("p",{children:[r.jsx("strong",{children:"Transmission:"})," ",e.model]}),r.jsxs("p",{children:[r.jsx("strong",{children:"Registration Number:"})," ",e.regNumber]}),r.jsxs("p",{children:[r.jsx("strong",{children:"Max Load Capacity:"})," ",e.capacity]}),r.jsxs("p",{children:[r.jsx("strong",{children:"Status:"})," ",r.jsx("span",{className:"px-2 py-1 rounded-full text-white "+("approved"===e.status?"bg-green-500":"rejected"===e.status?"bg-red-500":"bg-yellow-500"),children:e.status}),r.jsx(n,{onClick:a=>ae(a,e),className:"text-gray-600 hover:text-black",children:r.jsx(o,{})}),r.jsxs(d,{anchorEl:T,open:Boolean(T&&(null==E?void 0:E.id)===e.id),onClose:se,className:"sm:hidden",children:["approved"!==e.status&&"rejected"!==e.status&&r.jsxs(r.Fragment,{children:[r.jsx(c,{onClick:()=>ne(e.id),children:"Approve"}),r.jsx(c,{onClick:()=>re(e.id),children:"Reject"})]}),r.jsx(c,{onClick:()=>X(`/${H}/admin/vans/edit-van/${e.id}`),children:"Edit Van"}),r.jsx(c,{onClick:()=>ce(e.id),children:"Add/Edit Contracts"}),r.jsx(c,{onClick:()=>le(e.id),children:"Delete Van"})]})]})]},e.id)))})]}),r.jsx(m,{open:z,onClose:()=>F(!1),children:r.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-60 z-50 px-4 sm:px-0",children:r.jsxs("div",{className:"w-full container sm:max-w-4xl bg-white rounded-lg shadow-lg p-6",children:[r.jsx(x,{variant:"h5",className:"text-2xl font-bold text-gray-800 mb-6 text-center border-b border-gray-200 pb-4",children:"Approve Van"}),r.jsx("div",{className:"space-y-4",children:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(((e,a)=>{var s,t,l;return r.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4",children:[r.jsx(x,{className:"flex-1 text-gray-600",children:e}),r.jsx(h,{label:"Price Per Hour",type:"number",value:(null==(s=B[a])?void 0:s.pricePerHour)||"",onChange:e=>te(a,"pricePerHour",e.target.value),className:"flex-1 w-full"}),r.jsx(h,{label:"Kilometers",type:"number",value:(null==(t=B[a])?void 0:t.kilometers)||"",onChange:e=>te(a,"kilometers",e.target.value),className:"flex-1 w-full"}),r.jsx(h,{label:"Extra Per Km",type:"number",value:(null==(l=B[a])?void 0:l.extraPerKm)||"",onChange:e=>te(a,"extraPerKm",e.target.value),className:"flex-1 w-full"})]},e)}))}),r.jsxs("div",{className:"mt-6 flex justify-end space-x-4",children:[r.jsx(p,{variant:"outlined",onClick:()=>F(!1),className:"rounded-md",children:"Cancel"}),r.jsx(p,{variant:"contained",onClick:async()=>{if(M&&7===B.length&&!B.some((e=>!e.pricePerHour||!e.kilometers||!e.extraPerKm)))try{K(!0),await w.put(`${k}/api/vans/${M}/approve`,{dailyPricing:B},{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}}),N.success("Van approved successfully."),A((e=>e.map((e=>e.id===M?{...e,status:"approved"}:e)))),F(!1),D([])}catch(e){N.error("Failed to approve van. Please try again.")}finally{K(!1)}else N.error("Please provide valid pricing for all 7 days.")},className:"bg-green-500 text-white rounded-md",children:"Approve Van"})]})]})})}),r.jsxs(u,{open:L,onClose:ie,"aria-labelledby":"confirm-dialog-title","aria-describedby":"confirm-dialog-description",children:[r.jsx(g,{id:"confirm-dialog-title",children:"Confirm Deletion"}),r.jsx(j,{children:r.jsx(x,{id:"confirm-dialog-description",children:"Are you sure you want to delete this van? This action cannot be undone."})}),r.jsxs(y,{children:[r.jsx(p,{onClick:ie,color:"primary",children:"Cancel"}),r.jsx(p,{onClick:async()=>{try{await w.delete(`${k}/api/vans/${M}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}}),A((e=>e.filter((e=>e.id!==M)))),N.success("Van deleted successfully.")}catch(e){N.error("Failed to delete van.")}finally{ie()}},color:"error",variant:"contained",children:"Confirm"})]})]}),r.jsx(m,{open:O,onClose:de,children:r.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-60 z-50 px-4 sm:px-0",children:r.jsxs("div",{className:"w-full container sm:max-w-4xl bg-white rounded-lg shadow-lg p-6 relative transform transition-all scale-100 sm:scale-105",children:[r.jsx("button",{className:"absolute top-2 left-2",children:r.jsx(n,{onClick:de,children:r.jsx(f,{})})}),r.jsx(x,{variant:"h5",className:"text-2xl font-bold text-gray-800 mb-6 text-center border-b border-gray-200 pb-4",children:"Add/Edit Contracts"}),r.jsx("div",{className:"overflow-x-auto mb-6",children:r.jsxs("table",{className:"min-w-full bg-white shadow rounded-lg",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"bg-gray-100 border-b",children:[r.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-600 whitespace-nowrap",children:"Damage Type"}),r.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-600 whitespace-nowrap",children:"Description"}),r.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-600 whitespace-nowrap",children:"Image"}),r.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-600 whitespace-nowrap",children:"Action"})]})}),r.jsx("tbody",{children:q.map(((e,a)=>r.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[r.jsx("td",{className:"py-3 px-4 text-gray-700",children:null==e?void 0:e.damageType}),r.jsx("td",{className:"py-3 px-4  text-gray-700",children:e.description}),r.jsx("td",{className:"py-3 px-4 ",children:r.jsx("img",{src:e.image,alt:"Contract",className:"w-64 h-32 objec rounded-md shadow-sm"})}),r.jsx("td",{className:"py-3 px-4",children:r.jsx(n,{onClick:()=>(async e=>{try{const a=await w.delete(`${k}/api/vans/${E.id}/contracts`,{headers:{Authorization:`Bearer ${ee}`},params:{imageId:e}});201===a.status&&(Z(!1),N.success(a.data.message)),G((a=>a.filter((a=>a.image!==e))))}catch(a){console.error("Error removing contract image:",a),Q("Failed to remove contract image. Please try again.")}})(e._id),className:"text-red-500 hover:text-red-700",children:r.jsx(v,{})})})]},a)))})]})}),W.map(((e,a)=>r.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-4 mt-4",children:[r.jsx(h,{label:"Damage Type",variant:"outlined",value:e.damageType,onChange:e=>oe(a,"damageType",e.target.value),className:"flex-1 w-full",InputProps:{className:"rounded-md shadow-sm border-gray-300 focus:ring-2 focus:ring-blue-500"}}),r.jsx(h,{label:"Description",variant:"outlined",value:e.description,onChange:e=>oe(a,"description",e.target.value),className:"flex-1 w-full",InputProps:{className:"rounded-md shadow-sm border-gray-300 focus:ring-2 focus:ring-blue-500"}}),r.jsxs("div",{className:"flex-1 w-full p-2 border border-dashed rounded-md border-gray-300 cursor-pointer hover:bg-gray-50",children:[r.jsx("input",{type:"file",onChange:e=>{e.target.files[0]&&((async(e,a)=>{try{const s=new FormData;s.append("file",e),K(!0);const r=(await w.post(`${k}/api/upload`,s,{headers:{"Content-Type":"multipart/form-data"}})).data.imageURL;oe(a,"imageUrl",r)}catch(s){console.error("Error uploading image:",s),Q("Image upload failed. Please try again.")}finally{K(!1)}})(e.target.files[0],a),oe(a,"image",e.target.files[0]))}}),e.imageUrl?r.jsx("img",{src:e.imageUrl,alt:"Contract",className:"w-12 h-12 object-cover rounded-md shadow-sm"}):r.jsx("p",{className:"text-sm text-gray-400",children:"Click to upload an image"})]}),r.jsx(n,{onClick:()=>(e=>{const a=W.filter(((a,s)=>s!==e));Y(a)})(a),className:"text-red-500 hover:text-red-700",children:r.jsx(v,{})})]},a))),r.jsxs("div",{className:"mt-8 space-y-4 sm:space-y-0 sm:space-x-4 flex flex-col sm:flex-row justify-end",children:[r.jsx(p,{variant:"outlined",color:"primary",onClick:()=>{Y([...W,{damageType:"",description:"",image:null,imageUrl:""}])},className:"rounded-md shadow-sm hover:bg-blue-50",children:"Add New Contract"}),J&&r.jsx(x,{color:"error",className:"text-red-500 text-sm mt-2",children:J}),r.jsx(p,{variant:"contained",onClick:async()=>{if(W.some((e=>!e.damageType||!e.description||!e.imageUrl)))Q("Please complete all fields for each contract.");else{K(!0),Q("");try{const e=W.map((e=>({damageType:e.damageType,description:e.description,image:e.imageUrl})));await w.post(`${k}/api/vans/${E.id}/contracts`,e,{headers:{Authorization:`Bearer ${ee}`}});G((a=>[...a,...e])),Y([]),Z(!1)}catch(e){console.warn("Error saving contracts:",e)}finally{K(!1)}}},disabled:U,className:"bg-blue-600 text-white rounded-md shadow-md hover:bg-blue-700 transition w-full sm:w-auto",children:U?r.jsx(b,{size:24}):"Save Contracts"})]})]})})})]})};export{$ as default};
