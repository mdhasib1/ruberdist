import{r as l,aW as s,b as c,j as t,bZ as v,cc as y,b$ as A,c0 as N,c1 as T,a2 as n,bi as w,I as k,cd as D,k as h,a4 as m}from"./vendor-CRYhOL6r.js";const d="https://www.rubertogo.com",I=()=>`RTG-${Math.random().toString(36).substr(2,6).toUpperCase()}`,R=()=>{const[x,g]=l.useState([]),[f,r]=l.useState(!1),[a,o]=l.useState({code:"",discountType:"fixed",discountValue:"",minPaidHours:"",minAmount:"",maxUses:"",expiresAt:""}),C=localStorage.getItem("accessToken");l.useEffect(()=>{i()},[]);const i=async()=>{try{const e=localStorage.getItem("accessToken");if(!e){console.error("No access token found"),s.error("Authentication error. Please log in again.");return}const u=await c.get(`${d}/api/coupons/all`,{headers:{Authorization:`Bearer ${e}`}});console.log("Coupons received:",u.data),g(u.data.map(p=>({...p,usageCount:p.usageCount||0})))}catch(e){console.error("Error fetching coupons:",e.response?.data||e),s.error("Error fetching coupons")}},j=async e=>{try{await c.delete(`${d}/api/coupons/${e}`),s.success("Coupon deleted successfully"),i()}catch{s.error("Error deleting coupon")}},b=async()=>{if(!a.code.startsWith("RTG-")){s.error("Coupon code must start with RTG-");return}try{await c.post(`${d}/api/coupons/create`,a,{headers:{Authorization:`Bearer ${C}`}}),s.success("Coupon created successfully!"),r(!1),i()}catch(e){s.error(e.response?.data.error)}};return t.jsxs("div",{className:"p-6 bg-white shadow-md rounded-lg",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h2",{className:"text-xl font-semibold",children:"Manage Coupons"}),t.jsx("button",{onClick:()=>{o({...a,code:"RTG-"}),r(!0)},className:"bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-all",children:"+ Add Coupon"})]}),t.jsx("div",{className:"h-80",children:t.jsx(v,{rows:x,columns:[{field:"code",headerName:"Coupon Code",flex:1},{field:"discountType",headerName:"Type",flex:1},{field:"discountValue",headerName:"Discount",flex:1},{field:"minPaidHours",headerName:"Min Hours",flex:1},{field:"minAmount",headerName:"Min Amount",flex:1},{field:"maxUses",headerName:"Max Uses",flex:1},{field:"usageCount",headerName:"Total Used",flex:1},{field:"expiresAt",headerName:"Expires At"},{field:"actions",headerName:"Actions",flex:1,renderCell:e=>t.jsx("button",{className:"text-red-500 hover:text-red-700",onClick:()=>j(e.row._id),children:t.jsx(y,{size:20})})}],pageSize:5,getRowId:e=>e._id})}),t.jsxs(A,{open:f,onClose:()=>r(!1),children:[t.jsx(N,{children:"Add New Coupon"}),t.jsxs(T,{className:"space-y-4 p-6",children:[t.jsx(n,{fullWidth:!0,label:"Coupon Code",value:a.code,onChange:e=>o({...a,code:e.target.value.startsWith("RTG-")?e.target.value:`RTG-${e.target.value}`}),InputProps:{endAdornment:t.jsx(w,{position:"end",children:t.jsx(k,{onClick:()=>o({...a,code:I()}),children:t.jsx(D,{})})})},helperText:"Click the reload icon to generate a random code or enter manually (must start with RTG-)."}),t.jsxs(n,{select:!0,fullWidth:!0,label:"Discount Type",value:a.discountType,onChange:e=>o({...a,discountType:e.target.value}),children:[t.jsx(h,{value:"fixed",children:"Fixed Amount"}),t.jsx(h,{value:"percentage",children:"Percentage"})]}),t.jsx(n,{fullWidth:!0,label:"Discount Value",type:"number",value:a.discountValue,onChange:e=>o({...a,discountValue:e.target.value})}),t.jsx(n,{fullWidth:!0,label:"Min Paid Hours",type:"number",value:a.minPaidHours,onChange:e=>o({...a,minPaidHours:e.target.value})}),t.jsx(n,{fullWidth:!0,label:"Min Amount",type:"number",value:a.minAmount,onChange:e=>o({...a,minAmount:e.target.value})}),t.jsx(n,{fullWidth:!0,label:"Max Uses (0 = unlimited)",type:"number",value:a.maxUses,onChange:e=>o({...a,maxUses:e.target.value})}),t.jsx(n,{fullWidth:!0,label:"Expiration Date",type:"date",InputLabelProps:{shrink:!0},value:a.expiresAt,onChange:e=>o({...a,expiresAt:e.target.value})}),t.jsxs("div",{className:"flex justify-end gap-3",children:[t.jsx(m,{onClick:()=>r(!1),color:"secondary",children:"Cancel"}),t.jsx(m,{onClick:b,color:"primary",variant:"contained",children:"Create"})]})]})]})]})};export{R as default};
