import{r as e,b as t,j as a,bZ as r,bf as o,aV as n}from"./vendor-Zgq9WbFI.js";const i="https://rubertogo.com",s={Pending:"bg-yellow-200 text-yellow-800",Canceled:"bg-red-200 text-red-800",Captured:"bg-green-200 text-green-800"},d=()=>{const[d,l]=e.useState([]),[u,c]=e.useState(null),[h,m]=e.useState(!1),[p,g]=e.useState(!1);e.useEffect((()=>{x()}),[]);const x=async()=>{try{const e=await t.get(`${i}/api/all-pre-authorization`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}});e.data&&l(e.data)}catch(e){console.error("Error fetching pre-authorization data:",e)}},y=()=>{c(null),m(!1)},b=[{field:"name",headerName:"Name",width:150},{field:"phone",headerName:"Phone",width:150},{field:"authorizedAmount",headerName:"Authorized Amount",width:180},{field:"capturedAmount",headerName:"Captured Amount",width:180},{field:"holdDurationDays",headerName:"Hold Duration (Days)",width:180},{field:"status",headerName:"Status",width:150,renderCell:e=>{const t=s[e.value]||"bg-gray-200 text-gray-800";return a.jsx("div",{className:`px-2 py-2 flex mt-2 justify-center items-center rounded-full text-center text-sm font-medium ${t}`,children:e.value})}},{field:"actions",headerName:"Actions",width:200,renderCell:e=>a.jsx("button",{onClick:()=>{return t=e.row,c(t),void m(!0);var t},className:"px-4  bg-blue-500 text-white rounded",children:"Manage"})}],f=d.map((e=>{var t,a,r;return{id:e._id,name:(null==(t=e.userId)?void 0:t.firstName)+" "+(null==(a=e.userId)?void 0:a.lastName)||"N/A",phone:e.phone||(null==(r=e.userId)?void 0:r.phone)||"N/A",authorizedAmount:e.authorizedAmount||0,capturedAmount:void 0!==e.capturedAmount?e.capturedAmount:"N/A",holdDurationDays:e.holdDurationDays||"N/A",status:e.status||"Unknown"}}));return a.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-md",children:[a.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Pre-Authorization Data"}),a.jsx("div",{style:{height:600,width:"100%"},children:a.jsx(r,{rows:f,columns:b,pageSize:10,rowsPerPageOptions:[10,20,50],checkboxSelection:!1,disableSelectionOnClick:!0,className:"text-gray-700"})}),a.jsx(o,{open:h,onClose:y,children:a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg max-w-md mx-auto mt-20",children:[a.jsx("h2",{className:"text-lg font-bold mb-4",children:"Manage Pre-Authorization"}),a.jsxs("p",{children:["Authorized Amount: $",(null==u?void 0:u.authorizedAmount)||0]}),a.jsxs("p",{children:["Captured Amount: $",(null==u?void 0:u.capturedAmount)||0]}),a.jsxs("div",{className:"flex justify-end gap-4 mt-4",children:[a.jsx("button",{onClick:async()=>{if(null==u?void 0:u.id){g(!0);try{(await t.post(`${i}/api/cancel-pre-authorization`,{bookingId:u.id},{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}})).data.success&&(n.success("Pre-authorization canceled successfully."),x(),y())}catch(e){console.error("Error canceling pre-authorization:",e),n.error("Failed to cancel pre-authorization. Please try again.")}finally{g(!1)}}else alert("Invalid booking selected. Please try again.")},disabled:p,className:"px-4 py-2 bg-red-500 text-white rounded",children:"Refund"}),a.jsx("button",{onClick:()=>(async e=>{if(null==u?void 0:u.id){g(!0);try{(await t.post(`${i}/api/capture-pre-authorization`,{bookingId:u.id,amount:e},{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`}})).data.success&&(n.success("Pre-authorization captured successfully."),x(),y())}catch(a){console.error("Error capturing pre-authorization:",a),n.error("Failed to capture pre-authorization. Please try again.")}finally{g(!1)}}else alert("Invalid booking selected. Please try again.")})(null==u?void 0:u.authorizedAmount),disabled:p,className:"px-4 py-2 bg-green-500 text-white rounded",children:"Capture"})]})]})})]})};export{d as default};
