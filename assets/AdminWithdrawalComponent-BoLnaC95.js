import{r as e,ci as a,b as r,bg as t,j as s,g as l,a$ as n,aQ as i,aR as o,bZ as d,b$ as c,c0 as h,c1 as x,c2 as p,a4 as m,a2 as u,aV as j}from"./vendor-Zgq9WbFI.js";const v=()=>{const[v,b]=e.useState([]),[g,w]=e.useState(!1),[y,f]=e.useState(null),[N,C]=e.useState(null),[R,S]=e.useState(!1),[k,W]=e.useState(!1),[D,A]=e.useState(!1),[P,F]=e.useState(""),[$,q]=e.useState(null),[I,U]=e.useState(null),[B,L]=e.useState(!1),z=a("(max-width: 1024px)"),E=localStorage.getItem("accessToken"),O=r.create({baseURL:"https://rubertogo.com",headers:{Authorization:`Bearer ${E}`}}),M=async()=>{var e;w(!0);try{const e=await O.get("/api/withdrawals");b(e.data.withdrawals||[])}catch(a){console.error("Fetch Withdrawals Error:",(null==(e=a.response)?void 0:e.data)||a.message),j.error("Failed to fetch withdrawals.")}finally{w(!1)}},T=()=>{f(null),F(""),q(null),W(!1),A(!1),S(!1),L(!1)};e.useEffect((()=>{M()}),[]);const{getRootProps:V,getInputProps:G,isDragActive:H}=t({accept:"image/*",multiple:!1,onDrop:e=>q(e[0])}),_=[{field:"partnerName",headerName:"Partner Name",width:200},{field:"amount",headerName:"Amount (USD)",width:150},{field:"requestDate",headerName:"Requested On",width:200,renderCell:e=>new Date(e.value).toLocaleDateString()},{field:"status",headerName:"Status",width:150,renderCell:e=>s.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-semibold "+("approved"===e.value?"bg-green-100 text-green-600":"rejected"===e.value?"bg-red-100 text-red-600":"bg-yellow-100 text-yellow-600"),children:e.value.charAt(0).toUpperCase()+e.value.slice(1)})},{field:"actions",headerName:"Actions",width:400,renderCell:e=>s.jsx("div",{className:"flex gap-4",children:"pending"===e.row.status?s.jsxs(s.Fragment,{children:[s.jsx(m,{variant:"contained",color:"primary",onClick:()=>{return a=e.row.bankDetails,C(a),void S(!0);var a},children:"View Bank Details"}),s.jsx(m,{variant:"contained",color:"success",onClick:()=>{return a=e.row.id,f(a),void W(!0);var a},children:"Approve"}),s.jsx(m,{variant:"contained",color:"error",onClick:()=>{return a=e.row.id,f(a),void A(!0);var a},children:"Reject"})]}):"approved"===e.row.status?s.jsx(m,{variant:"contained",color:"secondary",onClick:()=>{return a=e.row.paymentReceipt,U(a),void L(!0);var a},children:"View Receipt"}):null})}];return s.jsxs("div",{className:"p-6 container mx-auto",children:[s.jsx(l,{variant:"h4",className:"font-bold text-gray-900 mb-8",children:"Manage Withdrawal Requests"}),s.jsx("div",{style:{height:500,width:"100%"},children:g?s.jsx("div",{className:"flex justify-center items-center h-full",children:s.jsx(n,{})}):z?s.jsx("div",{className:"space-y-4",children:v.map((e=>s.jsx(i,{className:"shadow-lg",children:s.jsxs(o,{children:[s.jsxs(l,{variant:"h6",children:[s.jsx("strong",{children:"Partner Name:"})," ",e.partnerId.firstName," ",e.partnerId.lastName]}),s.jsxs(l,{children:[s.jsx("strong",{children:"Amount:"})," $",e.amount.toFixed(2)]}),s.jsxs(l,{children:[s.jsx("strong",{children:"Requested On:"})," ",new Date(e.requestDate).toLocaleDateString()]}),s.jsxs(l,{children:[s.jsx("strong",{children:"Status:"})," ",s.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-semibold "+("approved"===e.status?"bg-green-100 text-green-600":"rejected"===e.status?"bg-red-100 text-red-600":"bg-yellow-100 text-yellow-600"),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})]})]})},e._id)))}):s.jsx("div",{style:{height:500,width:"100%"},children:s.jsx(d,{rows:v.map((e=>({id:e._id,partnerName:`${e.partnerId.firstName} ${e.partnerId.lastName}`,...e}))),columns:_,pageSize:5,rowsPerPageOptions:[5,10],disableSelectionOnClick:!0,sx:{"& .MuiDataGrid-root":{overflowX:"auto"},"& .MuiDataGrid-cell":{whiteSpace:"nowrap"}}})})}),s.jsxs(c,{open:R,onClose:T,maxWidth:"sm",fullWidth:!0,className:"max-w-full",children:[s.jsx(h,{children:s.jsx(l,{variant:"h5",className:"font-bold text-center",children:"Bank Details of Partner"})}),s.jsx(x,{children:N?s.jsxs("div",{className:"p-4",children:[s.jsxs(l,{variant:"body1",className:"mb-4 text-gray-700 border-b pb-2",children:[s.jsx("strong",{children:"Bank Name:"})," ",N.bankName]}),s.jsxs(l,{variant:"body1",className:"mb-4 text-gray-700 border-b pb-2",children:[s.jsx("strong",{children:"Account Holder Name:"})," ",N.accountHolderName]}),s.jsxs(l,{variant:"body1",className:"mb-4 text-gray-700 border-b pb-2",children:[s.jsx("strong",{children:"Account Number:"})," ",N.accountNumber]}),s.jsxs(l,{variant:"body1",className:"mb-4 text-gray-700 border-b pb-2",children:[s.jsx("strong",{children:"Branch Name:"})," ",N.branchName]}),s.jsxs(l,{variant:"body1",className:"mb-4 text-gray-700 border-b pb-2",children:[s.jsx("strong",{children:"SWIFT Code:"})," ",N.swiftCode]})]}):s.jsx(l,{variant:"body1",className:"text-gray-600",children:"No bank details available."})}),s.jsx(p,{children:s.jsx(m,{onClick:T,variant:"contained",color:"primary",className:"mx-auto",style:{minWidth:"150px"},children:"Close"})})]}),s.jsxs(c,{open:k,onClose:T,maxWidth:"sm",fullWidth:!0,className:"max-w-full",children:[s.jsx(h,{children:"Approve Withdrawal Request"}),s.jsxs(x,{children:[s.jsx(l,{variant:"body2",className:"mb-4",children:"Upload the payment receipt for approval."}),s.jsxs("div",{...V(),className:"border-2 border-dashed p-4 text-center "+(H?"border-green-500":"border-gray-400"),children:[s.jsx("input",{...G()}),$?s.jsx(l,{variant:"body1",children:$.name}):s.jsx(l,{variant:"body2",children:"Drag & drop or click to upload receipt"})]})]}),s.jsxs(p,{children:[s.jsx(m,{onClick:T,color:"primary",children:"Cancel"}),s.jsx(m,{onClick:async()=>{var e;if(!$)return void j.error("Please upload a payment receipt before approving.");const a=new FormData;a.append("file",$),w(!0);try{const e=(await O.post("/api/upload",a,{headers:{"Content-Type":"multipart/form-data"}})).data.imageURL;await O.put(`/api/withdrawals/${y}`,{status:"approved",paymentReceipt:e}),j.success("Withdrawal approved successfully."),M(),T()}catch(r){console.error("Approval Error:",(null==(e=r.response)?void 0:e.data)||r.message),j.error("Failed to approve withdrawal.")}finally{w(!1)}},color:"success",disabled:g,children:g?s.jsx(n,{size:20,color:"inherit"}):"Approve"})]})]}),s.jsxs(c,{open:D,onClose:T,maxWidth:"sm",fullWidth:!0,className:"max-w-full",children:[s.jsx(h,{children:"Reject Withdrawal Request"}),s.jsx(x,{children:s.jsx(u,{label:"Rejection Reason",variant:"outlined",fullWidth:!0,multiline:!0,rows:4,value:P,onChange:e=>F(e.target.value)})}),s.jsxs(p,{children:[s.jsx(m,{onClick:T,color:"primary",children:"Cancel"}),s.jsx(m,{onClick:async()=>{var e;if(P.trim()){w(!0);try{await O.put(`/api/withdrawals/${y}`,{status:"rejected",rejectionReason:P}),j.success("Withdrawal rejected successfully."),M(),T()}catch(a){console.error("Rejection Error:",(null==(e=a.response)?void 0:e.data)||a.message),j.error("Failed to reject withdrawal.")}finally{w(!1)}}else j.info("Please provide a reason for rejection.")},color:"error",disabled:g,children:g?s.jsx(n,{size:20,color:"inherit"}):"Reject"})]})]}),s.jsxs(c,{open:B,onClose:T,fullWidth:!0,children:[s.jsx(h,{children:s.jsx(l,{variant:"h5",className:"font-bold text-center",children:"Payment Receipt"})}),s.jsx(x,{children:g?s.jsx("div",{className:"flex justify-center items-center",children:s.jsx(n,{})}):I?s.jsx("img",{src:I,alt:"Payment Receipt",style:{width:"100%",height:"auto"},onLoad:()=>w(!1)}):s.jsx(l,{className:"text-center text-gray-600",children:"No receipt available."})}),s.jsx(p,{children:s.jsx(m,{onClick:T,variant:"contained",color:"primary",style:{minWidth:"100px"},children:"Close"})})]})]})};export{v as default};
