import{r as d,j as e,c as J,b as D,d as V,aa as H,g as Y,s as Z,u as _,k as K,U as S,V as f}from"./index-DLpikvjc.js";import{h as M}from"./index-DHQm9bna.js";import{s as Q,D as X}from"./DataGrid-0EYBgjNF.js";import{a as ee}from"./Chip-CF_ffCUn.js";import{T as u}from"./Typography-Bytm3ycu.js";import{B as q}from"./Box-B-GTZaan.js";import{T as G}from"./TextField-DxLbd0T7.js";import{B as N}from"./Button-Dd5SUgtW.js";import{M as te}from"./Modal-CXdfSMMy.js";import{D as ae,a as se}from"./DialogContent-z22RIIQN.js";import{D as re}from"./DialogTitle-1j7OIzSl.js";import{D as oe}from"./DialogActions-B0QvCKDd.js";import"./iconBase-VNWhYZQq.js";import"./index-BCUionA9.js";import"./ButtonBase-C_wHrl86.js";import"./Portal-C-Oqgn3D.js";import"./Select-YDvcYVIq.js";import"./Menu-BmUU4LJX.js";import"./Grow-BubuCfXA.js";import"./useSlot-C81N96pq.js";import"./useTheme-BiC74sbM.js";import"./useTheme-BaCcI6wb.js";import"./List-CP_tTsPm.js";import"./Paper-DzT7rg5Q.js";import"./useControlled-DAqY8FYl.js";import"./createSvgIcon-DAAY2Ss0.js";import"./index-CMMxByV_.js";import"./Close-B6mu1L3C.js";import"./Badge-VQgqQlIk.js";import"./Tooltip-Cxmz8oas.js";import"./IconButton-CQP4y5cZ.js";import"./ClickAwayListener-ChyV3r07.js";import"./MenuItem-Dk6ToQkn.js";import"./listItemTextClasses-c0_geO1e.js";import"./dividerClasses-CWGPkxTW.js";import"./Toolbar-4GwuCQeM.js";import"./ListItemText-BaK17cQI.js";import"./InputAdornment-Dr7QdbWB.js";import"./Divider-BZXxc7Ka.js";import"./FormControlLabel-BZ90GYya.js";import"./TableCell-Bsl3T8tX.js";import"./Skeleton-CuRxEDba.js";import"./isMuiElement-Rh47zddv.js";const ie=H(),ne=Q("div",{name:"MuiContainer",slot:"Root",overridesResolver:(o,r)=>{const{ownerState:i}=o;return[r.root,r[`maxWidth${D(String(i.maxWidth))}`],i.fixed&&r.fixed,i.disableGutters&&r.disableGutters]}}),le=o=>ee({props:o,name:"MuiContainer",defaultTheme:ie}),ce=(o,r)=>{const i=c=>Y(r,c),{classes:l,fixed:x,disableGutters:w,maxWidth:a}=o,n={root:["root",a&&`maxWidth${D(String(a))}`,x&&"fixed",w&&"disableGutters"]};return V(n,i,l)};function de(o={}){const{createStyledComponent:r=ne,useThemeProps:i=le,componentName:l="MuiContainer"}=o,x=r(({theme:a,ownerState:n})=>({width:"100%",marginLeft:"auto",boxSizing:"border-box",marginRight:"auto",...!n.disableGutters&&{paddingLeft:a.spacing(2),paddingRight:a.spacing(2),[a.breakpoints.up("sm")]:{paddingLeft:a.spacing(3),paddingRight:a.spacing(3)}}}),({theme:a,ownerState:n})=>n.fixed&&Object.keys(a.breakpoints.values).reduce((c,m)=>{const g=m,p=a.breakpoints.values[g];return p!==0&&(c[a.breakpoints.up(g)]={maxWidth:`${p}${a.breakpoints.unit}`}),c},{}),({theme:a,ownerState:n})=>({...n.maxWidth==="xs"&&{[a.breakpoints.up("xs")]:{maxWidth:Math.max(a.breakpoints.values.xs,444)}},...n.maxWidth&&n.maxWidth!=="xs"&&{[a.breakpoints.up(n.maxWidth)]:{maxWidth:`${a.breakpoints.values[n.maxWidth]}${a.breakpoints.unit}`}}}));return d.forwardRef(function(n,c){const m=i(n),{className:g,component:p="div",disableGutters:k=!1,fixed:j=!1,maxWidth:y="lg",classes:W,...C}=m,b={...m,component:p,disableGutters:k,fixed:j,maxWidth:y},h=ce(b,l);return e.jsx(x,{as:p,ownerState:b,className:J(h.root,g),ref:c,...C})})}const me=de({createStyledComponent:Z("div",{name:"MuiContainer",slot:"Root",overridesResolver:(o,r)=>{const{ownerState:i}=o;return[r.root,r[`maxWidth${D(String(i.maxWidth))}`],i.fixed&&r.fixed,i.disableGutters&&r.disableGutters]}}),useThemeProps:o=>_({props:o,name:"MuiContainer"})}),pe="https://rubertogo.com",ue=o=>{if(!o)return null;try{const i=o.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),l=decodeURIComponent(atob(i).split("").map(x=>"%"+("00"+x.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(l)}catch(r){return console.error("Failed to parse JWT:",r.message),null}},st=()=>{const[o,r]=d.useState(""),[i,l]=d.useState(!1),[x,w]=d.useState([]),[a,n]=d.useState(0),[c,m]=d.useState(null),[g,p]=d.useState(!1),[k,j]=d.useState(!1),[y,W]=d.useState(""),C=localStorage.getItem("accessToken"),b=ue(C),h=b==null?void 0:b.id,v=K.create({baseURL:pe,headers:{Authorization:`Bearer ${C}`}}),F=async()=>{var t;try{const s=await v.get(`/api/bank-details/${h}`);m(s.data.bankDetails)}catch(s){((t=s.response)==null?void 0:t.status)===404?m(null):f.error("Failed to fetch bank details.")}},I=async t=>{try{const s=await v.post("/api/bank-details",t);m(s.data.bankDetails),f.success("Bank details saved successfully."),p(!1)}catch{f.error("Failed to save bank details.")}},B=async()=>{var t;l(!0);try{const s=await v.get(`/api/partner/balance/${h}`);n(s.data.balance)}catch(s){((t=s.response)==null?void 0:t.status)===404?n(0):f.error("Failed to fetch balance")}finally{l(!1)}},P=async()=>{var t;l(!0);try{const s=await v.get(`/api/withdrawals/partner/${h}`);w(s.data.withdrawals||[])}catch(s){((t=s.response)==null?void 0:t.status)===404&&w([])}finally{l(!1)}},O=async({partnerId:t,amount:s})=>{var T,U,A;if(!c){f.error("You must set up your bank details before requesting a withdrawal."),p(!0);return}try{return(await v.post("/api/withdrawals",{partnerId:t,amount:s})).data}catch(R){((T=R.response)==null?void 0:T.status)===400&&f.error(((A=(U=R.response)==null?void 0:U.data)==null?void 0:A.message)||"Invalid request data.")}},L=async()=>{if(!o){f.error("Please enter an amount.");return}l(!0);try{await O({partnerId:h,amount:o}),r(""),P(),B()}catch(t){f.error(t.message)}finally{l(!1)}};d.useEffect(()=>{h&&(P(),B(),F())},[h]);const z=t=>{W(t),j(!0)},$=()=>{j(!1),W("")},E=[{field:"amount",headerName:"Amount (USD)",width:250,renderCell:t=>`${t.value.toFixed(2)}`},{field:"requestDate",headerName:"Requested On",width:250,renderCell:t=>new Date(t.value).toLocaleDateString()},{field:"status",headerName:"Status",width:200,renderCell:t=>e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${t.value==="approved"?"bg-green-100 text-green-600":t.value==="rejected"?"bg-red-100 text-red-600":"bg-yellow-100 text-yellow-600"}`,children:t.value.charAt(0).toUpperCase()+t.value.slice(1)})},{field:"actions",headerName:"Actions",width:500,renderCell:t=>e.jsx("div",{className:"flex gap-4",children:t.row.status==="approved"&&e.jsx(N,{variant:"contained",color:"secondary",onClick:()=>z(t.row.paymentReceipt),children:"View Receipt"})})}];return e.jsxs(me,{maxWidth:"lg",sx:{paddingTop:4,paddingBottom:4},children:[e.jsxs(u,{variant:"h4",className:"font-bold text-center bg-green-900 p-5 text-white mb-8",children:[e.jsx(M,{className:"inline"})," Withdrawal Requests"]}),e.jsxs(q,{sx:{backgroundColor:"green",color:"white",borderRadius:2,textAlign:"center",padding:3,marginBottom:4},children:[e.jsx(u,{variant:"h4",className:"font-semibold text-white text-center mb-4",children:"Current Balance"}),e.jsxs(u,{variant:"h3",className:"text-white font-extrabold flex items-center justify-center",children:[e.jsx(M,{className:"inline"})," ",a.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6 mb-8 max-w-4xl mx-auto",children:[e.jsx(u,{variant:"h6",className:"font-semibold text-gray-800 mb-4",children:"Request a Withdrawal"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center",children:[e.jsx(G,{label:"Enter Amount",variant:"outlined",value:o,onChange:t=>r(t.target.value),fullWidth:!0,className:"flex-1"}),e.jsx(N,{variant:"contained",onClick:L,disabled:i,className:"bg-gradient-to-r from-blue-500 to-blue-700 text-white px-8 py-2",children:i?e.jsx(S,{size:20,color:"inherit"}):"Submit"})]})]}),e.jsxs("div",{className:"bg-gray-50 shadow-md rounded-lg p-6 max-w-4xl mx-auto",children:[e.jsx(u,{variant:"h6",className:"font-semibold text-gray-800 mb-4",children:"Withdrawal History"}),i?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(S,{})}):x.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{style:{minWidth:"600px"},children:e.jsx(X,{rows:x.map((t,s)=>({id:s,...t})),columns:E,pageSize:5,rowsPerPageOptions:[5],disableSelectionOnClick:!0,className:"w-full"})})}):e.jsx(u,{variant:"body1",className:"text-gray-600",children:"No withdrawal requests found."})]}),e.jsx(te,{open:g,onClose:()=>p(!1),className:"container",children:e.jsxs(q,{sx:{maxWidth:"500px",width:"100%",bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4,mx:"auto",mt:8},children:[e.jsx(u,{variant:"h6",className:"mb-4",children:"Add/Update Bank Details"}),["bankName","accountNumber","accountHolderName","branchName","swiftCode"].map(t=>e.jsx(G,{label:t.replace(/([A-Z])/g," $1"),variant:"outlined",fullWidth:!0,margin:"normal",value:(c==null?void 0:c[t])||"",onChange:s=>m({...c,[t]:s.target.value})},t)),e.jsx(N,{variant:"contained",color:"primary",onClick:()=>I(c),fullWidth:!0,className:"mt-4",children:"Save Details"})]})}),e.jsxs(ae,{open:k,onClose:$,fullWidth:!0,children:[e.jsx(re,{children:e.jsx(u,{variant:"h5",className:"font-bold text-center",children:"Payment Receipt"})}),e.jsx(se,{children:i?e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(S,{})}):y?e.jsx("img",{src:y,alt:"Payment Receipt",style:{width:"100%",height:"auto",borderRadius:"8px"},onLoad:()=>l(!1)}):e.jsx(u,{className:"text-center text-gray-600",children:"No receipt available."})}),e.jsx(oe,{children:e.jsx(N,{onClick:$,variant:"contained",color:"primary",style:{minWidth:"100px"},children:"Close"})})]})]})};export{st as default};
