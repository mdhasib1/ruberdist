import{r as e,a as r,ai as s,b as a,bg as t,j as i,m as o,a4 as l,a2 as n,bi as d,bj as c,af as m,I as h,bk as u,bl as x,bn as g,bo as v,bp as p,bq as j,br as f,bs as N,g as b,aQ as y,aR as k,a$ as w,G as D,_ as I,aV as P,bw as F}from"./vendor-Zgq9WbFI.js";import{a as C}from"./index-D29cp_SG.js";import{L as S}from"./LoginModal-D5yrFgFu.js";import{M as L}from"./Modal-D1aNLYnG.js";import{O as T}from"./OTPModal-B3tYgRCI.js";import"./Carousel-D7BsNlAJ.js";const B=F("pk_live_51PwWTGDCK8rR2FJAZlmM7KPakXDO09KCBJRjUT5QRFNRRTvlctb9KG8D9bxZ38RRsG6np5RYrJmVG2AeP22KXq7P00rQKtFDnq"),R="https://rubertogo.com",A=e=>{var r;const s=I().format("dddd"),a=null==(r=e.dailyPricing)?void 0:r.find((e=>e.day===s));return(null==a?void 0:a.pricePerHour)?`${a.pricePerHour} CHF / hour`:"Not available"},q=()=>{var F,q,W;const[Y,z]=e.useState({firstName:"",lastName:"",address:"",email:"",phone:"",idDocumentFront:null,idDocumentBack:null,licenseFront:null,licenseBack:null,isNotDriver:!1,referralCode:"",timeZone:"",driverInfo:{driverFirstName:"",driverLastName:"",driverAddress:"",driverEmail:"",driverPhone:"",driverLicenseFront:null,driverLicenseBack:null,driverIdDocumentFront:null,driverIdDocumentBack:null}}),[M,$]=e.useState(!1),[E,O]=e.useState(""),[H,K]=e.useState(null),[V,G]=e.useState(!1),{lang:J}=r(),[Z,_]=e.useState(!1),[U,Q]=e.useState(""),[X,ee]=e.useState(""),re=e.useRef([]),[se,ae]=e.useState(null),te=localStorage.getItem("accessToken"),[ie,oe]=e.useState(!1),[le,ne]=e.useState(null),{translations:de}=C(),[ce,me]=e.useState(!1),[he,ue]=e.useState(null),[xe,ge]=e.useState(!1),[ve,pe]=e.useState(!1),[je,fe]=e.useState(null),[Ne,be]=e.useState(!1),[ye,ke]=e.useState([]),[we,De]=e.useState(!1),Ie=e=>{ue(e)};e.useEffect((()=>{z((e=>({...e,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone})))}),[]);e.useEffect((()=>{const e=localStorage.getItem("bookingData");e&&K(JSON.parse(e))}),[]);const Pe=e=>{const{name:r,value:s}=e.target;z((e=>({...e,[r]:s})))},Fe=e.useCallback(s.debounce((async e=>{try{201===(await a.post(`${R}/api/exist-account`,{email:e})).status?G(!0):G(!1)}catch(r){console.error("Error checking account existence:",r)}}),500),[]),Ce=e=>{const{name:r,value:s}=e.target;z((e=>({...e,driverInfo:{...e.driverInfo,[r]:s}})))},Se=async(e,r,s=!1)=>{const t=e[0],i=await(async e=>{const r=new FormData;r.append("file",e);try{return(await a.post(`${R}/api/upload`,r,{headers:{"Content-Type":"multipart/form-data"}})).data.imageURL}catch(s){return console.error("Error uploading file:",s),P.error("Failed to upload file. Please try again."),null}})(t);i&&z(s?e=>({...e,driverInfo:{...e.driverInfo,[r]:i}}):e=>({...e,[r]:i}))},{getRootProps:Le,getInputProps:Te}=t({onDrop:e=>Se(e,"idDocumentFront"),accept:"image/*"}),{getRootProps:Be,getInputProps:Re}=t({onDrop:e=>Se(e,"idDocumentBack"),accept:"image/*"}),{getRootProps:Ae,getInputProps:qe}=t({onDrop:e=>Se(e,"licenseFront"),accept:"image/*"}),{getRootProps:We,getInputProps:Ye}=t({onDrop:e=>Se(e,"licenseBack"),accept:"image/*"}),{getRootProps:ze,getInputProps:Me}=t({onDrop:e=>Se(e,"driverIdDocumentFront",!0),accept:"image/*"}),{getRootProps:$e,getInputProps:Ee}=t({onDrop:e=>Se(e,"driverIdDocumentBack",!0),accept:"image/*"}),{getRootProps:Oe,getInputProps:He}=t({onDrop:e=>Se(e,"driverLicenseFront",!0),accept:"image/*"}),{getRootProps:Ke,getInputProps:Ve}=t({onDrop:e=>Se(e,"driverLicenseBack",!0),accept:"image/*"}),Ge=e=>{const r=new Date(e);return`${String(r.getDate()).padStart(2,"0")}/${String(r.getMonth()+1).padStart(2,"0")}/${r.getFullYear()}`};return i.jsxs(o.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:1},className:"bg-white min-h-screen",children:[i.jsxs("div",{className:"container mx-auto py-10 px-4 sm:px-6 lg:px-8",children:[E&&i.jsx("div",{className:"flex justify-center mt-4",children:i.jsxs("p",{className:"flex flex-col sm:flex-row items-center px-4 py-2 bg-red-100 border border-red-400 text-red-600 rounded-lg font-semibold",children:[i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mb-2 sm:mb-0 sm:mr-2 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18.364 5.636L5.636 18.364M5.636 5.636l12.728 12.728"})}),i.jsx("span",{className:"text-center sm:text-left",children:E}),H&&i.jsx(l,{sx:{marginTop:{xs:"1rem",sm:"0"},marginLeft:{sm:"1rem"}},variant:"outlined",color:"primary",onClick:()=>(e=>{const r=I().startOf("hour"),s=r.add(4,"hour"),a=4*e.pricePerHour;ne({...e,name:e.name.en||"Unnamed Van",description:e.description.en||"No description available.",totalPrice:a,startDate:r.format("YYYY-MM-DD"),endDate:s.format("YYYY-MM-DD"),startTime:r.format("h:mm A"),endTime:s.format("h:mm A")}),oe(!0)})(H.vanDetails),children:"Select New Time"})]})}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-10",children:[i.jsx("div",{className:"col-span-2",children:i.jsxs("form",{className:"space-y-6 p-5 bg-gray-50 shadow-md rounded-lg",children:[i.jsx(n,{label:i.jsxs("div",{className:"flex items-center",children:[de.checkoutemail,i.jsx(m,{title:"Email is required for booking confirmation",children:i.jsx(h,{size:"small",className:"ml-1",children:i.jsx(u,{})})})]}),placeholder:de.checkoutemail,name:"email",type:"email",fullWidth:!0,variant:"outlined",value:Y.email,onChange:e=>{const r=e.target.value;z((e=>({...e,email:r}))),Fe(r)},required:!0,InputProps:{startAdornment:i.jsx(d,{position:"start",children:i.jsx(c,{className:"text-gray-500"})})},className:"transition duration-300 focus-within:shadow-md rounded-lg"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsx(n,{label:i.jsxs("div",{className:"flex items-center",children:[de.checkoutFirstName,i.jsx(m,{title:"First name is required for booking confirmation",children:i.jsx(h,{size:"small",className:"ml-1",children:i.jsx(u,{})})})]}),placeholder:de.checkoutFirstName,name:"firstName",fullWidth:!0,variant:"outlined",value:Y.firstName,onChange:Pe,required:!0,InputProps:{startAdornment:i.jsx(d,{position:"start",children:i.jsx(x,{className:"text-gray-500"})})},className:"transition duration-300 focus-within:shadow-md rounded-lg"}),i.jsx(n,{label:i.jsxs("div",{className:"flex items-center",children:[de.checkoutLastName,i.jsx(m,{title:"Last name is required for booking confirmation",children:i.jsx(h,{size:"small",className:"ml-1",children:i.jsx(u,{})})})]}),placeholder:de.checkoutLastName,name:"lastName",fullWidth:!0,variant:"outlined",value:Y.lastName,onChange:Pe,required:!0,InputProps:{startAdornment:i.jsx(d,{position:"start",children:i.jsx(x,{className:"text-gray-500"})})},className:"transition duration-300 focus-within:shadow-md rounded-lg"})]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-1 gap-6",children:i.jsx(n,{label:i.jsxs("div",{className:"flex items-center",children:[de.checkoutAddress,i.jsx(m,{title:"Address is required for booking confirmation",children:i.jsx(h,{size:"small",className:"ml-1",children:i.jsx(u,{})})})]}),placeholder:de.checkoutAddress,name:"address",fullWidth:!0,variant:"outlined",value:Y.address,onChange:Pe,required:!0,InputProps:{startAdornment:i.jsx(d,{position:"start",children:i.jsx(g,{className:"text-gray-500"})})},className:"transition duration-300 focus-within:shadow-md rounded-lg"})}),i.jsx(n,{label:i.jsxs("div",{className:"flex items-center",children:[de.checkoutphone,i.jsx(m,{title:"Phone number is required for booking confirmation",children:i.jsx(h,{size:"small",className:"ml-1",children:i.jsx(u,{})})})]}),placeholder:de.checkoutphone,name:"phone",fullWidth:!0,variant:"outlined",value:Y.phone,onChange:Pe,required:!0,InputProps:{startAdornment:i.jsx(d,{position:"start",children:i.jsx(v,{className:"text-gray-500"})})},className:"transition duration-300 focus-within:shadow-md rounded-lg"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{children:[i.jsxs(p,{children:[de.checkoutIdFront,i.jsx(m,{title:"You must provide a valid ID document",children:i.jsx(h,{size:"small",className:"ml-1",children:i.jsx(u,{})})})]}),i.jsxs("div",{...Le(),className:"p-4 border-dashed border-2 border-gray-300 mt-2 rounded-lg hover:shadow-lg transition-all",children:[i.jsx("input",{...Te()}),Y.idDocumentFront?i.jsx("img",{src:Y.idDocumentFront,alt:"ID Front Preview",className:"w-full h-40 object-cover mt-2 rounded-md"}):i.jsx("p",{className:"text-gray-500",children:de.draganddrop})]})]}),i.jsxs("div",{children:[i.jsxs(p,{children:[de.checkoutIdBack,i.jsx(m,{title:"You must provide a valid ID document",children:i.jsx(h,{size:"small",className:"ml-1",children:i.jsx(u,{})})})]}),i.jsxs("div",{...Be(),className:"p-4 border-dashed border-2 border-gray-300 mt-2 rounded-lg hover:shadow-lg transition-all",children:[i.jsx("input",{...Re()}),Y.idDocumentBack?i.jsx("img",{src:Y.idDocumentBack,alt:"ID Back Preview",className:"w-full h-40 object-cover mt-2 rounded-md"}):i.jsx("p",{className:"text-gray-500",children:de.draganddrop})]})]})]}),!Y.isNotDriver&&i.jsx(i.Fragment,{children:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{children:[i.jsxs(p,{children:[de.checkoutLicenseFront,i.jsx(m,{title:"You must provide a valid driver license",children:i.jsx(h,{size:"small",className:"ml-1",children:i.jsx(u,{})})})]}),i.jsxs("div",{...Ae(),className:"p-4 border-dashed border-2 border-gray-300 mt-2 rounded-lg hover:shadow-lg transition-all",children:[i.jsx("input",{...qe()}),Y.licenseFront?i.jsx("img",{src:Y.licenseFront,alt:"Driver License Front Preview",className:"w-full h-40 object-cover mt-2 rounded-md"}):i.jsx("p",{className:"text-gray-500",children:de.draganddrop})]})]}),i.jsxs("div",{children:[i.jsxs(p,{children:[de.checkoutLicenseBack,i.jsx(m,{title:"You must provide a valid driver license",children:i.jsx(h,{size:"small",className:"ml-1",children:i.jsx(u,{})})})]}),i.jsxs("div",{...We(),className:"p-4 border-dashed border-2 border-gray-300 mt-2 rounded-lg hover:shadow-lg transition-all",children:[i.jsx("input",{...Ye()}),Y.licenseBack?i.jsx("img",{src:Y.licenseBack,alt:"Driver License Back Preview",className:"w-full h-40 object-cover mt-2 rounded-md"}):i.jsx("p",{className:"text-gray-500",children:de.draganddrop})]})]})]})}),i.jsx(j,{control:i.jsx(f,{checked:Y.isNotDriver,onChange:e=>{z((r=>({...r,isNotDriver:e.target.checked})))},name:"isNotDriver",color:"primary"}),label:i.jsxs("div",{className:"flex items-center",children:[de.checkoutImnotdriver,i.jsx(m,{title:"Check this box if you are not the driver",children:i.jsx(h,{size:"small",className:"ml-1",children:i.jsx(u,{})})})]})}),i.jsxs("div",{className:"flex flex-col space-y-4",children:[i.jsx(j,{control:i.jsx(f,{checked:xe,onChange:e=>{ge(e.target.checked)},color:"primary"}),label:i.jsxs("div",{className:"flex items-center",children:["Apply Referral Code",i.jsx(m,{title:"Enter a valid referral code to get a discount",children:i.jsx(h,{size:"small",className:"ml-1",children:i.jsx(u,{})})})]})}),xe&&i.jsx(n,{label:"Referral Code",name:"referralCode",variant:"outlined",fullWidth:!0,value:Y.referralCode,onChange:e=>{const r=e.target.value;z((e=>({...e,referralCode:r}))),(async e=>{try{200===(await a.post(`${R}/api/valid-referral-code`,{referralCode:e},{headers:{Authorization:`Bearer ${te}`}})).status&&P.success("Referral code is valid.")}catch(r){console.error("Error validating referral code:",r),P.error("Invalid referral code.")}})(r)},InputProps:{startAdornment:i.jsx(d,{position:"start",children:i.jsx(N,{className:"text-gray-500"})})},className:"transition duration-300 focus-within:shadow-md rounded-lg "+(!0===je?"border-green-500":!1===je?"border-red-500":""),helperText:!0===je?"Referral code is valid!":!1===je?"Invalid referral code":""})]}),Y.isNotDriver&&i.jsxs(i.Fragment,{children:[i.jsx(b,{variant:"h6",className:"font-bold mt-6",children:de.checkoutDriverInformationHeading}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsx(n,{label:de.checkoutDriverFirstName,name:"driverFirstName",fullWidth:!0,variant:"outlined",value:Y.driverInfo.driverFirstName,onChange:Ce,required:!0,InputProps:{startAdornment:i.jsx(d,{position:"start",children:i.jsx(x,{className:"text-gray-500"})})},className:"transition duration-300 focus-within:shadow-md rounded-lg"}),i.jsx(n,{label:de.checkoutDriverLastName,name:"driverLastName",fullWidth:!0,variant:"outlined",value:Y.driverInfo.driverLastName,onChange:Ce,required:!0,InputProps:{startAdornment:i.jsx(d,{position:"start",children:i.jsx(x,{className:"text-gray-500"})})},className:"transition duration-300 focus-within:shadow-md rounded-lg"})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsx(n,{label:de.checkoutDriverAddress,name:"driverAddress",fullWidth:!0,variant:"outlined",value:Y.driverInfo.driverAddress,onChange:Ce,required:!0,InputProps:{startAdornment:i.jsx(d,{position:"start",children:i.jsx(g,{className:"text-gray-500"})})},className:"transition duration-300 focus-within:shadow-md rounded-lg"}),i.jsx(n,{label:de.checkoutDriverEmail,name:"driverEmail",type:"email",fullWidth:!0,variant:"outlined",value:Y.driverInfo.driverEmail,onChange:Ce,required:!0,InputProps:{startAdornment:i.jsx(d,{position:"start",children:i.jsx(c,{className:"text-gray-500"})})},className:"transition duration-300 focus-within:shadow-md rounded-lg"})]}),i.jsx(n,{label:de.checkoutDriverPhone,name:"driverPhone",fullWidth:!0,variant:"outlined",value:Y.driverInfo.driverPhone,onChange:Ce,required:!0,InputProps:{startAdornment:i.jsx(d,{position:"start",children:i.jsx(v,{className:"text-gray-500"})})},className:"transition duration-300 focus-within:shadow-md rounded-lg"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{children:[i.jsx(p,{children:de.checkoutDriverIdFront}),i.jsxs("div",{...Oe(),className:"p-4 border-dashed border-2 border-gray-300 mt-2 rounded-lg hover:shadow-lg transition-all",children:[i.jsx("input",{...He()}),Y.driverInfo.driverLicenseFront?i.jsx("img",{src:Y.driverInfo.driverLicenseFront,alt:"Driver License Front Preview",className:"w-full h-40 object-cover mt-2 rounded-md"}):i.jsx("p",{className:"text-gray-500",children:de.draganddrop})]})]}),i.jsxs("div",{children:[i.jsxs(p,{children:[" ",de.checkoutDriverIdBack," "]}),i.jsxs("div",{...Ke(),className:"p-4 border-dashed border-2 border-gray-300 mt-2 rounded-lg hover:shadow-lg transition-all",children:[i.jsx("input",{...Ve()}),Y.driverInfo.driverLicenseBack?i.jsx("img",{src:Y.driverInfo.driverLicenseBack,alt:"Driver License Back Preview",className:"w-full h-40 object-cover mt-2 rounded-md"}):i.jsx("p",{className:"text-gray-500",children:de.draganddrop})]})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{children:[i.jsxs(p,{children:[" ",de.checkoutDriverLicenseFront," "]}),i.jsxs("div",{...ze(),className:"p-4 border-dashed border-2 border-gray-300 mt-2 rounded-lg hover:shadow-lg transition-all",children:[i.jsx("input",{...Me()}),Y.driverInfo.driverIdDocumentFront?i.jsx("img",{src:Y.driverInfo.driverIdDocumentFront,alt:"Driver ID Front Preview",className:"w-full h-40 object-cover mt-2 rounded-md"}):i.jsx("p",{className:"text-gray-500",children:de.draganddrop})]})]}),i.jsxs("div",{children:[i.jsxs(p,{children:[" ",de.checkoutDriverLicenseBack," "]}),i.jsxs("div",{...$e(),className:"p-4 border-dashed border-2 border-gray-300 mt-2 rounded-lg hover:shadow-lg transition-all",children:[i.jsx("input",{...Ee()}),Y.driverInfo.driverIdDocumentBack?i.jsx("img",{src:Y.driverInfo.driverIdDocumentBack,alt:"Driver ID Back Preview",className:"w-full h-40 object-cover mt-2 rounded-md"}):i.jsx("p",{className:"text-gray-500",children:de.draganddrop})]})]})]})]})]})}),i.jsx("div",{className:"sm:col-span-1 col-span-2",children:i.jsx("div",{className:"bg-gradient-to-br from-[#1e3c72] to-[#f83920] p-1 rounded-2xl ",children:i.jsxs(y,{className:"p-6 h-full bg-white rounded-xl shadow-lg",children:[i.jsxs(k,{className:"flex flex-col items-center space-y-10",children:[H&&i.jsx(i.Fragment,{children:i.jsxs("div",{className:"flex flex-col items-center gap-6 p-6 bg-gradient-to-r from-white via-gray-100 to-gray-50   hover:shadow-lg transition-shadow duration-300",children:[i.jsx("img",{src:H.vanDetails.images[0],alt:"Van",className:"w-56 h-32 rounded-lg object-cover shadow-lg border-4 border-gray-100"}),i.jsxs("div",{className:"text-center",children:[i.jsx(b,{variant:"h6",className:"font-extrabold text-gray-800 text-xl tracking-wide",children:(null==(F=H.vanDetails)?void 0:F.name[J])||(null==(q=H.vanDetails)?void 0:q.name.en)}),i.jsxs(b,{variant:"body1",className:"text-gray-600 text-base mt-3",children:[i.jsx("span",{className:"font-semibold text-gray-800",children:"Total Hours:"})," ",H.selectedSlots.length]}),i.jsxs(b,{variant:"body1",className:"text-gray-600 text-base mt-2",children:[i.jsxs("span",{className:"font-semibold text-gray-800",children:[de.priceLabel,":"]})," ",A(H.vanDetails)]})]}),i.jsx("div",{className:"flex flex-col items-center",children:i.jsxs(b,{variant:"h5",className:"text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-500 to-green-400 mt-6",children:["Total: ",H.totalPrice," CHF"]})})]})}),i.jsx(j,{control:i.jsx(f,{checked:we,onChange:e=>{De(e.target.checked)},color:"primary"}),label:`Unlimited Kilometer Ride ${null==(W=null==H?void 0:H.vanDetails)?void 0:W.unlimitedKilometersPrice} CHF`}),ye.length>0&&i.jsxs("div",{className:"mt-6 bg-gray-100 p-4 rounded-md",children:[i.jsx(b,{variant:"h6",className:"mb-2",children:"Selected Additional Products"}),ye.map((e=>i.jsxs(i.Fragment,{children:[i.jsx(b,{variant:"body1",children:e.name},e._id),i.jsxs("h1",{className:"text-xl font-extrabold",children:["Price: ",e.price," CHF"]})]})))]}),i.jsxs("div",{className:"mt-4 flex items-start space-x-4",children:[i.jsx(f,{id:"termsCheckbox",className:"w-6 h-6 rounded-lg focus:ring-blue-500 shadow-md transition-all duration-300 hover:scale-110",onChange:e=>me(e.target.checked)}),i.jsxs("label",{htmlFor:"termsCheckbox",className:"text-sm text-gray-700 leading-relaxed",children:["I agree to the"," ",i.jsx("span",{onClick:()=>Ie("terms"),className:"text-blue-600 underline hover:text-blue-800 cursor-pointer font-semibold",children:"Terms and Conditions"})," ","and"," ",i.jsx("span",{onClick:()=>Ie("privacy"),className:"text-blue-600 underline hover:text-blue-800 cursor-pointer font-semibold",children:"Privacy Policy"})]})]}),i.jsxs("div",{className:"mt-6 flex items-center space-x-4 bg-gradient-to-r from-gray-100 to-gray-200 p-5 rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300",children:[i.jsx("div",{className:"text-blue-500",children:i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-7 h-7",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 11c1.104 0 2-.896 2-2m-2 2v1m0-5c-1.104 0-2 .896-2 2m2-2h.01M12 4a4 4 0 014 4v1h2a1 1 0 011 1v10a1 1 0 01-1 1H7a1 1 0 01-1-1V10a1 1 0 011-1h2V8a4 4 0 014-4z"})})}),i.jsx("p",{className:"text-sm text-gray-600 font-semibold",children:de.sslmessage})]})]}),i.jsx("div",{className:"mt-6",children:i.jsxs(l,{variant:"contained",startIcon:i.jsx(D,{}),onClick:async()=>{var e,r;$(!0),O("");const s=["firstName","lastName","email","phone"];for(let a of s)if(!Y[a])return O(`Please fill out the ${a} field.`),P.error(`Please fill out the ${a} field.`),void $(!1);const t={...Y,selectedSlots:H.selectedSlots.map((e=>({...e,date:Ge(e.date)}))),totalPrice:H.totalPrice,vanId:H.vanDetails._id,driverInfo:JSON.stringify(Y.driverInfo)};try{const{data:e}=await a.post(`${R}/api/create-booking`,t,{headers:{"Content-Type":"application/json"}});ee(e.email),_(!0),ae(e.sessionId)}catch(i){console.error("Error during checkout:",i);const s=(null==(r=null==(e=i.response)?void 0:e.data)?void 0:r.error)||"Failed to initiate payment. Please try again.";P.error(s),O(s)}finally{$(!1)}},disabled:!ce||M,className:"w-full py-4 rounded-xl text-lg font-bold shadow-xl transition-transform "+(ce?"hover:scale-105 bg-gradient-to-r from-orange-500 to-orange-600":"cursor-not-allowed bg-gray-300"),style:{color:ce?"#fff":"#aaa"},children:[H&&H.totalPrice+ye.reduce(((e,r)=>e+r.price),0)+(we?null==(Je=null==H?void 0:H.vanDetails)?void 0:Je.unlimitedKilometersPrice:0)," CHF",M?i.jsx(w,{size:24,color:"inherit"}):" Pay Now"]})})]})})})]})]}),V&&i.jsx(S,{open:V,handleClose:()=>G(!1),email:Y.email}),i.jsx(T,{open:Z,handleClose:()=>_(!1),otp:U,setOtp:Q,onVerify:async e=>{try{const r=await a.post(`${R}/api/verify-otp`,{email:X,otp:e}),{accessToken:s,refreshToken:t}=r.data;localStorage.setItem("accessToken",s),localStorage.setItem("refreshToken",t),P.success("OTP verified successfully!"),_(!1),Q("");const i=await B,{error:o}=await i.redirectToCheckout({sessionId:se});o&&(console.error("Stripe Redirect Error:",o),P.error("Failed to redirect to payment. Please try again."))}catch(r){console.error("OTP Verification Failed:",r),P.error("Invalid or expired OTP.")}},otpRefs:re,otpLength:4}),ie&&le&&i.jsx(L,{isOpen:ie,onClose:()=>oe(!1),van:le,totalPrice:le.totalPrice,startDate:le.startDate,endDate:le.endDate,startTime:le.startTime,endTime:le.endTime})]});var Je};export{q as default};
