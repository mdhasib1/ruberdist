import{r as e,b as a,j as t,cG as s,g as r,J as l,f as n,a2 as i,a4 as o,a$ as d,bZ as c,bf as u,b$ as h,c0 as m,c1 as x,c2 as p,aV as b}from"./vendor-Zgq9WbFI.js";const g=()=>{const[g,v]=e.useState(""),[f,w]=e.useState(!1),[j,y]=e.useState([]),[N,C]=e.useState(0),[S,k]=e.useState(null),[R,W]=e.useState(!1),[A,D]=e.useState(!1),[$,q]=e.useState(""),B=localStorage.getItem("accessToken"),F=(e=>{if(!e)return null;try{const a=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),t=decodeURIComponent(atob(a).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join(""));return JSON.parse(t)}catch(a){return console.error("Failed to parse JWT:",a.message),null}})(B),I=null==F?void 0:F.id,P=a.create({baseURL:"https://rubertogo.com",headers:{Authorization:`Bearer ${B}`}}),U=async()=>{var e;w(!0);try{const e=await P.get(`/api/partner/balance/${I}`);C(e.data.balance)}catch(a){404===(null==(e=a.response)?void 0:e.status)?C(0):b.error("Failed to fetch balance")}finally{w(!1)}},O=async()=>{var e;w(!0);try{const e=await P.get(`/api/withdrawals/partner/${I}`);y(e.data.withdrawals||[])}catch(a){404===(null==(e=a.response)?void 0:e.status)&&y([])}finally{w(!1)}};e.useEffect((()=>{I&&(O(),U(),(async()=>{var e;try{const e=await P.get(`/api/bank-details/${I}`);k(e.data.bankDetails)}catch(a){404===(null==(e=a.response)?void 0:e.status)?k(null):b.error("Failed to fetch bank details.")}})())}),[I]);const z=()=>{D(!1),q("")},J=[{field:"amount",headerName:"Amount (USD)",width:250,renderCell:e=>`${e.value.toFixed(2)}`},{field:"requestDate",headerName:"Requested On",width:250,renderCell:e=>new Date(e.value).toLocaleDateString()},{field:"status",headerName:"Status",width:200,renderCell:e=>t.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-semibold "+("approved"===e.value?"bg-green-100 text-green-600":"rejected"===e.value?"bg-red-100 text-red-600":"bg-yellow-100 text-yellow-600"),children:e.value.charAt(0).toUpperCase()+e.value.slice(1)})},{field:"actions",headerName:"Actions",width:500,renderCell:e=>t.jsx("div",{className:"flex gap-4",children:"approved"===e.row.status&&t.jsx(o,{variant:"contained",color:"secondary",onClick:()=>{return a=e.row.paymentReceipt,q(a),void D(!0);var a},children:"View Receipt"})})}];return t.jsxs(s,{maxWidth:"lg",sx:{paddingTop:4,paddingBottom:4},children:[t.jsxs(r,{variant:"h4",className:"font-bold text-center bg-green-900 p-5 text-white mb-8",children:[t.jsx(l,{className:"inline"})," Withdrawal Requests"]}),t.jsxs(n,{sx:{backgroundColor:"green",color:"white",borderRadius:2,textAlign:"center",padding:3,marginBottom:4},children:[t.jsx(r,{variant:"h4",className:"font-semibold text-white text-center mb-4",children:"Current Balance"}),t.jsxs(r,{variant:"h3",className:"text-white font-extrabold flex items-center justify-center",children:[t.jsx(l,{className:"inline"})," ",N.toFixed(2)]})]}),t.jsxs("div",{className:"bg-white shadow-md rounded-lg p-6 mb-8 max-w-4xl mx-auto",children:[t.jsx(r,{variant:"h6",className:"font-semibold text-gray-800 mb-4",children:"Request a Withdrawal"}),t.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center",children:[t.jsx(i,{label:"Enter Amount",variant:"outlined",value:g,onChange:e=>v(e.target.value),fullWidth:!0,className:"flex-1"}),t.jsx(o,{variant:"contained",onClick:async()=>{if(g){w(!0);try{await(async({partnerId:e,amount:a})=>{var t,s,r;if(!S)return b.error("You must set up your bank details before requesting a withdrawal."),void W(!0);try{return(await P.post("/api/withdrawals",{partnerId:e,amount:a})).data}catch(l){400===(null==(t=l.response)?void 0:t.status)&&b.error((null==(r=null==(s=l.response)?void 0:s.data)?void 0:r.message)||"Invalid request data.")}})({partnerId:I,amount:g}),v(""),O(),U()}catch(e){b.error(e.message)}finally{w(!1)}}else b.error("Please enter an amount.")},disabled:f,className:"bg-gradient-to-r from-blue-500 to-blue-700 text-white px-8 py-2",children:f?t.jsx(d,{size:20,color:"inherit"}):"Submit"})]})]}),t.jsxs("div",{className:"bg-gray-50 shadow-md rounded-lg p-6 max-w-4xl mx-auto",children:[t.jsx(r,{variant:"h6",className:"font-semibold text-gray-800 mb-4",children:"Withdrawal History"}),f?t.jsx("div",{className:"flex justify-center py-4",children:t.jsx(d,{})}):j.length>0?t.jsx("div",{className:"overflow-x-auto",children:t.jsx("div",{style:{minWidth:"600px"},children:t.jsx(c,{rows:j.map(((e,a)=>({id:a,...e}))),columns:J,pageSize:5,rowsPerPageOptions:[5],disableSelectionOnClick:!0,className:"w-full"})})}):t.jsx(r,{variant:"body1",className:"text-gray-600",children:"No withdrawal requests found."})]}),t.jsx(u,{open:R,onClose:()=>W(!1),className:"container",children:t.jsxs(n,{sx:{maxWidth:"500px",width:"100%",bgcolor:"background.paper",borderRadius:2,boxShadow:24,p:4,mx:"auto",mt:8},children:[t.jsx(r,{variant:"h6",className:"mb-4",children:"Add/Update Bank Details"}),["bankName","accountNumber","accountHolderName","branchName","swiftCode"].map((e=>t.jsx(i,{label:e.replace(/([A-Z])/g," $1"),variant:"outlined",fullWidth:!0,margin:"normal",value:(null==S?void 0:S[e])||"",onChange:a=>k({...S,[e]:a.target.value})},e))),t.jsx(o,{variant:"contained",color:"primary",onClick:()=>(async e=>{try{const a=await P.post("/api/bank-details",e);k(a.data.bankDetails),b.success("Bank details saved successfully."),W(!1)}catch(a){b.error("Failed to save bank details.")}})(S),fullWidth:!0,className:"mt-4",children:"Save Details"})]})}),t.jsxs(h,{open:A,onClose:z,fullWidth:!0,children:[t.jsx(m,{children:t.jsx(r,{variant:"h5",className:"font-bold text-center",children:"Payment Receipt"})}),t.jsx(x,{children:f?t.jsx("div",{className:"flex justify-center items-center",children:t.jsx(d,{})}):$?t.jsx("img",{src:$,alt:"Payment Receipt",style:{width:"100%",height:"auto",borderRadius:"8px"},onLoad:()=>w(!1)}):t.jsx(r,{className:"text-center text-gray-600",children:"No receipt available."})}),t.jsx(p,{children:t.jsx(o,{onClick:z,variant:"contained",color:"primary",style:{minWidth:"100px"},children:"Close"})})]})]})};export{g as default};
